/*
Copyright Â©2014 Esri. All rights reserved.
 
TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
Unpublished material - all rights reserved under the
Copyright Laws of the United States and applicable international
laws, treaties, and conventions.
 
For additional information, contact:
Attn: Contracts and Legal Department
Environmental Systems Research Institute, Inc.
380 New York Street
Redlands, California, 92373
USA
 
email: contracts@esri.com
*/
//>>built
require({cache:{"builder/Apps":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/html","dojo/request","dojo/mouse","dojo/i18n!./nls/builder","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Apps.html","dojo/on","dojo/keys","dojo/_base/lang","dijit/form/ValidationTextBox","./CreateApp","./AppOperMenu","./ConfigApp","dojo/Deferred","dojo/topic","dojo/dom-class","dojo/dom","jimu/dijit/Popup","dojo/query","dijit/registry","jimu/dijit/Message","esri/request"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,on,_a,_b,_c,_d,_e,_f,_10,_11,_12,dom,_13,_14,_15,_16,_17){return _1([_7,_8],{templateString:_9,menu:undefined,label:"apps",apps:{},sortBy:"lastUpdated",postMixInProperties:function(){this.nls=_b.mixin({},_6.common);this.nls=_b.mixin(this.nls,_6.apps);},startup:function(){this.inherited(arguments);this.refresh();_3.setSelectable(this.appContent,false);},getAppList:function(){return _4("/builder/rest/apps/list",{preventCache:true,handleAs:"json"});},refresh:function(_18){this.cleanAppList();if(_18){this.setApps(_18);this.createAppList();}else{this.getAppList().then((function(_19){this.setApps(_19);this.createAppList();}).bind(this));}},setApps:function(_1a){this.apps=_1a;},createAppList:function(){var i,_1b=null;for(i=0;i<this.apps.length;i++){_1b=this.createAppNode(this.apps[i],i,_1b);}},cleanAppList:function(){_3.empty(this.listTable);},createAppNode:function(app,i,_1c){var _1d,_1e,_1f,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_2a,_2b,_2c,_2d,_2e;_1d=_3.create("tr",{"class":"list-table-item list-table-item"+((i%2)?" list-table-item-add ":" ")},this.listTable);_2e=_1d;_2a=_3.create("td",{"class":"item-begin-td item-first-td"},_1d);_2b=_3.create("td",{"class":"item-begin-td item-second-td"},_1d);_1f=_3.create("td",{"class":"item-name-td"},_1d);_20=_3.create("div",{"class":"item-name","innerHTML":app.name},_1f);_21=_3.create("td",{"class":"item-desc-td"},_1d);_22=_3.create("div",{"class":"item-desc","innerHTML":app.description},_21);_1e=_3.create("td",{"class":"item-time-td"},_1d);_29=_3.create("div",{"class":"item-time","innerHTML":app.lastUpdated},_1e);_2c=_3.create("td",{"class":"item-loading-td",innerHTML:"<div class='loading-div'></div>"},_1d);var _2f=_14(".loading-div",_2c)[0];_3.create("img",{"src":"/bstatic/css/images/download.gif","class":"loading-img"},_2f);_1e=_3.create("td",{"class":"item-operations-td"},_1d);_23=_3.create("div",{"class":"item-operations-div"},_1e);_3.setStyle(_23,"display","none");_24=_3.create("div",{"class":"item-edit"},_23);_3.create("div",{"innerHTML":this.nls.edit,"class":"item-edit-text"},_24);_25=_3.create("div",{"innerHTML":"<a href=\"/apps/"+app.id+"/\" target=\"_blank\">"+this.nls.launch+"</a>","class":"item-preview"},_23);_26=_3.create("div",{"class":"item-more"},_23);_28=_3.create("div",{"class":"app-menu-div"},_26);_27=new _e({apps:this.apps,app:app,posNode:_2e,loadingDiv:_2f,appListWidget:this},_28);_2d=_3.create("td",{"class":"item-end-td"},_1d);this.own(on(_1d,_5.enter,_b.hitch(this,this._onListTableItemMouseover,_1d,_23,_1c)));this.own(on(_1d,_5.leave,_b.hitch(this,this._onListTableItemMouseout,_1d,_23,_27,_1c)));this.own(on(_1d,"click",_b.hitch(this,function(evt){evt.stopPropagation();})));this.own(on(_20,"dblclick",_b.hitch(this,this._onNameDoubleClick,app,_1d,_1f,_20,_29)));this.own(on(_22,"dblclick",_b.hitch(this,this._onDescriptionDoubleClick,app,_1d,_21,_22,_29)));this.own(on(_24,"click",_b.hitch(this,this._onAppEditClick,app)));this.own(on(_25,"click",this._onAppPreviewClick(app)));this.own(on(_26,"click",_b.hitch(this,this._onAppMoreClick,app,_27,_26,_2a,_1d,_23,_1c)));this.own(on(this.ownerDocument,"click",_b.hitch(this,this._onAppsClick,_27,_1d,_23,_2a,_1c,_26)));this.own(_11.subscribe("menuAll/hide",_b.hitch(this,this._onAppsClick,_27,_1d,_23,_2a,_1c,_26)));return _1d;},createAppNodeHTML:function(app){var _30="<td><div>"+app.name+"</div></td>"+"<td><div>"+app.description+"</div></td>"+"<td><div>"+app.lastUpdated+"</div></td>"+"<input type=\"button\" value=\"Edit\" />"+"<input type=\"button\" value=\"Preview\"/>"+"<input type=\"button\" value=\"...\"/>";return _30;},changeTextFieldOfNode:function(_31,_32,_33,_34,_35,_36){var _37,_38=_b.clone(_31);_3.setStyle(_35,"display","none");if(_34==="name"){_37=_3.create("input",{"value":_31[_34],"class":"jimu-input item-input-"+_34},_33);}else{_37=_3.create("textarea",{"value":_31[_34],"class":"jimu-input item-textarea-"+_34},_33);}_37.focus();_37.select();_12.add(_32,"list-table-item-dbclick");on(_37,"blur",_b.hitch(this,function(){if(_31[_34]!==_37.value){_38[_34]=_37.value;this.updateApp(_38).then(function(res){if(res.success===true){_35.innerHTML=_37.value;_36.innerHTML=res.lastUpdated;_31[_34]=_37.value;}else{}},function(err){});}_3.destroy(_37);_3.setStyle(_35,"display","block");_12.remove(_32,"list-table-item-dbclick");}));},updateApp:function(app){return _4("/builder/rest/apps/updateapp",{handleAs:"json",method:"POST",data:{"id":app.id,"name":app.name,"description":app.description}});},_onCreateClick:function(){var _39=new _d({appListWidget:this,apps:this.apps});var _3a=new _13({content:_39,container:"main-page",titleLabel:this.nls.appCreateTitle,width:669,height:540,buttons:[{label:this.nls.ok,key:_a.ENTER,onClick:_b.hitch(_39,_39._onNextClick)},{label:this.nls.cancel,key:_a.ESCAPE,onClick:_b.hitch(_39,_39._onCancelClick)}]});_39.startup();var _3b=_14(".line",_3a.domNode)[0];_3.destroy(_3b);},_onUploadClick:function(){on.emit(this.appFileInputNode,"click",{cancelable:true,bubble:true});},_onAppFileChange:function(){_17({url:"/builder/rest/apps/upload",form:this.uploadAppFileFormNode}).then(_b.hitch(this,function(_3c){if(_3c.success){this.cleanAppList();this.getAppList().then((function(_3d){this.setApps(_3d);this.createAppList();}).bind(this));}else{new _16({message:_3c.message});}}),function(err){new _16({message:err.message});});},_onListTableItemMouseover:function(_3e,_3f,_40){_12.add(_3e,"list-table-item-mouseover");if(_40){_12.add(_40,"list-table-next-item-mouseover");}_3.setStyle(_3f,"display","block");},_onListTableItemMouseout:function(_41,_42,_43,_44){if(!_43.isShow){_12.remove(_41,"list-table-item-mouseover");if(_44){_12.remove(_44,"list-table-next-item-mouseover");}_3.setStyle(_42,"display","none");}},_onNameDoubleClick:function(_45,_46,_47,_48,_49){_b.hitch(this,this.changeTextFieldOfNode(_45,_46,_47,"name",_48,_49));},_onDescriptionDoubleClick:function(_4a,_4b,_4c,_4d,_4e){_b.hitch(this,this.changeTextFieldOfNode(_4a,_4b,_4c,"description",_4d,_4e));},_onAppEditClick:function(_4f){var _50=main.getViewByLabel("config");if(_50&&(_50.appId.toString()===_4f.id.toString())){main.switchView(_50);_50.setAppId(_4f.id);_15.byId("header").setAppName(_4f.name);}else{if(_50){main.removeView(_50);}_50=new _f({appId:_4f.id,appName:_4f.name});main.addView(_50);main.switchView(_50);}},_onAppPreviewClick:function(_51){return function(){};},_onAppMoreClick:function(_52,_53,_54,_55,_56,_57,_58,evt){if(_53.isShow){_53.hide();_12.remove(_55,"item-first-td-selected");_3.removeClass(_54,"item-more-selected");}else{_11.publish("menuAll/hide");_53.set("app",_52);_53.show();_12.add(_55,"item-first-td-selected");_3.addClass(_54,"item-more-selected");this._onListTableItemMouseover(_56,_57,_58,evt);}evt.stopPropagation();},_onAppsClick:function(_59,_5a,_5b,_5c,_5d,_5e){_59.hide();_12.remove(_5c,"item-first-td-selected");if(_5d){_12.remove(_5d,"list-table-next-item-mouseover");}_12.remove(_5a,"list-table-item-mouseover");_3.removeClass(_5e,"item-more-selected");_3.setStyle(_5b,"display","none");}});});},"builder/CreateApp":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/html","dojo/request","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/CreateApp.html","dojo/on","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dojo/_base/lang","dojo/i18n!./nls/builder","jimu/dijit/Message","dojo/ready","./ConfigApp"],function(_5f,_60,_61,_62,_63,_64,_65,on,_66,_67,_68,_69,_6a,_6b,_6c,_6d){return _5f([_63,_64],{templateString:_65,baseClass:"create-app",appListWidget:null,createFromId:null,is3D:"false",postMixInProperties:function(){this.nls=_69.mixin({},_6a.common);this.nls=_69.mixin(this.nls,_6a.apps);},postCreate:function(){this.inherited(arguments);if(this.createFromId){if(this.is3D==="true"){_67.add(this.app3D,"app-image-div-down");}else{_67.add(this.app2D,"app-image-div-down");}}else{this.flag=true;this.createFromId="default2DApp";_67.add(this.app2D,"app-image-div-down");}},startup:function(){this.inherited(arguments);this.appName.focus();},saveApp:function(){},createApp:function(){return _62("/builder/rest/apps/createapp",{handleAs:"json",method:"POST",data:{"name":this.appName.value,"description":this.appDescription.value,"id":this.createFromId,"is3D":this.is3D}});},_onCancelClick:function(){this.destroy();this._closePopup();},_onNextClick:function(){var _6e=this.appName.value;if(_6e){this.createApp().then(_69.hitch(this,function(res){if(res.success){var _6f=main.getViewByLabel("config");if(_6f&&(_6f.appId.toString()===res.newAppId.toString())){main.switchView(_6f);}else{this.appListWidget.refresh();if(_6f){main.removeView(_6f);}_6f=new _6d({appId:res.newAppId});main.addView(_6f);main.switchView(_6f);}this._closePopup();this.destroy();}else{new _6b({message:res.message});}}),function(err){new _6b({message:this.nls.createAppFailedMeg});});}else{new _6b({message:this.nls.noAppName});}},_closePopup:function(){if(this.popup){this.popup.close();}},_on2dClick:function(){if(this.flag){this.createFromId="default2DApp";this.is3D="false";_67.add(this.app2D,"app-image-div-down");_67.remove(this.app3D,"app-image-div-down");}},_on3dClick:function(){}});});},"builder/ConfigApp":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/on","dojo/topic","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/ConfigApp.html","./config/LeftPane","jimu/WidgetManager","jimu/dijit/ViewStack","esri/urlUtils","esri/geometry/Extent","dojo/request","dijit/registry","jimu/tokenUtils","jimu/portalUrlUtils"],function(_70,_71,_72,_73,on,_74,_75,_76,_77,_78,_79,_7a,_7b,_7c,_7d,_7e,_7f,_80){return _70([_75,_76],{templateString:_77,baseClass:"config-app",_PreviewMoreIframeSrc:"",_isPortrait:true,_deviceInfo:null,appId:null,label:"config",postCreate:function(){this.inherited(arguments);window.configWindow=this.viewerNode.contentWindow;window.previewWindow=this.viewer2Node.contentWindow;this.own(on(this.viewerNode,"load",_71.hitch(this,function(){window.configWindow=this.viewerNode.contentWindow;})));this.own(on(this.viewer2Node,"load",_71.hitch(this,function(){window.previewWindow=this.viewer2Node.contentWindow;})));this.viewStack=new _7a({viewType:"dom",views:[this.previewConfig,this.previewMore]});_73.addClass(this.viewStack.domNode,"preview-viewstack");_73.place(this.viewStack.domNode,this.rightPreviewSection);this._showPreviewConfig();this._republishBuilderEvents();this.own(_74.subscribe("showPreviewConfig",_71.hitch(this,function(){this._showPreviewConfig();})));this.own(_74.subscribe("showPreviewMore",_71.hitch(this,function(){this._showPreviewMore();})));this.own(_74.subscribe("onDeviceSelected",_71.hitch(this,this.onDeviceSelected)));this.own(on(this.btnPortrait,"click",_71.hitch(this,function(){this._resizePreviewMore(true);})));this.own(on(this.btnLandscape,"click",_71.hitch(this,function(){this._resizePreviewMore(false);})));this._createLeftPane();this.widgetManager=_79.getInstance();window.setConfigViewerTopic=_71.hitch(this,function(_81){this.configViewerTopic=_81;this.own(this.configViewerTopic.subscribe("appConfigLoaded",_71.hitch(this,this.onAppConfigLoaded)));this.own(this.configViewerTopic.subscribe("appConfigChanged",_71.hitch(this,this.onAppConfigChanged)));this.own(this.configViewerTopic.subscribe("mapLoaded",_71.hitch(this,this.onMapLoaded)));this.own(this.configViewerTopic.subscribe("mapChanged",_71.hitch(this,this.onMapChanged)));this.own(this.configViewerTopic.subscribe("preloadWidgetsLoaded",_71.hitch(this,this.onPreloadWidgetsLoaded)));this.own(this.configViewerTopic.subscribe("userSignIn",_71.hitch(this,function(_82,_83){esri.id.registerToken(_82);var _84={};if(_83){_84=_71.mixin({},_83);}if(!_84.builder){_74.publish("userSignIn",_82,{builder:true,config:true,preview:true});}if(!_84.preview&&this.previewViewerTopic){this.previewViewerTopic.publish("userSignIn",_82,{builder:true,config:true,preview:true});}})));this.own(this.configViewerTopic.subscribe("userSignOut",_71.hitch(this,function(_85,_86){var _87={};if(_86){_87=_71.mixin({},_86);}if(!_87.builder){_74.publish("needSignOut",_85,{builder:true,config:true,preview:true});}if(!_87.preview&&this.previewViewerTopic){this.previewViewerTopic.publish("needSignOut",_85,{builder:true,config:true,preview:true});}})));});window.setPreviewViewerTopic=_71.hitch(this,function(_88){this.previewViewerTopic=_88;var _89=_71.clone(this.appConfig);_89.mode="preview";this.previewViewerTopic.publish("resetConfig",_89);this.own(this.previewViewerTopic.subscribe("userSignIn",_71.hitch(this,function(_8a,_8b){esri.id.registerToken(_8a);var _8c={};if(_8b){_8c=_71.mixin({},_8b);}if(!_8c.builder){_74.publish("userSignIn",_8a,{builder:true,config:true,preview:true});}if(!_8c.config&&this.configViewerTopic){this.configViewerTopic.publish("userSignIn",_8a,{builder:true,config:true,preview:true});}})));this.own(this.previewViewerTopic.subscribe("userSignOut",_71.hitch(this,function(_8d,_8e){var _8f={};if(_8e){_8f=_71.mixin({},_8e);}if(!_8f.builder){_74.publish("needSignOut",_8d,{builder:true,config:true,preview:true});}if(!_8f.config&&this.configViewerTopic){this.configViewerTopic.publish("needSignOut",_8d,{builder:true,config:true,preview:true});}})));var _90=_7f.getCredential();if(_90){this.previewViewerTopic.publish("userSignIn",_90,{builder:true,config:true,preview:true});}this.own(this.previewViewerTopic.subscribe("mapLoaded",_71.hitch(this,function(){this._copyConfigMapExtent2PreviewExtent();})));});if(this.appId){this._updateAppId();}this.showAppName();},_createLeftPane:function(){this.leftPane=new _78({});this.leftPane.placeAt(this.leftPaneNode);},_updateAppId:function(){var _91;if(this.appId==="stemapp"){_91="/webapp/";}else{_91="/apps/"+this.appId+"/";}window.appId=this.appId;window.appPath=_91;jimuConfig.widgetsPackage={name:"widgets",location:_91+"widgets"};this._PreviewMoreIframeSrc=_91+"?mode=preview"+this._getAppUrlParams();_73.attr(this.viewerNode,"src",_91+"?mode=config"+this._getAppUrlParams());},setAppId:function(_92){if(this.appId===_92){var _93=_71.clone(this.leftPane.lastAppConfig);this.leftPane.destroy();this._createLeftPane();this._setAppConfig(_93,true);this.configViewerTopic.publish("resetConfig",_93);return;}this.appId=_92;_73.setStyle(this.leftPane.coverNode,"display","");this._updateAppId();},showAppName:function(){var _94=_7e.byId("header");if(this.appId==="stemapp"){_94.setAppName("stemapp");}else{if(this.appName){_94.setAppName(this.appName);}else{_7d("/builder/rest/apps/"+this.appId,{preventCache:true,handleAs:"json"}).then(_71.hitch(this,function(app){_94.setAppName(app[0].name);}));}}},_republishBuilderEvents:function(){this.own(_74.subscribe("configChanged",_71.hitch(this,function(id,_95,_96){this.configViewerTopic.publish("configChanged",id,_95,_96);if(id==="app"){var _97=_95.portalUrl;var _98=_7f.getPortalUrl();var _99=_80.isSamePortalUrl(_98,_97);if(!_99){_7f.signOut();_97=_80.getStandardPortalUrl(_97);_7f.setPortalUrl(_97);var _9a=_7f.getCredential(_97);if(_9a){_74.publish("userSignIn",_9a,{builder:true});}}}})));this.own(_74.subscribe("themeChanged",_71.hitch(this,function(_9b){this.configViewerTopic.publish("themeChanged",_9b);})));this.own(_74.subscribe("layoutChanged",_71.hitch(this,function(_9c){this.configViewerTopic.publish("layoutChanged",_9c);})));this.own(_74.subscribe("styleChanged",_71.hitch(this,function(_9d){this.configViewerTopic.publish("styleChanged",_9d);})));this.own(_74.subscribe("actionTriggered",_71.hitch(this,function(id,_9e,_9f){this.configViewerTopic.publish("actionTriggered",id,_9e,_9f);})));this.own(_74.subscribe("userSignIn",_71.hitch(this,function(_a0,_a1){esri.id.registerToken(_a0);var _a2={};if(_a1){_a2=_71.mixin({},_a1);}if(!_a2.config&&this.configViewerTopic){this.configViewerTopic.publish("userSignIn",_a0,{builder:true,config:true,preview:true});}if(!_a2.preview&&this.previewViewerTopic){this.previewViewerTopic.publish("userSignIn",_a0,{builder:true,config:true,preview:true});}})));this.own(_74.subscribe("userSignOut",_71.hitch(this,function(_a3,_a4){var _a5={};if(_a4){_a5=_71.mixin({},_a4);}if(!_a5.config&&this.configViewerTopic){this.configViewerTopic.publish("needSignOut",_a3,{builder:true,config:true,preview:true});}if(!_a5.preview&&this.previewViewerTopic){this.previewViewerTopic.publish("needSignOut",_a3,{builder:true,config:true,preview:true});}})));},startup:function(){this.inherited(arguments);this.leftPane.startup();this.viewStack.startup();},destroy:function(){this.leftPane.destroy();this.leftPane=null;this.inherited(arguments);},onAppConfigLoaded:function(_a6){_74.publish("appConfigLoaded",_a6);this._setAppConfig(_a6,true);if(_7f.userHaveSignIn(_a6.portalUrl)){this.configViewerTopic.publish("userSignIn",_7f.getCredential(),{builder:true,config:true,preview:true});}},onMapLoaded:function(map){_74.publish("mapLoaded",map);},onMapChanged:function(map){_74.publish("mapChanged",map);},onAppConfigChanged:function(_a7,_a8,_a9){_74.publish("appConfigChanged",_a7,_a8,_a9);this._setAppConfig(_a7,false);},onPreloadWidgetsLoaded:function(){_74.publish("preloadWidgetsLoaded");},_getAppUrlParams:function(){var _aa=_7b.urlToObject(window.location.href).query;var _ab="";for(var p in _aa){if(p!=="appid"&&_aa.hasOwnProperty(p)){_ab=_ab+"&"+p+"="+_aa[p];}}return _ab;},_setAppConfig:function(_ac,_ad){this.leftPane.setAppConfig(_ac,_ad);this.appConfig=_ac;window.appConfig=_ac;},_showPreviewConfig:function(){this.viewStack.switchView(this.previewConfig);},_showPreviewMore:function(){this.viewStack.switchView(this.previewMore);if(!this.viewer2Node.src&&this._PreviewMoreIframeSrc){this._initPreviewMoreViewerPosition();_73.attr(this.viewer2Node,"src",this._PreviewMoreIframeSrc);}else{var _ae=_71.clone(this.appConfig);_ae.mode="preview";this._copyConfigMapExtent2PreviewExtent();this.previewViewerTopic.publish("resetConfig",_ae);}},_copyConfigMapExtent2PreviewExtent:function(){var _af=window.configWindow&&window.configWindow._viewerMap;var _b0=window.previewWindow&&window.previewWindow._viewerMap;if(_af&&_b0){_b0.setExtent(_af.extent);}},_initPreviewMoreViewerPosition:function(){var _b1=_73.getMarginBox(this.previewMore);var w=_b1.w-110*2;var h=_b1.h-65*2;_73.setStyle(this.viewer2Container,{width:w+"px",height:h+"px"});_73.setStyle(this.previewMoreIframeSection,"marginTop","50px");},_setPreviewMoreViewerPosition:function(){var _b2=_73.getMarginBox(this.previewMore);var H=_b2.h;var _b3=_73.getMarginBox(this.viewer2Container);var _b4=_73.getStyle(this.viewer2Container,"paddingTop");var _b5=_73.getStyle(this.viewer2Container,"paddingBottom");var h=_b3.h+_b4+_b5;var _b6=(H-h)/2;if(_b6<0){_b6=0;}_73.setStyle(this.previewMoreIframeSection,"marginTop",_b6+"px");},onDeviceSelected:function(_b7,_b8){this._deviceInfo=_b7;_73.setStyle(this.previewMoreDes,"display","block");if(_b8){this.previewMoreDes.innerHTML=_b7.width+" x "+_b7.height;}else{this.previewMoreDes.innerHTML=_b7.title+" "+_b7.width+" x "+_b7.height;}this._resizePreviewMore(this._isPortrait);},_resizePreviewMore:function(_b9){var _ba=window.configWindow&&window.configWindow._viewerMap;var _bb=window.previewWindow&&window.previewWindow._viewerMap;var _bc=_ba&&_ba.extent.toJson();if(_b9){this._showPortrait();}else{this._showLandscape();}if(_bb&&_bc){setTimeout(function(){var ext=new _7c(_bc);_bb.setExtent(ext);},500);}},_showPortrait:function(){if(this._deviceInfo){this._isPortrait=true;var w=(this._deviceInfo.width+44)+"px";var h=(this._deviceInfo.height+44)+"px";_73.setStyle(this.viewer2Container,{width:w,height:h});_73.addClass(this.btnPortrait,"selected");_73.removeClass(this.btnLandscape,"selected");this._setPreviewMoreViewerPosition();}},_showLandscape:function(){if(this._deviceInfo){this._isPortrait=false;var w=(this._deviceInfo.width+44)+"px";var h=(this._deviceInfo.height+44)+"px";_73.setStyle(this.viewer2Container,{width:h,height:w});_73.removeClass(this.btnPortrait,"selected");_73.addClass(this.btnLandscape,"selected");this._setPreviewMoreViewerPosition();}}});});},"builder/config/LeftPane":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/topic","dojo/on","dojo/request/xhr","dojo/aspect","dojo/query","dojo/Deferred","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/LeftPane.html","./MapConfig","./ThemeConfig","./WidgetConfig","./AttributeConfig","./TabContainer2","jimu/utils","jimu/dijit/ViewStack","jimu/dijit/Message","jimu/dijit/Popup","dijit/registry","dojo/i18n!../nls/builder"],function(_bd,_be,_bf,_c0,on,xhr,_c1,_c2,_c3,_c4,_c5,_c6,_c7,_c8,_c9,_ca,_cb,_cc,_cd,_ce,_cf,_d0,_d1,_d2){return _bd([_c4,_c5,_c6],{templateString:_c7,postMixInProperties:function(){this.nls=_be.mixin({},_d2.common);this.nls=_be.mixin(this.nls,_d2.leftPane);},postCreate:function(){this.inherited(arguments);this._initPreviewItems();this.themePane=new _c9({coverNode:this.coverNode},this.appPaneNode);this.mapPane=new _c8({},this.mapPaneNode);this.mapPane.startup();this.widgetPane=new _ca({},this.widgetPaneNode);this.attributePane=new _cb({},this.attributePaneNode);this.tab=new _cc({tabs:[{title:this.nls.themes,content:this.themePane},{title:this.nls.map,content:this.mapPane},{title:this.nls.widgets,content:this.widgetPane},{title:this.nls.attributes,content:this.attributePane}],selected:this.nls.themes},this.tabsNode);this._bindEvents();this.viewStack=new _ce({viewType:"dom",views:[this.configSection,this.previewSection]});_bf.place(this.viewStack.domNode,this.content);_bf.setStyle(this.viewStack.domNode,"width","100%");_bf.setStyle(this.viewStack.domNode,"height","100%");this._showConfigSection();},_bindEvents:function(){var _d3=_d1.byId("header");var _d4=on(this.btnHomePage,"click",_be.hitch(this,function(){if(this._appHasChanged()){var _d5=new _d0({content:"<div><img class='alert-image' src='/bstatic/css/images/alert.png' style='float:left;margin-left:12px;margin-right:22px;'></img>"+this.nls.unSaveMegBegin+_d3.getAppName()+this.nls.unSaveMegEnd+"</div>",titleLabel:this.nls.toHomeTitle,width:"425",height:"200",buttons:[{label:this.nls.save,onClick:_be.hitch(this,function(){if(appId==="stemapp"){new _cf({message:this.nls.canNotSaveMeg});_d5.close();return;}this._saveApp().then(_be.hitch(this,function(_d6){_d5.close();if(_d6.success){main.switchView("apps");_d3.setAppName("");}}),function(){});})},{label:this.nls.doNotSave,onClick:_be.hitch(this,function(){_d5.close();main.switchView("apps");_d3.setAppName("");})},{label:this.nls.cancel,onClick:_be.hitch(this,function(){_d5.close();})}]});}else{main.switchView("apps");_d3.setAppName("");}}));var _d7=on(this.btnPreview,"click",_be.hitch(this,this._showPreviewSection));var _d8=on(this.btnConfig,"click",_be.hitch(this,this._showConfigSection));var _d9=on(this.btnSave,"click",_be.hitch(this,this._onSave));var _da=on(this.btnOk,"click",_be.hitch(this,this._onOkClicked));this.own(_d4,_d7,_d8,_d9,_da);},_showConfigSection:function(){_bf.setStyle(this.btnPreview,"display","block");_bf.setStyle(this.btnConfig,"display","none");this.viewStack.switchView(this.configSection);_c0.publish("showPreviewConfig");},_showPreviewSection:function(){_bf.setStyle(this.btnPreview,"display","none");_bf.setStyle(this.btnConfig,"display","block");this.viewStack.switchView(this.previewSection);_c0.publish("showPreviewMore");},startup:function(){this.inherited(arguments);this.tab.startup();},destroy:function(){this.themePane.destroy();this.mapPane.destroy();this.widgetPane.destroy();this.attributePane.destroy();this.themePane=null;this.mapPane=null;this.widgetPane=null;this.themePane=null;this.inherited(arguments);},_onSave:function(){if(!this._appHasChanged()){return;}if(appId==="stemapp"){new _cf({message:this.nls.canNotSaveMeg});return;}this._saveApp().then(_be.hitch(this,function(_db){if(_db.success){this._disableSaveButton();}}),function(){});},_enableSaveButton:function(){_bf.addClass(this.btnSave,"third-footer-button-save");_bf.setStyle(this.btnSave,"cursor","pointer");_bf.setAttr(this.btnSaveText,"innerHTML",this.nls.save);},_disableSaveButton:function(){_bf.removeClass(this.btnSave,"third-footer-button-save");_bf.setStyle(this.btnSave,"cursor","default");_bf.setAttr(this.btnSaveText,"innerHTML",this.nls.saved);},_saveApp:function(){var _dc=new _c3();xhr("/builder/rest/apps/"+appId+"/saveconfig",{data:{appConfig:JSON.stringify(this.appConfig.getCleanConfig())},method:"POST",handleAs:"json"}).then(_be.hitch(this,function(_dd){if(_dd.success){this.lastAppConfig=_be.clone(this.appConfig);_dc.resolve(_dd);}else{new _cf({message:this.nls.saveFailedMeg+": "+_dd.message});_dc.reject();}}),function(_de){new _cf({message:this.nls.saveFailedMeg});_dc.reject();});return _dc;},setAppConfig:function(_df,_e0){this.appConfig=_df;this.themePane.setAppConfig(_df,_e0);this.mapPane.setAppConfig(_df,_e0);this.widgetPane.setAppConfig(_df,_e0);this.attributePane.setAppConfig(_df,_e0);if(_e0){this.lastAppConfig=_be.clone(_df);}if(this._appHasChanged()){this._enableSaveButton();}else{this._disableSaveButton();}},_hideAllContent:function(){_bf.setStyle(this.mapPane.domNode,"display","none");_bf.setStyle(this.widgetPane.domNode,"display","none");_bf.setStyle(this.themePane.domNode,"display","none");},_initPreviewItems:function(){_bf.empty(this.previewTbody);var _e1=[];_e1.push({"class":"new-iPad",title:"The New iPad",width:768,height:1024});_e1.push({"class":"iPad-Pad2",title:"iPad & iPad2",width:768,height:1024});_e1.push({"class":"iPad-mini",title:"iPad Mini",width:768,height:1024});_e1.push({"class":"iPhone5",title:"iPhone5/5S",width:320,height:568});_e1.push({"class":"iPhone4",title:"iPhone4/4S",width:320,height:480});_e1.push({"class":"iPhone-iPodTouch",title:"iPhone & iPod Touch",width:320,height:480});_e1.push({"class":"meizu-mx2",title:"MEIZU MX2",width:400,height:640});_e1.push({"class":"htc-one",title:"HTC One",width:360,height:640});_e1.push({"class":"samsung-note-ii",title:"Samsung Note II",width:360,height:640});_e1.push({"class":"samsung-note-iii",title:"Samsung Note III",width:360,height:640});_e1.push({"class":"sony-xperia-z",title:"Sony Xperia Z",width:360,height:640});var _e2=Math.ceil(_e1.length/4);var i;for(i=0;i<_e2;i++){var _e3="<tr><td></td><td></td><td></td><td></td></tr>";var tr=_bf.toDom(_e3);_bf.place(tr,this.previewTbody);}var tds=_c2("td",this.previewTbody);for(i=0;i<_e1.length;i++){var td=tds[i];var _e4=this._createPreviewItem(_e1[i]);_bf.place(_e4,td);}},_createPreviewItem:function(_e5){var _e6="<div class=\"preview-item\">"+"<div class=\"preview-item-bg\">"+"<div class=\"preview-item-thumbnail\"></div>"+"<div class=\"preview-selected-icon\"></div>"+"</div>"+"<span class=\"preview-item-title\"></span>"+"</div>";var _e7=_bf.toDom(_e6);_e7.args=_e5;var _e8=_c2(".preview-item-bg",_e7)[0];var _e9=_c2(".preview-item-thumbnail",_e7)[0];var _ea=_c2(".preview-item-title",_e7)[0];this.own(on(_e8,"click",_be.hitch(this,this._onPreviewItemBgClick)));if(_e5["class"]){_bf.addClass(_e9,_e5["class"]);}_ea.innerHTML=_e5.title||"";return _e7;},_onPreviewItemBgClick:function(_eb){var _ec=_eb.target||_eb.srcElement;if(_bf.hasClass(_ec,"preview-item-thumbnail")){var _ed=_ec.parentNode;var _ee=_c2(".preview-item-bg",this.previewTbody);_ee.removeClass("selected");_bf.addClass(_ed,"selected");var _ef=_ed.parentNode;var _f0=_ef.args;_c0.publish("onDeviceSelected",_f0,false);}},_onOkClicked:function(){var _f1=function(num){var _f2=false;var _f3=!isNaN(num)&&!isNaN(parseFloat(num));if(_f3){var _f4=parseInt(num,10);if(_f4>0){_f2=true;}}return _f2;};var w=this.customWidth.value;var h=this.customHeight.value;if(_f1(w)&&_f1(h)){var _f5=_c2(".preview-item-bg",this.previewTbody);_f5.removeClass("selected");w=parseInt(w,10);h=parseInt(h,10);var _f6={width:w,height:h};_c0.publish("onDeviceSelected",_f6,true);}},_appHasChanged:function(){var _f7=_be.clone(this.appConfig.getCleanConfig());var _f8=_be.clone(this.lastAppConfig.getCleanConfig());if(_f7.theme&&_f7.theme.styles&&_f8.theme&&_f8.theme.styles){_f7.theme.styles.splice(1,_f7.theme.styles.length);_f8.theme.styles.splice(1,_f8.theme.styles.length);}return !_cd.isEqual(_f7,_f8);}});});},"builder/config/MapConfig":function(){define(["dojo/_base/declare","dojo/topic","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/MapConfig.html","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/query","dojo/on","dojo/keys","dojo/_base/Color","jimu/portalUtils","jimu/tokenUtils","esri/symbols/SimpleLineSymbol","esri/graphic","esri/geometry/Point","esri/geometry/Extent","esri/geometry/webMercatorUtils","jimu/dijit/Popup","./MapSelector","./ExtentSelector","dojo/i18n!../nls/builder"],function(_f9,_fa,_fb,_fc,_fd,_fe,_ff,html,_100,on,keys,_101,_102,_103,_104,_105,_106,_107,_108,_109,_10a,_10b,_10c){return _f9([_fb,_fc],{templateString:_fd,baseClass:"map-config",selectedItemId:null,defaultItemId:null,appConfig:null,map:null,mapSelector:null,postMixInProperties:function(){this.nls=_fe.mixin({},_10c.common);this.nls=_fe.mixin(this.nls,_10c.mapConfig);},postCreate:function(){this.inherited(arguments);if(window.configWindow&&window.configWindow._viewerMap){this.map=window.configWindow._viewerMap;}this._init();},destroy:function(){if(this.mapSelector&&this.mapSelector.domNode){this.mapSelector.destroy();this.mapSelector=null;}this.inherited(arguments);},_init:function(){this.own(on(this.btnAddMap,"click",_fe.hitch(this,this._showMapSelector)));this.own(_fa.subscribe("mapLoaded",_fe.hitch(this,function(map){this._setMap(map);})));this.own(_fa.subscribe("mapChanged",_fe.hitch(this,function(map){this._setMap(map);this._restoreToDefaultWebMapExtent();})));this.own(on(this.btnInitialExtent,"click",_fe.hitch(this,function(){if(this.map){var _10d=null;var _10e=this.appConfig&&this.appConfig.map.mapOptions&&this.appConfig.map.mapOptions.extent;if(_10e){_10d=new _107(_10e);}_10d=_10d?_10d:this.map.extent;var _10f=new _10b({map:this.map,initExtent:_10d});var _110=new _109({width:1024,content:_10f,titleLabel:this.nls.setInitialExtent,buttons:[{label:this.nls.ok,key:keys.ENTER,onClick:_fe.hitch(this,function(){var _111=_10f.getExtent();_fa.publish("configChanged","map",{mapOptions:{extent:_111.toJson()}},{reCreateMap:false});_110.close();})},{label:this.nls.cancel,key:keys.ESCAPE,onClick:_fe.hitch(this,function(){_110.close();})}]});}})));this.own(_fa.subscribe("userSignIn",_fe.hitch(this,this.onSignIn)));},_restoreToDefaultWebMapExtent:function(){var _112=this.map&&this.map.webMapResponse&&this.map.webMapResponse.itemInfo;if(_112){var _113=_112.item&&_112.item.extent;if(_113){var wkid=parseInt(this.map.spatialReference.wkid,10);var p1=new _106(_113[0][0],_113[0][1]);var p2=new _106(_113[1][0],_113[1][1]);if(wkid!==4326){p1=_108.geographicToWebMercator(p1);p2=_108.geographicToWebMercator(p2);}var _114=new _107(p1.x,p1.y,p2.x,p2.y,this.map.spatialReference);this.map.setExtent(_114);}}},_showMapSelector:function(){if(!this.mapSelector){this.mapSelector=new _10a({appConfig:this.appConfig});}var _115=new _109({width:1024,titleLabel:this.nls.selectWebMap,content:this.mapSelector,container:"main-page",onClose:_fe.hitch(this,function(){this.mapSelector=null;return true;}),buttons:[{label:this.nls.ok,key:keys.ENTER,onClick:_fe.hitch(this,function(){this._onMapSelectorOkClick();_115.close();this.mapSelector=null;})},{label:this.nls.cancel,key:keys.ESCAPE,onClick:_fe.hitch(this,function(){_115.close();this.mapSelector=null;})}]});if(!this.mapSelector._started){this.mapSelector.startup();this.mapSelector._started=true;}if(this.appConfig){this.mapSelector.setAppConfig(this.appConfig);}},_onMapSelectorOkClick:function(){if(!this.mapSelector){return;}var item=this.mapSelector.getSelectedMapItem();if(item&&item.id!==this.selectedItemId){this.showSelectedWebMap(item);_fa.publish("configChanged","app",{portalUrl:item.portalUrl});_fa.publish("configChanged","map",{itemId:item.id});}},_setMap:function(map){this.map=map;},onSignIn:function(){if(this.appConfig){_102.getPortal(this.appConfig.portalUrl).signIn().then(_fe.hitch(this,function(user){if(this.defaultItemId&&!this.selectedItemId){this.requestDefaultItem();}}));}},setAppConfig:function(_116){if(this.mapSelector&&this.mapSelector.domNode){this.mapSelector.setAppConfig(_116);}if(!this.appConfig){this.appConfig=_116;if(_103.userHaveSignIn(_116.portalUrl)){this.onSignIn();}if(_116.map.itemId){this.defaultItemId=_116.map.itemId;if(!this.selectedItemId){this.requestDefaultItem();}}}else{var _117=this.appConfig.portalUrl;var _118=_116.portalUrl;this.appConfig=_116;if(_103.userHaveSignIn(_116.portalUrl)){this.onSignIn();}if(this._isSamePortalUrl(_117,_118)){if(_116.map.itemId){this.defaultItemId=_116.map.itemId;if(!this.selectedItemId){this.requestDefaultItem();}}}else{this.selectedItemId=null;this.defaultItemId=_116.map.itemId;this.requestDefaultItem();}}},_isSamePortalUrl:function(_119,_11a){return _119.indexOf(_11a)>=0||_11a.indexOf(_119)>=0;},requestDefaultItem:function(){if(!this.defaultItemId||this.selectedItemId){return;}var _11b={q:"id:"+this.defaultItemId,num:10,f:"json"};var _11c=_102.getPortal(this.appConfig.portalUrl);_11c.queryItems(_11b).then(_fe.hitch(this,function(_11d){var _11e=_11d.results;if(_11e.length>0){var item=_11e[0];this.showSelectedWebMap(item);}}),_fe.hitch(this,function(err){}));},showSelectedWebMap:function(item){this.selectedItemId=item.id;if(item.thumbnailUrl){html.setStyle(this.divMapSelectedImg,"backgroundImage","url("+item.thumbnailUrl+")");}this.snippet.innerHTML=item.snippet||"";var date=new Date(item.modified);this.lastModified.innerHTML=date.toLocaleDateString();this.webMapDetails.href=item.detailsPageUrl;this.owner.innerHTML=item.owner||"";this.owner.href=item.ownerPageUrl||"";this.mapTitle.innerHTML=item.title;this.mapDescription.innerHTML=item.description||"";var as=_100("a",this.mapDescription);_ff.forEach(as,_fe.hitch(this,function(a){html.setAttr(a,"target","_blank");}));html.setStyle(this.mapNotSelectedSection,"display","none");html.setStyle(this.mapSelectedSection,"display","block");}});});},"builder/config/MapSelector":function(){define(["dojo/_base/declare","dojo/topic","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/MapSelector.html","jimu/utils","jimu/dijit/TabContainer3","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/_base/Deferred","dojo/promise/all","dojo/query","dojo/on","jimu/portalUtils","jimu/tokenUtils","jimu/portalUrlUtils","jimu/dijit/ViewStack","jimu/dijit/Search","builder/config/MapTable","dojo/i18n!../nls/builder"],function(_11f,_120,_121,_122,_123,_124,_125,_126,lang,_127,html,_128,all,_129,on,_12a,_12b,_12c,_12d,_12e,_12f,_130){return _11f([_121,_122,_123],{templateString:_124,baseClass:"map-selector",tab:null,isPublicTabShow:true,appConfig:null,_user:null,_group:null,_webMapQueryString:" type:\"Web Map\" -type:\"Web Mapping Application\"  -type:\"Layer\" -type: \"Map Document\" -type:\"Map Package\" -type:\"ArcPad Package\" -type:\"Explorer Map\" -type:\"Globe Document\" -type:\"Scene Document\" -type:\"Published Map\" -type:\"Map Template\" -type:\"Windows Mobile Package\" -type:\"Layer Package\" -type:\"Explorer Layer\" -type:\"Geoprocessing Package\" -type:\"Application Template\" -type:\"Code Sample\" -type:\"Geoprocessing Package\" -type:\"Geoprocessing Sample\" -type:\"Locator Package\" -type:\"Workflow Manager Package\" -type:\"Windows Mobile Package\" -type:\"Explorer Add In\" -type:\"Desktop Add In\" -type:\"File Geodatabase\" -type:\"Feature Collection Template\" -type:\"Code Attachment\" -type:\"Featured Items\" -type:\"Symbol Set\" -type:\"Color Set\" -type:\"Windows Viewer Add In\" -type:\"Windows Viewer Configuration\" ",_allPublicPortalQuery:null,_filterPublicPortalQuery:null,_allPublicOnlineQuery:null,_filterPublicOnlineQuery:null,_allOrganizationQuery:null,_filterOrganizationQuery:null,_allMyContentQuery:null,_filterMyContentQuery:null,_allGroupQuery:null,_filterGroupQuery:null,_signIn:false,postMixInProperties:function(){this.nls=lang.mixin({},_130.common);this.nls=lang.mixin(this.nls,_130.mapConfig);},postCreate:function(){this.inherited(arguments);this._initSearchQuery();this._initTabs();this._initPortalRadio();this._initMapTables();this._initPublic();this._initPrivate();},startup:function(){if(!this.tab._started){this.tab.startup();this.tab._started=true;}},_initTabs:function(){var _131={title:this.nls.publicMap,content:this.publicTabNode};var _132={title:this.nls.myOrganization,content:this.organizationTabNode};var _133={title:this.nls.myGroup,content:this.groupTabNode};var _134={title:this.nls.myContent,content:this.mycontentTabNode};var tabs=[_131,_132,_133,_134];this.tab=new _126({tabs:tabs},this.tabNode);this.own(on(this.tab,"tabChanged",lang.hitch(this,function(_135){html.setStyle(this.signinSection,"display","none");if(_135!==this.nls.publicMap){this.isPublicTabShow=false;this._updateUIbySignIn();}else{this.isPublicTabShow=true;}})));},_updateUIbySignIn:function(){html.setStyle(this.signinSection,"display","none");var _136=_129(".organization-tab-content-main,.group-tab-content-main,.mycontent-tab-content-main",this.domNode);var _137=_12b.userHaveSignIn(this._getPortalUrl());if(_137){_136.style("display","block");}else{_136.style("display","none");if(!this.isPublicTabShow){html.setStyle(this.signinSection,"display","block");}}},_initPortalRadio:function(){var _138=this._getPortalUrl();var _139=_12c.getServerByUrl(_138);if(_12c.isArcGIScom(_139)){this.portalPublicRaido.disabled=true;this.onlinePublicRaido.checked=true;html.setStyle(this.portalPublicRaido,"display","none");html.setStyle(this.portalServer,"display","none");}else{this.portalPublicRaido.disabled=false;this.portalPublicRaido.checked=true;this.portalServer.innerHTML=_139;}},_initSearchQuery:function(){this._allPublicPortalQuery=this._getQuery({sortField:"numViews",sortOrder:"desc",q:this._webMapQueryString+" AND access:public"});this._filterPublicPortalQuery=this._getQuery({q:this._webMapQueryString+" AND access:public"});this._allPublicOnlineQuery=this._getQuery({sortField:"numViews",sortOrder:"desc",q:"(group:\"c755678be14e4a0984af36a15f5b643e\" OR group:\"b8787a74b4d74f7fb9b8fac918735153\") "+this._webMapQueryString+" AND access:public"});this._filterPublicOnlineQuery=this._getQuery({q:this._webMapQueryString+" AND access:public"});this._allOrganizationQuery=this._getQuery();this._filterOrganizationQuery=this._getQuery();this._allMyContentQuery=this._getQuery();this._filterMyContentQuery=this._getQuery();this._allGroupQuery=this._getQuery();this._filterGroupQuery=this._getQuery();},_getQuery:function(_13a){var _13b=_13a||{};var _13c=lang.mixin({start:1,num:16,f:"json"},_13b);return _13c;},_getPortalUrl:function(){var _13d=_12b.getPortalUrl();_13d=_12c.getStandardPortalUrl(_13d);return _13d;},_initMapTables:function(){var _13e=this._getPortalUrl();if(!this.portalPublicRaido.disabled){this.publicPortalMapTable.set("portalUrl",_13e);this.publicPortalMapTable.searchAllMaps(this._allPublicPortalQuery);this.publicPortalMapTable.set("filteredQuery",this._filterPublicPortalQuery);}this.publicOnlineMapTable.set("portalUrl","http://www.arcgis.com");this.publicOnlineMapTable.searchAllMaps(this._allPublicOnlineQuery);this.publicOnlineMapTable.set("filteredQuery",this._filterPublicOnlineQuery);},_initPublic:function(){this.own(on(this.portalPublicRaido,"click",lang.hitch(this,this._onPublicRaidoClicked)));this.own(on(this.onlinePublicRaido,"click",lang.hitch(this,this._onPublicRaidoClicked)));this._onPublicRaidoClicked();},_onPublicRaidoClicked:function(){if(this.portalPublicRaido.checked){this.publicPortalMapTable.show();this.publicOnlineMapTable.hide();}else{if(this.onlinePublicRaido.checked){this.publicPortalMapTable.hide();this.publicOnlineMapTable.show();}}},_onPublicSearch:function(text){text=text&&lang.trim(text);if(text){this.publicPortalMapTable.showFilterMapsSection();this.publicOnlineMapTable.showFilterMapsSection();if(this.portalPublicRaido.checked){this._filterPublicPortalQuery.q=text+this._webMapQueryString+" AND access:public";this._filterPublicPortalQuery.start=1;this.publicPortalMapTable.searchFilteredMaps(this._filterPublicPortalQuery);}else{if(this.onlinePublicRaido.checked){this._filterPublicOnlineQuery.q=text+this._webMapQueryString+" AND access:public";this._filterPublicOnlineQuery.start=1;this.publicOnlineMapTable.searchFilteredMaps(this._filterPublicOnlineQuery);}}}else{this.publicPortalMapTable.showAllMapsSection();this.publicOnlineMapTable.showAllMapsSection();}},_initPrivate:function(){this._resetPortalMaps();this.own(_120.subscribe("userSignIn",lang.hitch(this,this._onSignIn)));this.own(_120.subscribe("userSignOut",lang.hitch(this,this._onSignOut)));this.own(on(this.btnSignIn,"click",lang.hitch(this,function(){_12b.signIn(this._getPortalUrl(),this.appConfig.appId);})));this.own(on(this.groupsSelect,"change",lang.hitch(this,this._onGroupsSelectChange)));var _13f=_12c.getServerByUrl(this._getPortalUrl());if(_12c.isArcGIScom(_13f)){_13f="ArcGIS.com";}this.signinSection.title=this.nls.signInTo+" "+_13f;var _140=_12b.userHaveSignIn(this._getPortalUrl());if(_140){this._onSignIn();}},_onOrganizationSearch:function(text){text=text&&lang.trim(text);if(text){if(this._allOrganizationQuery){var q=this._allOrganizationQuery.q;if(q){this._filterOrganizationQuery.q=text+" "+q;this._filterOrganizationQuery.start=1;this.organizationMapTable.searchFilteredMaps(this._filterOrganizationQuery);}}}else{this.organizationMapTable.showAllMapsSection();}},_onMyContentSearch:function(text){text=text&&lang.trim(text);if(text){if(this._allMyContentQuery){var q=this._allMyContentQuery.q;if(q){this._filterMyContentQuery.q=text+" "+q;this._filterMyContentQuery.start=1;this.mycontentMapTable.searchFilteredMaps(this._filterMyContentQuery);}}}else{this.mycontentMapTable.showAllMapsSection();}},_onGroupSearch:function(text){text=text&&lang.trim(text);if(text){if(this._allGroupQuery){var q=this._allGroupQuery.q;if(q){this._filterGroupQuery.q=text+" "+q;this._filterGroupQuery.start=1;this.groupMapTable.searchFilteredMaps(this._filterGroupQuery);}}}else{this.groupMapTable.showAllMapsSection();}},_onSignIn:function(){this._updateUIbySignIn();if(this._signIn){return;}this._signIn=true;var _141=this._getPortalUrl();var _142=_12a.getPortal(_141);_142.signIn().then(lang.hitch(this,function(user){this._resetPortalMaps();this._searchOrganization(user);this._searchMyContent(user);this._searchGroups(user);}));},_onSignOut:function(){this._signIn=false;this._resetPortalMaps();this._updateUIbySignIn();},_resetPortalMaps:function(){this.organizationMapTable.clear();this.mycontentMapTable.clear();this._resetGroupsSection();},_searchOrganization:function(user){this.organizationMapTable.clear();var q=" orgid:"+user.orgId+" AND "+this._webMapQueryString+" AND (access:org OR access:public) ";var _143=this._getPortalUrl();this._allOrganizationQuery=this._getQuery({q:q});this._filterOrganizationQuery=this._getQuery({q:q});this.organizationMapTable.set("portalUrl",_143);this.organizationMapTable.searchAllMaps(this._allOrganizationQuery);},_searchMyContent:function(user){this.mycontentMapTable.clear();var _144=this._getPortalUrl();var q="owner:"+user.username+" AND "+this._webMapQueryString;this._allMyContentQuery=this._getQuery({q:q});this._filterMyContentQuery=this._getQuery({q:q});this.mycontentMapTable.set("portalUrl",_144);this.mycontentMapTable.searchAllMaps(this._allMyContentQuery);},_searchGroups:function(user){this._resetGroupsSection();html.setStyle(this.groupsSection,"display","block");var _145=user.getGroups();if(_145.length>0){html.setStyle(this.groupSearch.domNode,"display","block");this.groupMapTable.show();html.empty(this.groupsSelect);for(var i=0;i<_145.length;i++){var _146=_145[i];html.create("option",{value:_146.id,innerHTML:_146.title},this.groupsSelect);}this._onGroupsSelectChange();}this._updateUIbyGroups(_145.length);},_resetGroupsSection:function(){html.setStyle(this.groupsSection,"display","none");html.empty(this.groupsSelect);html.create("option",{value:"nodata",innerHTML:this.nls.noneGroups},this.groupsSelect);this.groupMapTable.clear();html.setStyle(this.groupSearch.domNode,"display","none");this.groupMapTable.hide();this._updateUIbyGroups(0);},_updateUIbyGroups:function(_147){if(_147===0){html.setStyle(this.groupsSection,"top","15px");}else{html.setStyle(this.groupsSection,"top","70px");}},_onGroupsSelectChange:function(){var _148=this.groupsSelect.value;this.groupMapTable.clear();if(_148==="nodata"){html.setStyle(this.groupSearch,"display","none");this.groupMapTable.hide();}else{html.setStyle(this.groupSearch,"display","block");this.groupMapTable.show();var _149=this._getPortalUrl();var q="group:"+_148+" AND "+this._webMapQueryString;this._allGroupQuery=this._getQuery({q:q});this._filterGroupQuery=this._getQuery({q:q});this.groupMapTable.set("portalUrl",_149);this.groupMapTable.searchAllMaps(this._allGroupQuery);}},setAppConfig:function(_14a){this.appConfig=_14a;if(!this._signIn&&_12b.userHaveSignIn(this._getPortalUrl())){this._onSignIn();}},getSelectedMapItem:function(){var item=null;var _14b=_129(".map-item-bg.selected",this.domNode);if(_14b.length>0){var _14c=_14b[0].parentNode;item=_14c.item;}return item;}});});},"builder/config/MapTable":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/MapTable.html","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/_base/Deferred","dojo/query","dojo/on","jimu/portalUtils","jimu/tokenUtils","jimu/portalUrlUtils","jimu/dijit/LoadingIndicator","dojo/i18n!../nls/builder"],function(_14d,_14e,_14f,_150,_151,lang,_152,html,_153,_154,on,_155,_156,_157,_158,_159){return _14d([_14e,_14f,_150],{templateString:_151,baseClass:"map-table",isPublic:true,query:null,filteredQuery:null,portalUrl:null,hidden:false,nls:null,postMixInProperties:function(){this.nls=lang.mixin({},_159.common);this.nls=lang.mixin(this.nls,_159.mapConfig);},postCreate:function(){this.inherited(arguments);this.isPublic=this.isPublic===true;this.hidden=this.hidden===true;if(this.hidden){this.hide();}if(this.portalUrl){this.portalUrl=_157.getStandardPortalUrl(this.portalUrl);}this.own(on(this.allMapsTableDiv,"scroll",lang.hitch(this,this._onAllMapsSectionScroll)));this.own(on(this.filteredMapsTableDiv,"scroll",lang.hitch(this,this._onFilteredMapsSectionScroll)));this.showAllMapsSection();this.searchAllMaps();},show:function(){html.setStyle(this.domNode,"display","block");},hide:function(){html.setStyle(this.domNode,"display","none");},searchAllMaps:function(_15a){this.showAllMapsSection();if(_15a){this.query=lang.mixin({},_15a);this.query.start=1;this.clearAllMapsSection();}if(!this.portalUrl||!this.query){return;}if(this.query.start>0){this.allMapsShelter.show();var _15b=_155.getPortal(this.portalUrl);var def=_15b.queryItems(this.query);def.then(lang.hitch(this,function(_15c){this.allMapsShelter.hide();this.query.start=_15c.nextStart;this._createMapItems(_15c,this.allMapsTbody);}),lang.hitch(this,function(err){this.allMapsShelter.hide();}));}},searchFilteredMaps:function(_15d){this.showFilterMapsSection();if(_15d){this.filteredQuery=lang.mixin({},_15d);this.filteredQuery.start=1;this.clearFilteredMapsSection();}if(!this.portalUrl||!this.filteredQuery){return;}if(this.filteredQuery.start>0){this.filteredMapsShelter.show();var _15e=_155.getPortal(this.portalUrl);var def=_15e.queryItems(this.filteredQuery);def.then(lang.hitch(this,function(_15f){this.filteredMapsShelter.hide();this.filteredQuery.start=_15f.nextStart;this._createMapItems(_15f,this.filteredMapsTbody);var _160=this._getWebMapCount(this.filteredMapsTbody);if(_160===0){html.setStyle(this.filteredMapsTableDiv,"display","none");html.setStyle(this.searchNoneTipSection,"display","block");}}),lang.hitch(this,function(err){this.filteredMapsShelter.hide();var _161=this._getWebMapCount(this.filteredMapsTbody);if(_161===0){html.setStyle(this.filteredMapsTableDiv,"display","none");html.setStyle(this.searchNoneTipSection,"display","block");}}));}},clear:function(){this.clearAllMapsSection();this.clearFilteredMapsSection();},clearAllMapsSection:function(){html.empty(this.allMapsTbody);},clearFilteredMapsSection:function(){html.empty(this.filteredMapsTbody);},showAllMapsSection:function(){html.setStyle(this.allMapsSection,"display","block");html.setStyle(this.filteredMapsSection,"display","none");},showFilterMapsSection:function(){html.setStyle(this.allMapsSection,"display","none");html.setStyle(this.filteredMapsSection,"display","block");html.setStyle(this.filteredMapsTableDiv,"display","block");html.setStyle(this.searchNoneTipSection,"display","none");},_onAllMapsSectionScroll:function(){if(this._isScrollToBottom(this.allMapsTableDiv)){this.searchAllMaps();}},_onFilteredMapsSectionScroll:function(){if(this._isScrollToBottom(this.filteredMapsTableDiv)){this.searchFilteredMaps();}},_isScrollToBottom:function(div){var box=html.getContentBox(div);var a=div.scrollTop+box.h;var b=div.scrollHeight-a;return b===0;},_createMapItems:function(_162,_163){var _164=_162.results;var _165=_152.filter(_164,lang.hitch(this,function(item){return item.type.toLowerCase()==="web map";}));var _166=5;if(_165.length===0){return;}var _167={},_168;var _169=_154("td.empty",_163);var i;if(_169.length>0){var ws=_165.splice(0,_169.length);for(i=0;i<_169.length;i++){var _16a=_169[i];_168=this._createMapItem(ws[i]);_167[_168.item.id]=_168;html.place(_168,_16a);html.removeClass(_16a,"empty");}}if(_165.length===0){return;}var _16b=Math.ceil(_165.length/_166);for(i=0;i<_16b;i++){var _16c="<tr><td></td><td></td><td></td><td></td><td></td></tr>";var _16d=html.toDom(_16c);html.place(_16d,_163);var tds=_154("td",_16d);for(var j=0;j<tds.length;j++){var td=tds[j];var _16e=_165[_166*i+j];if(_16e){_168=this._createMapItem(_16e);_167[_168.item.id]=_168;html.place(_168,td);}else{html.addClass(td,"empty");}}}var _16f=this.getSelectedMapItem();if(!_16f&&this.appConfig&&this.appConfig.map.itemId){_168=_167[this.appConfig.itemId];if(_168){var _170=_154(".map-item-bg",_168);html.addClass(_170,"selected");}}},_getWebMapCount:function(_171){var _172=_154(".map-item-div",_171);return _172.length;},_createMapItem:function(_173){var str="<div class='map-item-div'>"+"<div class='map-item-bg'>"+"<div class='map-item-thumbnail'></div>"+"<a target='_blank' class='map-item-detail-icon'></a>"+"</div>"+"<span class='map-item-title'></span>"+"</div>";var _174=html.toDom(str);var _175=_154(".map-item-bg",_174)[0];var _176=_154(".map-item-thumbnail",_174)[0];var _177=_154(".map-item-title",_174)[0];var _178=_154(".map-item-detail-icon",_174)[0];_178.href=_173.detailsPageUrl;_174.item=_173;if(_173.thumbnailUrl){html.setStyle(_176,"backgroundImage","url("+_173.thumbnailUrl+")");}else{_176.innerHTML=this.nls.noneThumbnail;}this.own(on(_175,"click",lang.hitch(this,this._onMapItemBgClick)));_177.innerHTML=_173.title;return _174;},_onMapItemBgClick:function(_179){var _17a=_179.target||_179.srcElement;var _17b=_17a.parentNode;var _17c=_154(".map-item-bg",this.domNode);_17c.removeClass("selected");html.addClass(_17b,"selected");},getSelectedMapItem:function(){var item=null;var _17d=_154(".map-item-bg.selected",this.domNode);if(_17d.length>0){var _17e=_17d[0].parentNode;item=_17e.item;}return item;}});});},"builder/config/ExtentSelector":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/ExtentSelector.html","dojo/_base/lang","dojo/_base/html","dojo/on","jimu/dijit/ExtentChooser","esri/geometry/Point","esri/geometry/Extent","esri/geometry/webMercatorUtils","dojo/i18n!../nls/builder"],function(_17f,_180,_181,_182,_183,lang,html,on,_184,_185,_186,_187,_188){return _17f([_180,_181,_182],{templateString:_183,baseClass:"map-extent-selector",map:null,extentChooser:null,initExtent:null,postMixInProperties:function(){this.nls=lang.mixin({},_188.common);this.nls=lang.mixin(this.nls,_188.mapConfig);},postCreate:function(){this.inherited(arguments);var _189=this.map.webMapResponse.itemInfo.item.id;this.extentChooser=new _184({itemId:_189,initExtent:this.initExtent,style:{position:"absolute",width:"100%",height:"100%"}});this.extentChooser.placeAt(this.extentNode);this.extentChooser.startup();},getExtent:function(){return this.extentChooser.getExtent();},setExtent:function(_18a){this.extentChooser.setExtent(_18a);},restoreToDefaultWebMapExtent:function(){this.extentChooser.restoreToDefaultWebMapExtent();}});});},"builder/config/ThemeConfig":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/topic","dojo/on","dojo/aspect","dojo/mouse","dojo/query","dojo/NodeList-dom","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/ThemeConfig.html","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/dom-attr","dojo/_base/array","dojo/Deferred","dojo/request","dojo/dom","jimu/utils","dojo/i18n!../nls/builder","./ThemeManager"],function(_18b,lang,html,_18c,on,_18d,_18e,_18f,nld,_190,_191,_192,_193,_194,_195,_196,_197,_198,_199,dom,_19a,_19b,_19c){return _18b([_190,_191],{templateString:_192,themeLoadDef:undefined,constructor:function(){},postMixInProperties:function(){this.nls=_19b.themes;},startup:function(){this.inherited(arguments);this.themeManager=new _19c();this.themeLoadDef=this.themeManager.loadThemes();this.themeLoadDef.then(lang.hitch(this,function(_19d){this.initThemePage(_19d);}));this.own(_18c.subscribe("preloadWidgetsLoaded",lang.hitch(this,this.onPreloadWidgetsLoaded)));},initThemePage:function(_19e){var _19f,_1a0,_1a1,_1a2,_1a3,_1a4,_1a5,_1a6,_1a7;_197.forEach(_19e,function(_1a8){_1a5=html.create("div",{"class":"catalog-theme-content-div"},this.themeList);_19f=html.create("div",{"class":"catalog-theme-div"},_1a5);_1a6=html.create("div",{"class":"catalog-theme-name-div","innerHTML":_1a8.getLabel()},_1a5);_1a7=html.create("div",{"class":"catalog-theme-img-div"},_19f);_1a0=_193.create("img",{"src":_1a8.getIcon(),"class":"catalog-theme-img"},_1a7);_1a1=_193.create("div",{"class":"theme-cl-selected-div"},_19f);_1a2=_193.create("img",{"class":"theme-cl-selected-img","src":"/bstatic/css/images/check.png"},_1a1);on(_19f,"click",lang.hitch(this,this._onThemeChanged,_1a8.getName()));_1a3=_193.create("div",{"class":""},this.styleList);this.initStyle(_1a8,_1a3);_1a4=_193.create("div",{"class":""},this.layoutList);this.initLayout(_1a8,_1a4);_1a8.domNodes.theme=_19f;_1a8.domNodes.themeSL=_1a1;_1a8.domNodes.styleList=_1a3;_1a8.domNodes.layoutList=_1a4;},this);},initStyle:function(_1a9,_1aa){var _1ab,_1ac,_1ad,_1ae,_1af,_1b0;_1ab=_193.create("div",{"class":"style-section"},_1aa);_1ac=_193.create("div",{innerHTML:this.nls.styleTitle,"class":"style-text"},_1ab);_1b0=_193.create("div",{"class":"style-color-content"},_1ab);_197.forEach(_1a9.getStyles(),function(_1b1){_1ad=_193.create("div",{"class":"style-div"},_1b0);_195.set(_1ad,"backgroundColor",_1b1.styleColor);_1b1.domNode=_1ad;on(_1ad,"click",lang.hitch(this,this._onStyleChanged,_1b1.name));_1ae=_193.create("div",{"class":"style-selected-div"},_1ad);_1af=_193.create("img",{"class":"style-selected-img","src":"/bstatic/css/images/check.png"},_1ae);_1b1.selectedNode=_1ae;},this);html.setStyle(_1aa,"display","none");},initLayout:function(_1b2,_1b3){var _1b4,_1b5;_1b4=_193.create("div",{"class":"layout-section",id:_1b2.getName()+"-layout-section"},_1b3);_1b5=_193.create("div",{innerHTML:this.nls.layoutTitle,"class":"layout-text"},_1b4);_197.forEach(_1b2.getLayouts(),function(_1b6){this._drawLayout(_1b2,_1b6,_1b4);},this);html.setStyle(_1b3,"display","none");},_drawLayout:function(_1b7,_1b8,_1b9){var _1ba,_1bb,_1bc,_1bd,_1be;if(!_1b8.domClass){_1b8.domClass=" ";}_1ba=_193.create("div",{"class":"layout-div "+_1b8.domClass,title:_1b8.name},_1b9);if(_1b8.icon){_1be=_1b7.getUrl()+_1b8.icon;}else{_1be="/bstatic/css/images/current_layout.png";}_1bb=_193.create("img",{"class":"layout-image",src:_1be},_1ba);_1b8.domNode=_1ba;on(_1ba,"click",lang.hitch(this,this._onLayoutChanged,_1b8.name));_1bc=_193.create("div",{"class":"layout-selected-div"},_1ba);_1bd=_193.create("img",{"class":"layout-selected-img","src":"/bstatic/css/images/check.png"},_1bc);_1b8.selectedNode=_1bc;},_onStyleChanged:function(_1bf){this.changeStyle(_1bf,null,true);},_onLayoutChanged:function(_1c0){this.changeLayout(_1c0,null,true);},_onThemeChanged:function(_1c1){this.changeTheme(_1c1,true);},changeStyle:function(_1c2,_1c3,_1c4){if(!_1c3){_1c3=this.themeManager.getCurrentTheme();}if(_1c3.currentStyleName!==_1c2){if(_1c3.currentStyleName){html.removeClass(_1c3.getCurrentStyle().domNode,"style-selected");}_1c3.changeCurrentStyle(_1c2);html.addClass(_1c3.getCurrentStyle().domNode,"style-selected");if(_1c4){_18c.publish("styleChanged",lang.clone(_1c3.getCurrentStyle()));}}},changeLayout:function(_1c5,_1c6,_1c7){if(!_1c6){_1c6=this.themeManager.getCurrentTheme();}if(_1c6.currentLayoutName!==_1c5){if(_1c6.currentLayoutName){html.removeClass(_1c6.getCurrentLayout().domNode,"layout-selected");}_1c6.changeCurrentLayout(_1c5);html.addClass(_1c6.getCurrentLayout().domNode,"layout-selected");if(_1c7){this._getCurrentLayoutConfigOfTheme(_1c6).then(lang.hitch(this,function(){_18c.publish("layoutChanged",lang.clone(_1c6.getCurrentLayout()));}));}}},_getCurrentLayoutConfigOfTheme:function(_1c8){var _1c9;var _1ca=_1c8.getCurrentLayout();if(!_1ca.layoutConfig){_1c9=_1c8.loadLayoutByName(_1ca.name);}else{_1c9=new _198();_1c9.resolve(_1ca.layoutConfig);}return _1c9;},_copyThemeFromRepo:function(_1cb){var _1cc=new _198();this._getCurrentLayoutConfigOfTheme(this.themeManager.getThemeByName(_1cb)).then(lang.hitch(this,function(_1cd){_199("/builder/rest/apps/"+appId+"/copytheme",{handleAs:"json",method:"POST",data:{themeName:_1cb,layoutConfig:JSON.stringify(_1cd)}}).then(lang.hitch(this,function(res){if(res.success){_1cc.resolve();}else{_1cc.reject();}}),function(err){_1cc.reject(err);});}));return _1cc;},changeTheme:function(_1ce,_1cf){var _1d0=new _198();if(this.themeManager.currentThemeName!==_1ce){this.showLoadingCover();this._copyThemeFromRepo(_1ce).then(lang.hitch(this,function(){if(this.themeManager.currentThemeName){html.removeClass(this.themeManager.getCurrentTheme().domNodes.theme,"catalog-theme-selected");html.setStyle(this.themeManager.getCurrentTheme().domNodes.styleList,"display","none");html.setStyle(this.themeManager.getCurrentTheme().domNodes.layoutList,"display","none");}this.themeManager.changeCurrentTheme(_1ce);if(_1cf){_18c.publish("themeChanged",lang.clone(this.themeManager.getCurrentTheme()));}html.addClass(this.themeManager.getCurrentTheme().domNodes.theme,"catalog-theme-selected");html.setStyle(this.themeManager.getCurrentTheme().domNodes.styleList,"display","block");html.setStyle(this.themeManager.getCurrentTheme().domNodes.layoutList,"display","block");_1d0.resolve();}));}else{_1d0.resolve();}return _1d0;},setAppConfig:function(_1d1,_1d2){var _1d3,_1d4;this.themeLoadDef.then(lang.hitch(this,function(){if(_1d2){_197.forEach(this.themeManager.themes,function(_1d5){this.changeStyle("default",_1d5,false);this.changeLayout("default",_1d5,false);_1d5.clear();},this);this.changeTheme(_1d1.theme.name,false).then(lang.hitch(this,function(){if(_1d1.theme.styles&&_1d1.theme.styles[0]){this.changeStyle(_1d1.theme.styles[0],this.themeManager.getCurrentTheme(),false);}_1d3=dom.byId(this.themeManager.getCurrentTheme().getName()+"-layout-section");_1d4=this.themeManager.getCurrentTheme().addLayout("appLayout",_1d1.getCleanConfig(),"app-layout");if(_1d4){this._drawLayout(this.themeManager.getCurrentTheme(),_1d4,_1d3);}this.changeLayout("appLayout",this.themeManager.getCurrentTheme(),false);this.themeManager.getCurrentTheme().setAppConfig(_1d1);html.setStyle(this.themeList,"display","block");}));}else{if(this.themeManager.getCurrentTheme()){this.themeManager.getCurrentTheme().setAppConfig(_1d1);}}}));},onPreloadWidgetsLoaded:function(){this.hideLoadingCover();},showLoadingCover:function(){html.setStyle(this.coverNode,"display","block");},hideLoadingCover:function(){html.setStyle(this.coverNode,"display","none");}});});},"builder/config/ThemeManager":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/request","dojo/on","dojo/Deferred","dojo/promise/all","./Theme"],function(_1d6,_1d7,lang,_1d8,on,_1d9,all,_1da){return _1d6(null,{themes:undefined,constructor:function(){this.currentThemeName=null;this.themes=[];},loadThemes:function(){var _1db=new _1d9();_1d8("/builder/rest/themes/getall",{handleAs:"json"}).then(lang.hitch(this,function(res){if(res.success){_1d7.forEach(res.themes,function(_1dc){this.themes.push(new _1da(_1dc));},this);_1db.resolve(this.themes);}else{_1db.reject(this.themes);}}),function(err){_1db.reject(this.themes);});return _1db;},changeCurrentTheme:function(name){this.currentThemeName=name;},getCurrentTheme:function(){return this.getThemeByName(this.currentThemeName);},getThemeByName:function(_1dd){for(var i=0;i<this.themes.length;i++){if(_1dd===this.themes[i].getName()){return this.themes[i];}}}});});},"builder/config/Theme":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dojo/Deferred","dojo/promise/all","dojo/request"],function(_1de,lang,html,_1df,_1e0,all,_1e1){return _1de(null,{appConfig:undefined,currentStyleName:undefined,currentLayoutName:undefined,_manifest:undefined,constructor:function(_1e2){this._manifest=_1e2;this.domNodes={};},clear:function(){var i;this.appConfig=null;for(i=0;i<this._manifest.layouts.length;i++){if(this._manifest.layouts[i].name==="appLayout"){if(this._manifest.layouts[i].domNode){html.destroy(this._manifest.layouts[i].domNode);}this._manifest.layouts.splice(i,1);return;}}},loadLayoutByName:function(_1e3){var i,_1e4=null,_1e5=new _1e0();for(i=0;i<this._manifest.layouts.length;i++){if(this._manifest.layouts[i].name===_1e3){_1e4=this._manifest.layouts[i];break;}}if(_1e4){_1e1(this._manifest.url+_1e4.uri,{handleAs:"json"}).then(lang.hitch(this,function(_1e6){_1e4.layoutConfig=_1e6;_1e5.resolve(_1e4.layoutConfig);}),function(err){_1e5.reject("loadLayoutByName error"+err);});}else{_1e5.reject("wrong layouName when load layout config by layout name");}return _1e5;},setAppConfig:function(_1e7){this.appConfig=_1e7;},getName:function(){return this._manifest.name;},getLabel:function(){return this._manifest.label;},getIcon:function(){return this._manifest.icon;},getLayouts:function(){return this._manifest.layouts;},getStyles:function(){return this._manifest.styles;},getUrl:function(){return this._manifest.url;},getCurrentStyle:function(){return this.getStyleByName(this.currentStyleName);},getCurrentLayout:function(){return this.getLayoutByName(this.currentLayoutName);},changeCurrentStyle:function(name){this.currentStyleName=name;},changeCurrentLayout:function(name){this.currentLayoutName=name;},addLayout:function(name,_1e8,_1e9){var _1ea,_1eb,_1ec=false;var _1ed=this.getLayouts();for(_1ea=0;_1ea<_1ed.length;_1ea++){if(_1ed[_1ea].name===name){return null;}}_1eb={description:"this is current app layout",name:name,layoutConfig:_1e8,domClass:_1e9};this._manifest.layouts.push(_1eb);return _1eb;},getStyleByName:function(_1ee){var i,_1ef=null;for(i=0;i<this._manifest.styles.length;i++){if(this._manifest.styles[i].name===_1ee){_1ef=this._manifest.styles[i];break;}}return _1ef;},getLayoutByName:function(_1f0){var i,_1f1=null;for(i=0;i<this._manifest.layouts.length;i++){if(this._manifest.layouts[i].name===_1f0){_1f1=this._manifest.layouts[i];break;}}return _1f1;}});});},"builder/config/WidgetConfig":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dojo/topic","dojo/aspect","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/WidgetConfig.html","./WidgetSettingPage","./GroupSettingPage","./WidgetChoosePage","./AppWidgetsPage","jimu/utils","jimu/dijit/ViewStack","jimu/dijit/Popup","dojo/i18n!../nls/builder"],function(_1f2,lang,html,_1f3,_1f4,_1f5,on,_1f6,_1f7,_1f8,_1f9,_1fa,_1fb,_1fc,_1fd,_1fe,_1ff,_200){return _1f2([_1f6,_1f7],{templateString:_1f8,postMixInProperties:function(){this.nls=lang.mixin({},_200.common);this.nls=lang.mixin(this.nls,_200.widgets);},postCreate:function(){this.inherited(arguments);this.appWidgetsPage=new _1fc({},this.appWidgetsPageNode);this.own(_1f4.subscribe("editWidget",lang.hitch(this,this._onEditWidget)));this.own(_1f4.subscribe("chooseWidget",lang.hitch(this,this._onChooseWidget)));this.own(_1f4.subscribe("editGroup",lang.hitch(this,this._onEditGroup)));},startup:function(){this.inherited(arguments);this.appWidgetsPage.startup();},destroy:function(){this.appWidgetsPage.destroy();this.appWidgetsPage=null;this.inherited(arguments);},setAppConfig:function(_201){this.appConfig=_201;if(this.appWidgetsPage){this.appWidgetsPage.setAppConfig(_201);}if(this.widgetChoosePage){this.widgetChoosePage.setAppConfig(_201);}if(this.widgetSettingPage){this.widgetSettingPage.setAppConfig(_201);}},_onEditWidget:function(node,_202){this.widgetSettingPage=new _1f9({appConfig:this.appConfig},this.widgetSettingPageNode);this.widgetSettingPage.setting=lang.clone(_202);var _203=new _1ff({titleLabel:_202.label,content:this.widgetSettingPage,container:"main-page",buttons:[{label:this.nls.ok,onClick:lang.hitch(this.widgetSettingPage,this.widgetSettingPage.onOk)},{label:this.nls.cancel,onClick:lang.hitch(this.widgetSettingPage,this.widgetSettingPage.onCancel)}],onClose:lang.hitch(this.widgetSettingPage,this.widgetSettingPage.onClose)});html.addClass(_203.domNode,"widget-setting-popup");this.widgetSettingPage.startup();},_onChooseWidget:function(node,_204){this.widgetChoosePage=new _1fb({appConfig:this.appConfig},this.widgetChoosePageNode);this.widgetChoosePage.fromNode=node;this.widgetChoosePage.fromList=_204;new _1ff({titleLabel:"Choose Widget",content:this.widgetChoosePage,container:"main-page",buttons:[{label:this.nls.ok,onClick:lang.hitch(this.widgetChoosePage,this.widgetChoosePage.onOk)},{label:this.nls.cancel}]});this.widgetChoosePage.startup();},_onEditGroup:function(node,_205){this.groupSettingPage=new _1fa({setting:_205});new _1ff({titleLabel:_205.label,content:this.groupSettingPage,container:"main-page",buttons:[{label:this.nls.ok,onClick:lang.hitch(this.groupSettingPage,this.groupSettingPage.onOk)},{label:this.nls.cancel}]});this.groupSettingPage.startup();},_getPopupSize:function(){var box=html.getContentBox("main-page"),size={};if(box.w<=1024){size.width=box.w-20;size.height=box.h-20;}else{size.width=1024;size.height=768;}return size;}});});},"builder/config/WidgetSettingPage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dojo/Deferred","dojo/topic","dojo/aspect","dojo/on","dojo/mouse","dojo/query","dojo/NodeList-dom","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/WidgetSettingPage.html","./WidgetDefaultSettingPage","jimu/utils","jimu/WidgetManager","jimu/dijit/ViewStack","jimu/dijit/ImageChooser","jimu/dijit/LoadingIndicator","jimu/dijit/Message","dijit/form/CheckBox","dojo/i18n!../nls/builder"],function(_206,lang,html,_207,_208,_209,_20a,on,_20b,_20c,nld,_20d,_20e,_20f,_210,_211,_212,_213,_214,_215,_216,_217,_218,_219){return _206([_20d,_20e,_20f],{templateString:_210,postMixInProperties:function(){this.nls=lang.mixin({},_219.common);this.nls=lang.mixin(this.nls,_219.widgets);},startup:function(){this.inherited(arguments);this.own(on(window,"resize",lang.hitch(this,this.resize)));this.imageChooser=new _215({displayImg:this.iconNode});this.imageChooser.placeAt(this.domNode);this.own(on(this.imageChooser,"imageChange",lang.hitch(this,function(_21a){this.iconNode.fileData=_21a;})));this.init();},init:function(){this.loading=new _216();this.loading.placeAt(this.widgetSettingNode);this.initCommonAttr();this.initWidgetAttr();this.resize();},resize:function(){var box=html.getContentBox(this.domNode);html.setStyle(this.widgetSettingNode,{height:(box.h-90)+"px"});},onCancel:function(){this.onClose();this.popup.close();},onOk:function(){if(this.iconNode.fileData){this.setting.icon=this.iconNode.fileData;}this.setting.label=html.getAttr(this.labelNode,"value");if(this.settingDijit){var _21b=this.settingDijit.getConfig(true);if(_21b===false){return false;}this.setting.config=_21b;}_209.publish("configChanged",this.setting.id,this.setting);this.onClose();this.popup.close();},onAdvanced:function(evt){var _21c=this.settingDijit.getConfig(false);if(_21c===false){return false;}this.setting.config=_21c;if(this.settingDijit===this.settingDijitUI){this.settingViewStack.switchView(this.settingDijitJSON);this.settingDijit=this.settingDijitJSON;evt.target.innerHTML=this.nls.back;}else{this.settingViewStack.switchView(this.settingDijitUI);this.settingDijit=this.settingDijitUI;evt.target.innerHTML=this.nls.jsonEditor;}this.settingDijit.setConfig(this.setting.config);return false;},onClose:function(){if(this.settingViewStack){this.settingDijitUI.destroy();this.settingDijitJSON.destroy();this.settingViewStack.destroy();}else{if(this.settingDijit){this.settingDijit.destroy();}}},_onIconClick:function(){this.imageChooser.show();},initCommonAttr:function(){html.setAttr(this.iconNode,"src",this.setting.icon);html.setAttr(this.labelNode,"value",this.setting.label);},initWidgetAttr:function(){if(this.setting.hasConfig===false){this.widgetSettingNode.innerHTML="<div class=\"noconfig-info\">"+this.nls.noConfig+"</div>";return;}_213.getInstance().tryLoadWidgetConfig(this.setting).then(lang.hitch(this,function(_21d){this.setting.config=_21d;if(this.setting.hasSettingPage===false){this.loading.destroy();this.settingDijit=new _211({config:this.setting.config});html.place(this.settingDijit.domNode,this.widgetSettingNode);this.settingDijit.startup();}else{_212.checkFileExist(this.setting.folderUrl+"setting/Setting.js").then((function(_21e){if(_21e){_213.getInstance().loadWidgetSettingPage(this.setting).then((function(_21f){this.settingDijitUI=_21f;this.loading.destroy();this.settingDijitJSON=new _211({config:this.setting.config});this.settingViewStack=new _214({viewType:"dijit",views:[this.settingDijitUI,this.settingDijitJSON]},this.widgetSettingNode);this.settingViewStack.switchView(this.settingDijitUI);this.settingDijit=this.settingDijitUI;this.popup.addButton({label:this.nls.jsonEditor,onClick:lang.hitch(this,this.onAdvanced)});}).bind(this));}else{this.loading.destroy();this.settingDijit=new _211({config:this.setting.config});html.place(this.settingDijit.domNode,this.widgetSettingNode);this.settingDijit.startup();}}).bind(this));}}));},setAppConfig:function(_220){this.appConfig=_220;}});});},"builder/config/WidgetDefaultSettingPage":function(){define(["dojo/_base/declare","dijit/_WidgetBase","./JSONEditor"],function(_221,_222,_223){return _221([_222],{baseClass:"widget-default-setting",postCreate:function(){this.inherited(arguments);this.jsonEditor=new _223({json:this.config});this.jsonEditor.placeAt(this.domNode);},setConfig:function(_224){return this.jsonEditor.setJSON(_224);},getConfig:function(){return this.jsonEditor.getJSON();}});});},"builder/config/JSONEditor":function(){define(["dojo/_base/declare","dijit/_WidgetBase","ace/ace"],function(_225,_226){return _225([_226],{baseClass:"json-editor",postCreate:function(){this.inherited(arguments);this.editor=ace.edit(this.domNode);this.editor.setTheme("ace/theme/textmate");this.editor.setHighlightActiveLine(true);this.editor.setValue(JSON.stringify(this.json,null,2));this.editor.getSession().setMode("ace/mode/json");},setJSON:function(json){this.json=json;this.editor.setValue(JSON.stringify(this.json,null,2));},getJSON:function(){return JSON.parse(this.editor.getValue());}});});},"builder/config/GroupSettingPage":function(){define(["dojo/_base/declare","dojo/dom-attr","dojo/topic","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/GroupSettingPage.html","dojo/i18n!../nls/builder"],function(_227,_228,_229,_22a,_22b,_22c,_22d){return _227([_22a,_22b],{templateString:_22c,baseClass:"group-setting-page",postMixInProperties:function(){this.nls=_22d.groups;},startup:function(){this.labelNode.value=this.setting.label;},onOk:function(){this.setting.label=_228.get(this.labelNode,"value");_229.publish("configChanged",this.setting.id,this.setting);this.popup.close();},onCancel:function(){}});});},"builder/config/WidgetChoosePage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dojo/request/xhr","dojo/topic","dojo/aspect","dojo/on","dojo/Deferred","dojo/promise/all","dojo/mouse","dojo/query","dojo/NodeList-dom","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/WidgetChoosePage.html","dojo/i18n!../nls/builder","jimu/dijit/Search","jimu/WidgetManager","jimu/dijit/LoadingShelter","jimu/dijit/Message"],function(_22e,lang,html,_22f,xhr,_230,_231,on,_232,all,_233,_234,nld,_235,_236,_237,_238,_239,_23a,_23b,_23c){return _22e([_235,_236],{templateString:_237,postMixInProperties:function(){this.nls=lang.mixin({},_238.common);this.widgetManager=_23a.getInstance();},startup:function(){this.inherited(arguments);this.searchDijit=new _239({placeholder:"Widget Name",onSearch:lang.hitch(this,this.searchWidget),searchWhenInput:true},this.searchInputNode);this._getWidgets();this.own(on(window,"resize",lang.hitch(this,this.resize)));setTimeout(lang.hitch(this,function(){this.resize();}),100);this.loading=new _23b({hidden:true});this.loading.placeAt(this.domNode);this.loading.startup();},searchWidget:function(text){var _23d;if(text===""){_23d=this.allWidgets;}else{_23d=_22f.filter(this.allWidgets,function(_23e){if(_23e.name.toUpperCase().indexOf(text.toUpperCase())>-1){return true;}});}this._createWidgetNodes(_23d);},resize:function(){var box=html.getContentBox(this.domNode);var _23f=box.h-50-10;var _240=_23f-60;html.setStyle(this.searchSectionNode,{height:_23f+"px"});html.setStyle(this.widgetListNode,{height:_240+"px"});},setAppConfig:function(_241){this.appConfig=_241;},_getWidgets:function(){var q={};if(this.appConfig.map["2D"]){q.support2D=true;}if(this.appConfig.map["3D"]){q.support3D=true;}if(this.appConfig.map["2D"]&&this.appConfig.map["3D"]){q.support2D=true;q.support3D=true;}q["properties.inPanel"]=true;xhr("/builder/rest/widgets/search?q="+JSON.stringify(q),{handleAs:"json"}).then(lang.hitch(this,function(_242){if(!_242.success){return;}this.allWidgets=_242.widgets;this._createWidgetNodes(this.allWidgets);}));},_createWidgetNodes:function(_243){html.empty(this.widgetListNode);_22f.forEach(_243,function(_244){this._createWidgetNode(_244);},this);},_createWidgetNode:function(_245){var node,box,icon,_246,_247;node=html.create("div",{"class":"widget-node"},this.widgetListNode);box=html.create("div",{"class":"box"},node);_247=html.create("div",{"class":"box-border"},node);icon=html.create("img",{"class":"icon",src:_245.icon},box);_246=html.create("div",{"class":"label",innerHTML:_245.label,title:_245.label},node);var _248;if(appId==="stemapp"){_248="/webapp/";}else{_248="/apps/"+appId+"/";}node.setting={name:_245.name,label:_245.label};node.setting=lang.mixin(node.setting,_245.properties);node.setting.icon=_248+"/widgets/"+_245.name+"/images/icon.png";node.setting.uri="widgets/"+_245.name+"/Widget";node.box=box;this.own(on(node,"click",lang.hitch(this,this._onWidgetClick,node)));return node;},_onWidgetClick:function(node){if(this.fromNode.type==="addBtn"){if(html.hasClass(node,"jimu-state-selected")){html.removeClass(node,"jimu-state-selected");}else{html.addClass(node,"jimu-state-selected");}}else{_234(".jimu-state-selected",this.domNode).removeClass("jimu-state-selected");html.addClass(node,"jimu-state-selected");}},onOk:function(){var _249=_234(".jimu-state-selected",this.domNode);if(_249.length===0){new _23c({message:"Please select widget."});return;}this.loading.show();var _24a=_22f.map(_249,function(node){return lang.clone(node.setting);});var defs=[];_22f.forEach(_24a,function(_24b){defs.push(this._copyWidget(_24b));},this);all(defs).then(lang.hitch(this,function(_24c){var i;for(i=0;i<_24c.length;i++){if(!_24c[i].success){new _23c({message:_24c[i].message});this.loading.hide();return;}}this.loading.hide();_230.publish("widgetChoosePageOk",_24a,this.fromNode);this.popup.close();}));},_copyWidget:function(_24d){var _24e=0,def;this.appConfig.visitElement(lang.hitch(this,function(e){if(e.name===_24d.name){_24e++;}}));if(_24e===0){_24d.label=_24d.label;def=xhr.post("/builder/rest/apps/"+appId+"/copywidget",{data:{widgetName:_24d.name,widgetLabel:_24d.label},handleAs:"json"});}else{if(_24e>0){def=new _232();_24d.label=_24d.label+"_"+(_24e+1);def.resolve({success:true});}}return def;}});});},"builder/config/AppWidgetsPage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dojo/Deferred","dojo/topic","dojo/aspect","dojo/on","dojo/mouse","dojo/query","dojo/NodeList-dom","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AppWidgetsPage.html","./WidgetsList","./MoveableNode","jimu/utils","jimu/PoolControllerMixin","jimu/WidgetManager","jimu/dijit/ViewStack","dojo/i18n!../nls/builder"],function(_24f,lang,html,_250,_251,_252,_253,on,_254,_255,nld,_256,_257,_258,_259,_25a,_25b,_25c,_25d,_25e,_25f){return _24f([_256,_257],{templateString:_258,postCreate:function(){this.inherited(arguments);this.preloadWidgets=new _259({name:"preloadWidgets"},this.noncontrollerPreloadWidgetsNode);this.poolWidgets=new _259({name:"poolWidgets"},this.poolWidgetsListNode);this.viewStack=new _25e({viewType:"dom",views:[this.preloadWidgetsNode,this.poolWidgetsNode]});this.viewStack.placeAt(this.domNode);this.poolControllerClass=_24f([_256,_25c]);},postMixInProperties:function(){this.nls=lang.mixin({},_25f.common);this.nls=lang.mixin(this.nls,_25f.widgets);},startup:function(){this.inherited(arguments);this.viewStack.startup();this.preloadWidgets.startup();},destroy:function(){this.preloadWidgets.destroy();this.poolWidgets.destroy();this.preloadWidgets=null;this.poolWidgets=null;_250.forEach(this.controllers,function(_260){_260.destroy();});this.controllers=[];this.inherited(arguments);},setAppConfig:function(_261){if(this.appConfig&&_25b.isEqual(this.appConfig.preloadWidgets,_261.preloadWidgets)&&_25b.isEqual(this.appConfig.widgetPool,_261.widgetPool)){this.appConfig=_261;return;}_261.visitElement(function(e){if(e.widgets||!e.uri){return;}if(e.icon&&!e.icon.startWith("/")&&!e.icon.startWith("http")&&!e.icon.startWith("data")){e.icon=appPath+e.icon;}if(e.config&&typeof e.config==="string"&&!e.config.startWith("/")&&!e.config.startWith("http")){e.config=appPath+e.config;}});this.appConfig=_261;this._createControllerWidgetNodes();html.setStyle(this.noncontrollerPreloadWidgetsNode,{top:(this.controllerWidgetsHeight+20)+"px"});this.preloadWidgets.setSettings(this._getNonControllerPreloadWidgets());this.preloadWidgets.setAppConfig(this.appConfig);if(this.poolWidgets._started){if(this.controllers.length>0){this._initWidgetPool(this.controllers[0]);}else{this._initWidgetPool(null);this.viewStack.switchView(this.preloadWidgetsNode);}}},_getNonControllerPreloadWidgets:function(){var ret=[];this.appConfig.visitElement(function(_262,_263,_264,_265){if(!_262.isController&&_265){ret.push(_262);}});return ret;},_createControllerWidgetNodes:function(){_250.forEach(this.controllers,function(_266){html.destroy(_266.node);_266.destroy();},this);this.controllers=[];_250.forEach(this.appConfig.preloadWidgets.widgets,function(_267){if(_267.isController){this._createControllerWidgetNode(_267);}},this);this.controllerWidgetsHeight=118*this.controllers.length;html.setStyle(this.controllerWidgetsNode,{height:this.controllerWidgetsHeight+"px"});},_createControllerWidgetNode:function(_268){var _269=74,_26a=118;var node=html.create("div",{"class":"controller-widget"},this.controllerWidgetsNode);var _26b=new _25a({type:"widget",w:_269,h:_26a,setting:_268,listName:"controllerWidgets",style:{left:"30px"}});html.place(_26b.domNode,node);_26b.startup();var _26c=html.create("div",{"class":"action-node"},node);html.create("div",{"class":"action-text",innerHTML:this.nls.setControlledWidgets},_26c);html.create("div",{"class":"action-arrow",innerHTML:">"},_26c);var _26d=new this.poolControllerClass(_268);_26d.appConfig=this.appConfig;_26d.node=node;this.controllers.push(_26d);this.own(on(_26c,"click",lang.hitch(this,this._openWidgetPool,_26d)));},_openWidgetPool:function(_26e){if(_26e.visible===false){return;}this.currentController=_26e;this.viewStack.switchView(this.poolWidgetsNode);this.poolWidgets.controller=_26e;this.controllerLabelNode.innerHTML=_26e.label;this._initWidgetPool(_26e);if(!this.poolWidgets._started){this.poolWidgets.startup();}},_initWidgetPool:function(_26f){this.poolWidgets.setSettings(_26f?_26f.getAllConfigs():[]);this.poolWidgets.setAppConfig(this.appConfig);},_onBackWidgetsClick:function(){this._createControllerWidgetNodes();this.viewStack.switchView(this.preloadWidgetsNode);}});});},"builder/config/WidgetsList":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dojo/topic","dojo/aspect","dojo/request/xhr","dojo/on","dojo/Deferred","dojo/mouse","dojo/query","dojo/NodeList-dom","dijit/_WidgetBase","./MoveableNode","./LinkList","/bstatic/js/libs/thenBy.js"],function(_270,lang,html,_271,_272,_273,xhr,on,_274,_275,_276,nld,_277,_278,_279){var _27a=74,_27b=118,_27c=15,_27d=0,_27e=10,_27f=5,cpr;function _280(pos){return {left:pos.l+"px",top:pos.t+"px",width:pos.w+"px",height:pos.h+"px"};};var _281=_270([_277],{postCreate:function(){this.inherited(arguments);this.domNode=html.create("div",{"class":"node-margin"});if(this.node.type==="addBtn"){this.type="addMargin";}else{this.type="margin";}}});return _270([_277],{postCreate:function(){this.nodeList=new _279({name:this.name});this.own(_272.subscribe("widgetChoosePageOk",lang.hitch(this,this._onWidgetChoosePageOk)));},startup:function(){this.inherited(arguments);var box=html.getContentBox(this.domNode);this.position=html.position(this.domNode);cpr=Math.floor(box.w/(_27a+_27c));if(this.settings){this.initNodes();}},setSettings:function(_282){this.settings=_282;this.initNodes();},setAppConfig:function(_283){this.appConfig=_283;},addWidget:function(_284){var node=this.createMoveableNode("widget",_284);this.nodeList.insertNode(node);this.placeNodes();},createMoveableNode:function(type,_285){var _286=html.getContentBox(this.domNode);_286.h=Infinity;var node=new _278({type:type,w:_27a,h:_27b,setting:_285,listName:this.name,parentBox:_286});html.place(node.domNode,this.domNode);node.startup();this.bindMoveEvent(node);if(type==="group"){_273.after(node,"openGroup",lang.hitch(this,this.openGroup,node));_273.after(node,"closeGroup",lang.hitch(this,this.closeGroup,node));}node.on("removeNode",lang.hitch(this,function(){if(this.name==="poolWidgets"){if(node.gnode){this.nodeList.removeNode(node);this._reopenGroup();}else{this.nodeList.removeNode(node);}this.placeNodes();this.publishPoolChangeEvent();}else{_272.publish("configChanged",node.setting.id,node.setting);}}));this.createMarginNode(node);this.own(on(node.domNode,"click",lang.hitch(this,function(){if(type==="addBtn"||type==="widget"&&!_285.uri){_272.publish("chooseWidget",node,this.name);}})));return node;},openGroup:function(_287){var _288,_289,_28a,_28b,i,r,_28c,_28d,_28e;if(this.openedGNode&&this.openedGNode!==_287){this.openedGNode.closeGroup(this.openedGNode);}_288=_287.setting.widgets;r=this.getNodePosition(this.nodeList.getNodeIndex(_287)).r;_28d=Math.ceil(_288.length/cpr);_289=r*cpr+1;_28a=this.nodeList.getNodeByIndex(_289);_28c=this.nodeList.getCount();for(i=_28c+1;i<_289;i++){_28e=this.createMoveableNode("empty");_28e.gnode=_287;this.nodeList.insertNode(_28e,_28a);}this.openedGNode=_287;this.openedGNode.panelRow=r+1;this.createGroupPanel(r+1,_28d);_288.forEach((function(w){var _28f;_28f=this.createMoveableNode("widget",w);_28f.gnode=_287;this.nodeList.insertNode(_28f,_28a);}).bind(this));_28b=cpr*_28d-_288.length;for(i=0;i<_28b;i++){_28e=this.createMoveableNode("empty");_28e.gnode=_287;this.nodeList.insertNode(_28e,_28a);}this.placeNodes();},createGroupPanel:function(r,rows){var pos={l:_27c-10,t:(r-1)*(_27b+_27d)-10,h:_27b*rows+_27d*(rows-1),w:cpr*(_27a+_27c)-_27c+20};this.groupPanel=html.create("div",{"class":"widget-group-panel",style:_280(pos)},this.domNode);var _290=(this.openedGNode.pos.c-1)%cpr*(_27a+_27c)+_27a/2;html.create("div",{"class":"group-triangle",style:{left:_290+"px"}},this.groupPanel);this.groupPanel.type="panel";},closeGroup:function(_291){var _292=[];_291.setting.widgets=[];this.nodeList.visitNodes((function(e){if(e.gnode===_291){if(e.type!=="empty"){_291.setting.widgets.push(e.setting);}_292.push(e);}}).bind(this));_292.forEach((function(node){this.nodeList.removeNode(node);}).bind(this));if(_291.setting.widgets.length===0){this.nodeList.removeNode(_291);}else{_291.updateSmallWidgets();}this.placeNodes();html.destroy(this.groupPanel);this.openedGNode=null;},initNodes:function(){if(this.shadowNode){html.destroy(this.shadowNode);}var _293=this.settings;if(this.name==="preloadWidgets"){_293=_293.sort(firstBy(function(a,b){if(a.inPanel!==b.inPanel){return a.inPanel-b.inPanel;}else{return 0;}}).thenBy(function(a,b){if(a.uri&&!b.uri){return -1;}else{if(!a.uri&&b.uri){return 1;}else{return 0;}}}).thenBy(function(a,b){if(a.uri&&b.uri){return a.label.localeCompare(b.label);}else{if(!a.uri&&!b.uri){return a.placeholderIndex-b.placeholderIndex;}else{return 0;}}}));}else{_293=_293.sort(function(a,b){return a.index-b.index;});}var _294;if(this.openedGNode){_294=this.openedGNode.label;this.closeGroup(this.openedGNode);}this.nodeList.destroyAllNodes();if(this.name==="poolWidgets"){this.addBtn=this.createMoveableNode("addBtn");this.nodeList.insertNode(this.addBtn);}_293.forEach((function(_295){var node;if(_295.widgets){if(_295.widgets.length>0){node=this.createMoveableNode("group",_295);}else{}}else{node=this.createMoveableNode("widget",_295);}if(!node){return;}this.nodeList.insertNode(node);}).bind(this));this.nodeList.insertNode(this.createMoveableNode("empty"));this.placeNodes();if(_294){var _296=this.nodeList.getNodeByLabel(_294);if(_296){this.openGroup(_296);_296.status="open";}}},_removeActive:function(){_276(".node-margin-active",this.domNode).removeClass("node-margin-active");_276(".empty-node-active",this.domNode).removeClass("empty-node-active");_276(".node-active",this.domNode).removeClass("node-active");},bindMoveEvent:function(node){if(node.type==="addBtn"||!node.dnd){return;}_273.after(node.dnd,"onMove",(function(_297,lt,e){var _298=this.getMousePosition(e);this.mouseNode=this.getNodeByMousePosition(node,_298);this._removeActive();if(this.mouseNode&&this.mouseNode.type==="margin"){html.addClass(this.mouseNode.domNode,"node-margin-active");}else{if(this.mouseNode&&this.mouseNode.type==="empty"){html.addClass(this.mouseNode.domNode,"empty-node-active");}else{if(this.mouseNode&&(this.mouseNode.type==="group"||this.mouseNode.type==="widget")){html.addClass(this.mouseNode.domNode,"node-active");}}}}).bind(this),true);_273.after(node.dnd,"onMoveStart",(function(){this.createShadowNode(node);html.setStyle(node.boxNode,"cursor","move");}).bind(this),true);_273.after(node.dnd,"onMoveStop",(function(){var _299=false;html.setStyle(node.boxNode,"cursor","pointer");if(this.mouseNode){if(node===this.mouseNode){}else{if(this.mouseNode.type==="margin"){this.moveNodeToMargin(node,this.mouseNode);_299=true;}else{if(this.mouseNode.type==="empty"){if(this.mouseNode.gnode&&node.type==="group"){}else{this.moveNodeToEmpty(node,this.mouseNode);_299=true;}}else{if(this.mouseNode.type==="group"){if(node.type==="group"){}else{if(this.mouseNode.status==="open"){}else{if(node.gnode&&node.gnode===this.mouseNode){}else{this.moveWidgetToGroup(node,this.mouseNode);_299=true;}}}}else{if(this.mouseNode.type==="widget"){if(node.type==="group"){}else{if(node.gnode||this.mouseNode.gnode){}else{this.moveWidgetToWidget(node,this.mouseNode);_299=true;}}}}}}}this._reopenGroup();}html.destroy(this.shadowNode);if(_299){this.publishPoolChangeEvent();}this.placeNodes();}).bind(this),true);},_reopenGroup:function(){if(this.openedGNode){var _29a=this.openedGNode;this.closeGroup(_29a);if(this.nodeList.isExist(_29a)){this.openGroup(_29a);}}},getNodePosition:function(i){var pos={},r,c;r=Math.ceil(i/cpr);c=i%cpr;if(c===0){c=cpr;}pos.t=(r-1)*(_27b+_27d);pos.l=(c-1)*(_27a+_27c)+_27c;pos.w=_27a;pos.h=_27b;pos.r=r;pos.c=c;return pos;},getMarginNodePosition:function(node){var pos={},_29b=node.pos;pos.l=_29b.l-_27c/2-_27f/2;pos.t=_29b.t;pos.w=_27f;pos.h=_27b;return pos;},createMarginNode:function(node){var _29c=new _281({label:node.label,node:node});html.place(_29c.domNode,this.domNode);node.margin=_29c;return _29c;},getMousePosition:function(evt){return {x:evt.pageX-this.position.x,y:evt.pageY-this.position.y+this.domNode.scrollTop};},moveNodeToMargin:function(node,_29d){var _29e=this.getNodeByMarginNode(_29d);_276(".node-margin-active",this.domNode).removeClass("node-margin-active");if(_29e.gnode&&!node.gnode){node.gnode=_29e.gnode;}else{if(!_29e.gnode&&node.gnode){node.gnode=null;}}this.nodeList.moveNode(node,_29e);},moveNodeToEmpty:function(node,_29f){_276(".empty-node-active",this.domNode).removeClass("empty-node-active");if(_29f.gnode&&!node.gnode){node.gnode=_29f.gnode;}else{if(!_29f.gnode&&node.gnode){node.gnode=null;}}this.nodeList.moveNode(node,_29f);},getNodeByMarginNode:function(_2a0){var node;this.nodeList.visitNodes(function(e){if(e.margin===_2a0){node=e;return;}});return node;},placeNodes:function(){var _2a1,_2a2,_2a3;this.nodeList.visitNodes((function(node,i){_2a1=node.pos;_2a2=this.getNodePosition(i);node.pos=_2a2;html.setStyle(node.domNode,_280(_2a2));_2a3=this.getMarginNodePosition(node);node.margin.pos=_2a3;html.setStyle(node.margin.domNode,_280(_2a3));}).bind(this));this.nodeList.printNodeList();},moveWidgetToGroup:function(_2a4,_2a5){_2a5.addWidget(_2a4);this.nodeList.removeNode(_2a4);},moveWidgetToWidget:function(_2a6,_2a7){var _2a8;_2a8=this.createMoveableNode("group",{label:this._getGroupLabel(),widgets:[_2a6.setting,_2a7.setting]});this.nodeList.insertNode(_2a8,_2a7);this.nodeList.removeNode(_2a6);this.nodeList.removeNode(_2a7);},createShadowNode:function(node){this.shadowNode=html.create("div",{"class":"node-shadow",style:_280(html.getMarginBox(node.domNode))},this.domNode);},getNodeByMousePosition:function(_2a9,pos){var node;this.nodeList.visitNodes(function(e){if(e.type==="addBtn"){return;}if(pos.x>e.pos.l+_27e&&pos.x<e.pos.l+e.pos.w-_27e&&pos.y>e.pos.t+_27e&&pos.y<e.pos.t+e.pos.h-_27e){if(e!==_2a9){node=e;return true;}}if(pos.x>e.margin.pos.l&&pos.x<e.margin.pos.l+e.margin.pos.w&&pos.y>e.margin.pos.t&&pos.y<e.margin.pos.t+e.margin.pos.h){if(e.margin!==_2a9){node=e.margin;return true;}}});return node;},_getGroupLabel:function(){var max=-1,_2aa;this.appConfig.visitElement(lang.hitch(this,function(e){if(!e.widgets){return;}if(e.label==="New Group"){max=0;}else{if(e.label.startWith("New Group")){var _2ab=e.label.lastIndexOf("_"),i;if(_2ab>-1){i=parseInt(e.label.substr(_2ab+1,e.label.length),10);max=Math.max(max,i);}}}}));if(max===-1){_2aa="New Group";}else{_2aa="New Group_"+(max+1);}return _2aa;},_onWidgetChoosePageOk:function(_2ac,_2ad){if(_2ad.listName!==this.name){return;}if(_2ad.type==="addBtn"){if(this.name==="preloadWidgets"){return;}_271.forEach(_2ac,function(_2ae){this.addWidget(_2ae);},this);this.publishPoolChangeEvent();}else{lang.mixin(_2ad.setting,_2ac[0]);_272.publish("configChanged",_2ad.setting.id,_2ad.setting);}},publishPoolChangeEvent:function(){var _2af=[],_2b0=[];this.nodeList.visitNodes(function(node,i){if(node.type==="widget"&&!node.gnode){node.setting.index=i;_2b0.push(node.setting);}else{if(node.type==="group"){node.setting.index=i;_2af.push(node.setting);}}});_272.publish("configChanged","widgetPool",{widgets:_2b0,groups:_2af},{controllerId:this.controller.id});}});});},"builder/config/MoveableNode":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/_base/lang","dojo/on","dojo/Evented","dojo/aspect","dojo/mouse","dojo/topic","dojo/query","./Mover","dojo/dnd/move","dojo/mouse","dojo/NodeList-dom","dojo/NodeList-manipulate","dojo/i18n!../nls/builder","dijit/_WidgetBase","jimu/dijit/Message"],function(_2b1,html,lang,on,_2b2,_2b3,_2b4,_2b5,_2b6,_2b7,Move,_2b8,nld,nlm,_2b9,_2ba,_2bb){var _2bc=40,_2bd=20;return _2b1([_2ba,_2b2],{type:"",label:"",isMoving:false,isMouseDown:false,postMixInProperties:function(){this.nls=lang.mixin({},_2b9.common);this.nls=lang.mixin(this.nls,_2b9.widgets);},postCreate:function(){this.inherited(arguments);if(this.type==="addBtn"){this.label="addBtn";this.createAddBtn();}else{if(this.type==="empty"){this.label="empty";this.createEmptyNode();}else{if(this.type==="widget"){this.createWidgetNode();if(this.listName==="poolWidgets"){this.dnd=new Move.boxConstrainedMoveable(this.domNode,{handle:this.boxNode,box:this.parentBox,within:true,delay:5,mover:_2b7});this.bindMoveEvent();}}else{this.createGroupNode();if(this.listName==="poolWidgets"){this.dnd=new Move.boxConstrainedMoveable(this.domNode,{handle:this.boxNode,box:this.parentBox,within:true,delay:5,mover:_2b7});this.bindMoveEvent();}}}}html.addClass(this.domNode,"moveable");html.setStyle(this.domNode,{width:this.w+"px",height:this.h+"px"});},bindMoveEvent:function(){_2b3.after(this.dnd,"onMoveStart",(function(){this.isMoving=true;}).bind(this),true);_2b3.after(this.dnd,"onMoveStop",(function(){this.isMoving=false;}).bind(this),true);},_createWidgetIconNode:function(){this.iconNode=html.create("img",{"class":"icon",src:this.setting.icon,style:{width:_2bc+"px",height:_2bc+"px",margin:((this.w-_2bc)/2)+"px"}},this.boxNode);},_createPlaceholderNode:function(){var size=_2bc,_2be=_2bc-16;this.placeholderNode=html.create("div",{"class":"placehoder",style:{width:size+"px",height:size+"px",margin:((this.w-size)/2)+"px"}},this.boxNode);html.create("div",{"class":"placehoder-inner",innerHTML:this.setting.placeholderIndex,style:{width:_2be+"px",height:_2be+"px",lineHeight:_2be+"px",borderRadius:_2be/2+"px",margin:((size-_2be)/2-1)+"px"}},this.placeholderNode);},createWidgetNode:function(){html.addClass(this.domNode,"widget-node");this.boxNode=html.create("div",{"class":"box",style:{width:this.w+"px",height:this.w+"px"}},this.domNode);if(this.setting.uri){this._createWidgetIconNode();}else{this._createPlaceholderNode();}this.label=this.setting.label?this.setting.label:"Widget";this.name=this.setting.name?this.setting.name:"Widget";this.labelNode=html.create("div",{"class":"label",innerHTML:this.label,title:this.label},this.domNode);if(this.setting.visible===false){html.addClass(this.domNode,"hide");}this.own(on(this.boxNode,_2b4.enter,(function(){_2b5.publish("actionTriggered",this.setting.id,"highLight");if(!this.setting.uri){return;}this.editNode=this._createEditNode();this.own(on(this.editNode,"click",(function(evt){evt.stopPropagation();_2b5.publish("editWidget",this,this.setting);}).bind(this)));if(this.setting.inPanel===false){this.switchNode=this._createSwitchNode();this.own(on(this.switchNode,"click",(function(evt){evt.stopPropagation();if(this.setting.visible===false){this.setting.visible=true;html.removeClass(this.domNode,"hide");}else{this.setting.visible=false;html.addClass(this.domNode,"hide");}_2b5.publish("configChanged",this.setting.id,this.setting);}).bind(this)));}else{this.dropNode=this._createDropNode();this.own(on(this.dropNode,"click",(function(evt){evt.stopPropagation();var _2bf=new _2bb({message:this.nls.dropWidgetMessage,buttons:[{label:this.nls.ok,onClick:lang.hitch(this,function(){if(this.listName==="poolWidgets"){}else{this.setting.uri="";this.setting.label="Widget";this.setting.placeholderIndex="?";this.label="Widget";this.labelNode.innerHTML=this.label;html.destroy(this.iconNode);this._createPlaceholderNode();}this.emit("removeNode");_2bf.close();})},{label:this.nls.cancel}]});}).bind(this)));}}).bind(this)));this.own(on(this.boxNode,_2b4.leave,(function(){_2b5.publish("actionTriggered",this.setting.id,"removeHighLight");if(this.editNode){html.destroy(this.editNode);}if(this.dropNode){html.destroy(this.dropNode);}if(this.switchNode){html.destroy(this.switchNode);}}).bind(this)));},createGroupNode:function(){html.addClass(this.domNode,"group-node");this.boxNode=html.create("div",{"class":"box",style:{width:this.w+"px",height:this.w+"px"}},this.domNode);this.label=this.setting.label?this.setting.label:"Group";this.name=this.setting.name?this.setting.name:"Group";this.labelNode=html.create("div",{"class":"label",innerHTML:this.setting.label,title:this.setting.label},this.domNode);this._createSmallWidgets();this.own(on(this.boxNode,_2b4.enter,(function(){_2b5.publish("actionTriggered",this.setting.id,"highLight");this.editNode=this._createEditNode();this.own(on(this.editNode,"click",(function(evt){evt.stopPropagation();_2b5.publish("editGroup",this,this.setting);}).bind(this)));this.own(on(this.editNode,"mousedown",function(evt){evt.stopPropagation();}));this.own(on(this.editNode,"mouseup",function(evt){evt.stopPropagation();}));if(this.listName==="poolWidgets"){this.dropNode=this._createDropNode();this.own(on(this.dropNode,"click",(function(evt){var _2c0=new _2bb({message:this.nls.dropGroupMessage,buttons:[{label:this.nls.ok,onClick:lang.hitch(this,function(){this.emit("removeNode");_2c0.close();})},{label:this.nls.cancel}]});evt.stopPropagation();}).bind(this)));this.own(on(this.dropNode,"mousedown",function(evt){evt.stopPropagation();}));this.own(on(this.dropNode,"mouseup",function(evt){evt.stopPropagation();}));}}).bind(this)));this.own(on(this.boxNode,_2b4.leave,(function(){_2b5.publish("actionTriggered",this.setting.id,"removeHighLight");if(this.editNode){html.destroy(this.editNode);}if(this.dropNode){html.destroy(this.dropNode);}}).bind(this)));this.own(on(this.boxNode,"click",(function(e){e.preventDefault();e.stopPropagation();if(this.status==="open"){this.closeGroup();}else{this.openGroup();}}).bind(this)));},closeGroup:function(){this.status="close";},openGroup:function(){this.status="open";},createAddBtn:function(){html.addClass(this.domNode,"add-widget-node");var _2c1=html.create("div",{"class":"box",style:{width:this.w+"px",height:this.w+"px"}},this.domNode);html.create("img",{src:"/bstatic/css/images/add_widget.png"},_2c1);html.create("div",{"class":"label",innerHTML:"Click here to add widget"},_2c1);},createEmptyNode:function(){html.addClass(this.domNode,"empty-node");html.create("div",{"class":"box",style:{width:this.w+"px",height:this.w+"px"}},this.domNode);},_createEditNode:function(){var node=html.create("div",{"class":"edit-btn",style:{right:"4px",bottom:"4px",width:"25px",height:"25px"}},this.boxNode);return node;},_createDropNode:function(){var node=html.create("div",{"class":"drop-btn",style:{right:"3px",top:"3px",width:"10px",height:"10px"}},this.boxNode);return node;},_createSwitchNode:function(){var node=html.create("div",{"class":"switch-btn",style:{right:"3px",top:"3px",width:"15px",height:"10px"}},this.boxNode);return node;},_createSmallWidgets:function(){_2b6(".small",this.boxNode).remove();var _2c2=[],_2c3=false;if(this.setting.widgets.length>4){_2c2=this.setting.widgets.slice(0,3);_2c3=true;}else{_2c2=this.setting.widgets;_2c3=false;}_2c2.forEach((function(w){this._createSmallWidget(w);}).bind(this));if(_2c3){this._createSmallMore();}},_createSmallWidget:function(w){var _2c4;_2c4=html.create("div",{"class":"small small-widget","data-wid":w.id,style:{width:_2bd+"px",height:_2bd+"px",marginLeft:((this.w-_2bd*2)/3)+"px",marginTop:((this.w-_2bd*2)/3)+"px"}},this.boxNode);html.create("img",{src:w.icon,style:{width:_2bd+"px",height:_2bd+"px"}},_2c4);return _2c4;},_createSmallMore:function(){var node;node=html.create("div",{"class":"small small-more",style:{width:_2bd+"px",height:_2bd+"px",marginLeft:((this.w-_2bd*2)/3)+"px",marginTop:((this.w-_2bd*2)/3)+"px"}},this.boxNode);html.create("img",{src:"/bstatic/images/more_widget.png",style:{width:_2bd+"px"}},node);return node;},addWidget:function(_2c5){if(this.type!=="group"){return;}this.setting.widgets.push(_2c5.setting);this._createSmallWidgets();},updateSmallWidgets:function(){this._createSmallWidgets();},destroy:function(){if(this.margin){this.margin.destroy();}this.inherited(arguments);}});});},"builder/config/Mover":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/sniff","dojo/_base/window","dojo/dom","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/on","dojo/touch","dojo/dnd/common","dojo/dnd/autoscroll"],function(_2c6,_2c7,lang,has,win,dom,_2c8,_2c9,_2ca,on,_2cb,dnd,_2cc){has.add("ie11",function(){var rv=-1,ua="",re=null;if(navigator.appName==="Microsoft Internet Explorer"){ua=navigator.userAgent;re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!==null){rv=parseFloat(RegExp.$1);}}else{if(navigator.appName==="Netscape"){ua=navigator.userAgent;re=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!==null){rv=parseFloat(RegExp.$1);}}}return rv;});return _2c7("dojo.dnd.Mover",[_2ca],{constructor:function(node,e,host){this.node=dom.byId(node);this.marginBox={l:e.pageX,t:e.pageY};this.mouseButton=e.button;var h=(this.host=host),d=node.ownerDocument;function _2cd(e){e.preventDefault();e.stopPropagation();};this.events=[on(d,_2cb.move,lang.hitch(this,"onFirstMove")),on(d,_2cb.move,lang.hitch(this,"onMouseMove")),on(d,_2cb.release,lang.hitch(this,"onMouseUp")),on(d,"dragstart",_2cd),on(d.body,"selectstart",_2cd)];_2cc.autoScrollStart(d);if(h&&h.onMoveStart){h.onMoveStart(this);}},onMouseMove:function(e){_2cc.autoScroll(e);var m=this.marginBox;this.host.onMove(this,{l:m.l+e.pageX,t:m.t+e.pageY},e);e.preventDefault();e.stopPropagation();},onMouseUp:function(e){var _2ce=(has("webkit")&&has("mac")&&this.mouseButton===2),inIe=((has("ie")||has("ie11"))&&this.mouseButton===-1);if(_2ce||inIe?e.button===0:this.mouseButton===e.button){this.destroy();}e.preventDefault();e.stopPropagation();},onFirstMove:function(e){var s=this.node.style,l,t,h=this.host;switch(s.position){case "relative":case "absolute":l=Math.round(parseFloat(s.left))||0;t=Math.round(parseFloat(s.top))||0;break;default:s.position="absolute";var m=_2c8.getMarginBox(this.node);var b=win.doc.body;var bs=_2c9.getComputedStyle(b);var bm=_2c8.getMarginBox(b,bs);var bc=_2c8.getContentBox(b,bs);l=m.l-(bc.l-bm.l);t=m.t-(bc.t-bm.t);break;}this.marginBox.l=l-this.marginBox.l;this.marginBox.t=t-this.marginBox.t;if(h&&h.onFirstMove){h.onFirstMove(this,e);}this.events.shift().remove();},destroy:function(){_2c6.forEach(this.events,function(_2cf){_2cf.remove();});var h=this.host;if(h&&h.onMoveStop){h.onMoveStop(this);}this.events=this.node=this.host=null;}});});},"dojo/dnd/move":function(){define(["../_base/declare","../dom-geometry","../dom-style","./common","./Mover","./Moveable"],function(_2d0,_2d1,_2d2,dnd,_2d3,_2d4){var _2d5=_2d0("dojo.dnd.move.constrainedMoveable",_2d4,{constraints:function(){},within:false,constructor:function(node,_2d6){if(!_2d6){_2d6={};}this.constraints=_2d6.constraints;this.within=_2d6.within;},onFirstMove:function(_2d7){var c=this.constraintBox=this.constraints.call(this,_2d7);c.r=c.l+c.w;c.b=c.t+c.h;if(this.within){var mb=_2d1.getMarginSize(_2d7.node);c.r-=mb.w;c.b-=mb.h;}},onMove:function(_2d8,_2d9){var c=this.constraintBox,s=_2d8.node.style;this.onMoving(_2d8,_2d9);_2d9.l=_2d9.l<c.l?c.l:c.r<_2d9.l?c.r:_2d9.l;_2d9.t=_2d9.t<c.t?c.t:c.b<_2d9.t?c.b:_2d9.t;s.left=_2d9.l+"px";s.top=_2d9.t+"px";this.onMoved(_2d8,_2d9);}});var _2da=_2d0("dojo.dnd.move.boxConstrainedMoveable",_2d5,{box:{},constructor:function(node,_2db){var box=_2db&&_2db.box;this.constraints=function(){return box;};}});var _2dc=_2d0("dojo.dnd.move.parentConstrainedMoveable",_2d5,{area:"content",constructor:function(node,_2dd){var area=_2dd&&_2dd.area;this.constraints=function(){var n=this.node.parentNode,s=_2d2.getComputedStyle(n),mb=_2d1.getMarginBox(n,s);if(area=="margin"){return mb;}var t=_2d1.getMarginExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;if(area=="border"){return mb;}t=_2d1.getBorderExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;if(area=="padding"){return mb;}t=_2d1.getPadExtents(n,s);mb.l+=t.l,mb.t+=t.t,mb.w-=t.w,mb.h-=t.h;return mb;};}});return {constrainedMoveable:_2d5,boxConstrainedMoveable:_2da,parentConstrainedMoveable:_2dc};});},"builder/config/LinkList":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/_base/array"],function(_2de){return _2de(null,{headNode:null,currentNode:null,constructor:function(_2df){this.name=_2df.name;},visitNodes:function(cb){var node=this.headNode,i=1;while(node){cb(node,i);i++;node=node.next;}},destroyAllNodes:function(){var node=this.headNode,_2e0;while(node){_2e0=node.next;node.destroy();node=null;node=_2e0;}this.headNode=null;},getCount:function(){var _2e1=0;this.visitNodes(function(node,i){_2e1=i;});return _2e1;},isExist:function(node){var ret=false;this.visitNodes(function(e){if(e===node){ret=true;}});return ret;},printNodeList:function(){var str;this.visitNodes(function(node){var _2e2;if(node.type==="empty"){_2e2="empty";}else{_2e2=node.label;}if(!str){str=_2e2;}else{str+="->"+_2e2;}});},getPreNode:function(node){var _2e3;this.visitNodes(function(e){if(e.next===node){_2e3=e;}});return _2e3;},getNodeByIndex:function(_2e4){var node;this.visitNodes(function(e,i){if(i===_2e4){node=e;}});return node;},getNodeByLabel:function(_2e5){var node;this.visitNodes(function(e){if(e.label===_2e5){node=e;}});return node;},getNodeIndex:function(node){var _2e6;this.visitNodes(function(e,i){if(e===node){_2e6=i;}});return _2e6;},removeNode:function(node){var _2e7;_2e7=this.getPreNode(node);if(_2e7){_2e7.next=node.next;}else{this.headNode=node.next;}node.destroy();},removeNodeByIndex:function(_2e8){this.removeNode(this.getNodeByIndex(_2e8));},insertNode:function(node,_2e9){var _2ea,_2eb;if(typeof _2e9==="number"){_2ea=this.getNodeByIndex(_2e9);}else{_2ea=_2e9;}_2eb=this.getPreNode(_2ea);if(_2eb){_2eb.next=node;}else{this.headNode=node;}node.next=_2ea;},moveNode:function(node,_2ec){var _2ed=this.getPreNode(node),_2ee=this.getPreNode(_2ec);if(node!==_2ec&&node!==_2ee){if(_2ed){_2ed.next=node.next;}else{this.headNode=node.next;}node.next=_2ec;if(_2ee){_2ee.next=node;}else{this.headNode=node;}}}});});},"builder/config/AttributeConfig":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/topic","dojo/on","dojo/dom","dojo/aspect","dojo/mouse","dojo/query","dojo/NodeList-dom","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/AttributeConfig.html","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/dom-attr","dojo/_base/array","dojo/i18n!../nls/builder","dijit/form/Select","jimu/utils","esri/request","jimu/dijit/Popup","builder/config/AttributeSetting","jimu/dijit/Message"],function(_2ef,lang,html,_2f0,on,dom,_2f1,_2f2,_2f3,nld,_2f4,_2f5,_2f6,_2f7,_2f8,_2f9,_2fa,_2fb,_2fc,_2fd,_2fe,_2ff,_300,_301,_302,_303){return _2ef([_2f4,_2f5,_2f6],{templateString:_2f7,_onlineGeometryUrl:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",_onlineGeocodeUrl:"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",_onlinePrintTaskUrl:"http://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",_onlineRouteUrl:"http://route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",appConfig:null,startup:function(){},postMixInProperties:function(){this.inherited(arguments);this.nls=lang.mixin({},_2fd.settings);this.nls=lang.mixin(this.nls,_2fd.attributes);this.nls=lang.mixin(this.nls,_2fd.common);},postCreate:function(){this.inherited(arguments);this._bindEvents();},_bindEvents:function(){this.own(on(this.titleNode,"change",lang.hitch(this,this.onTitleChange)));this.own(on(this.subtitleNode,"change",lang.hitch(this,this.onSubtitleChange)));this.own(on(this.domNode,"click",lang.hitch(this,function(evt){this.allLinkExitEditMode();})));},init:function(_304){this.appConfig=_304||{};this.initHeader(_304);this.initLinks(_304);},setAppConfig:function(_305){this.init(_305);},initHeader:function(_306){var logo=_306.logo;if(logo){if(logo&&!logo.startWith("/")&&!logo.startWith("http")&&!logo.startWith("data")){logo="/apps/"+appId+"/"+logo;}html.setAttr(this.logoNode,"src",logo);_2fa.set(this.noLogoNode,"display","none");_2fa.set(this.logoNode,"display","block");}if(_306.title){html.setAttr(this.titleNode,"value",_306.title);}if(_306.subtitle){html.setAttr(this.subtitleNode,"value",_306.subtitle);}},onLogoClick:function(){on.emit(this.fileInput,"click",{cancelable:true,bubble:true});},onLogoChange:function(evt){if(!_2ff.file.supportHTML5()){_2fa.set(this.logoNode,"display","none");_2fa.set(this.noLogoNode,"display","block");alert("TODO: not suport file reader API");return;}_2ff.file.readFile(evt.target.files[0],"image/*",50000,lang.hitch(this,function(err,_307,_308){html.setAttr(this.logoNode,"src",_308);_2fa.set(this.noLogoNode,"display","none");_2fa.set(this.logoNode,"display","block");_2f0.publish("configChanged","app",{logo:_308});}));},onTitleChange:function(evt){_2f0.publish("configChanged","app",{title:evt.target.value});},onSubtitleChange:function(evt){_2f0.publish("configChanged","app",{subtitle:evt.target.value});},initLinks:function(_309){if(!_309.links||(_309.links.length<4)){html.setStyle(this.addLinkNode,"display","block");}else{html.setStyle(this.addLinkNode,"display","none");}_2f8.empty(this.linksListNode);if(_309.links){_309.links.forEach(lang.hitch(this,function(link){this.createLinkNode(link);}));}},getLinks:function(){var _30a=[];_2f3(".link-node",this.domNode).forEach(lang.hitch(this,function(_30b){_30a.push({label:_2f3(".name .name-div",_30b).attr("innerHTML")[0],url:_2f3(".url input",_30b).attr("value")[0]});}));return _30a;},createLinkNode:function(link,_30c){var node,name,_30d,_30e,url,_30f,_310,_311,edit,_312,_313,_314,done,_315;node=html.create("div",{"class":"link-node"},this.linksListNode);dom.setSelectable(node,false);name=html.create("div",{"class":"name"},node);_30d=html.create("div",{"class":"name-div","innerHTML":link.label},name);_315=html.create("div",{"class":"placeholder-div","innerHTML":"Double click here to edit link name"},name);_30e=html.create("input",{"class":"jimu-input name-input","placeholder":this.nls.namePlaceholder,"value":link.label},name);_311=html.create("div",{"class":"action","style":"display: none"},name);edit=html.create("div",{"class":"edit"},_311);_312=html.create("img",{"class":"edit-image","src":"/bstatic/css/images/edit_icon01.png"},edit);_314=html.create("div",{"class":"remove"},_311);_313=html.create("img",{"class":"remove-image","src":"/bstatic/css/images/delete_link.png"},_314);this.own(on(node,_2f2.enter,lang.hitch(this,function(){if(!html.hasClass(node,"node-hover")){html.addClass(node,"node-hover");}if(!html.hasClass(name,"node-hover")){html.addClass(name,"node-hover");}})));this.own(on(node,_2f2.leave,lang.hitch(this,function(){if(html.hasClass(node,"node-hover")){html.removeClass(node,"node-hover");}if(html.hasClass(name,"node-hover")){html.removeClass(name,"node-hover");}})));this.own(on(name,_2f2.enter,lang.hitch(this,function(){html.setStyle(_311,"display","block");})));this.own(on(name,_2f2.leave,lang.hitch(this,function(){if(_2fa.get(url,"display")==="none"){html.setStyle(_311,"display","none");}})));this.own(on(name,"click",lang.hitch(this,function(evt){evt.stopPropagation();})));this.own(on(edit,"click",lang.hitch(this,function(evt){this.editMode(_30d,_315,_30e,_311,url,edit);this._activeNode(node);evt.stopPropagation();})));this.own(on(_314,"click",lang.hitch(this,function(){html.destroy(node);if(this.getLinks().length<4){html.setStyle(this.addLinkNode,"display","block");}_2f0.publish("configChanged","app",{links:this.getLinks()});})));this.own(on(name,"dblclick",lang.hitch(this,function(_316,_317){this.allLinkExitEditMode();this.editMode(_316,_315,_317,_311,url,edit);this._activeNode(node);},_30d,_30e,_315)));this.own(on(_30e,"dblclick",lang.hitch(this,function(evt){evt.stopPropagation();})));this.own(on(_30e,"keydown",lang.hitch(this,function(evt){if(evt.keyCode===13){this.exitEditMode(_30d,_315,_30e,_311,url,edit);_2f0.publish("configChanged","app",{links:this.getLinks()});evt.stopPropagation();}})));url=html.create("div",{"class":"url"},node);if(link.label){html.setStyle(_30d,"display","block");html.setStyle(_315,"display","none");html.setStyle(_30e,"display","none");html.setStyle(url,"display","none");}else{html.setStyle(_30d,"display","none");html.setStyle(_315,"display","none");html.setStyle(_30e,"display","block");html.setStyle(url,"display","block");html.setStyle(_311,"display","block");_2f9.add(edit,"editting");_30e.focus();}if(!link.label&&_30c==="edit"){this.editMode(_30d,_315,_30e,_311,url,edit);this._activeNode(node);}else{this.exitEditMode(_30d,_315,_30e,_311,url,edit);}_30f=html.create("div",{"class":"url-content"},url);_310=html.create("input",{"class":"url-input jimu-input","placeholder":this.nls.urlPlaceholder,"value":link.url},_30f);done=html.create("div",{"class":"url-save","innerHTML":"<img src=\"/bstatic/css/images/save01.png\"></img>"},_30f);this.own(on(url,"click",lang.hitch(this,function(evt){evt.stopPropagation();})));this.own(on(url,"keydown",lang.hitch(this,function(evt){if(evt.keyCode===13){this.exitEditMode(_30d,_315,_30e,_311,url,edit);_2f0.publish("configChanged","app",{links:this.getLinks()});evt.stopPropagation();}})));this.own(on(done,"click",lang.hitch(this,function(evt){this.exitEditMode(_30d,_315,_30e,_311,url,edit);_2f0.publish("configChanged","app",{links:this.getLinks()});evt.stopPropagation();})));},onAddLinkClick:function(evt){this.allLinkExitEditMode();this.createLinkNode({label:"",url:""},"edit");if(_2f3(".link-node",this.domNode).length===4){html.setStyle(this.addLinkNode,"display","none");}else{html.setStyle(this.addLinkNode,"display","block");}evt.stopPropagation();},_activeNode:function(node){if(!html.hasClass(node,"node-active")){html.addClass(node,"node-active");}},editMode:function(_318,_319,_31a,_31b,url,edit){_2fa.set(_318,"display","none");_2fa.set(_319,"display","none");_2fa.set(_31a,"display","block");_2fb.set(_31a,"value",_2fb.get(_318,"innerHTML"));html.setStyle(_31b,"display","block");_2fa.set(url,"display","block");_2f9.add(edit,"editting");_31a.focus();_31a.select();},exitEditMode:function(_31c,_31d,_31e,_31f,url,edit){var _320=_2fb.get(_31e,"value");_2fa.set(_31e,"display","none");if(_320){_2fa.set(_31c,"display","block");}else{_2fa.set(_31d,"display","block");}_2fb.set(_31c,"innerHTML",_320);html.setStyle(url,"display","none");html.setStyle(_31f,"display","none");_2f9.remove(edit,"editting");},allLinkExitEditMode:function(){var _321=false;_2f3(".link-node",this.domNode).forEach(lang.hitch(this,function(_322){var _323=_2f3(".name-div",_322)[0];var _324=_2f3(".placeholder-div",_322)[0];var _325=_2f3(".name-input",_322)[0];var _326=_2f3(".action",_322)[0];var url=_2f3(".url",_322)[0];var edit=_2f3(".edit",_322)[0];if(html.getStyle(url,"display")!=="none"){_321=true;}this.exitEditMode(_323,_324,_325,_326,url,edit);}));if(_321){_2f0.publish("configChanged","app",{links:this.getLinks()});}},onSettingButtonClick:function(){var _327=new _302({appConfig:this.appConfig});var _328=true;var _329=new _301({width:1044,titleLabel:_327.nls.lSettings,content:_327,container:document.body,onClose:function(){if(_328){_327.destroy();}return _328;},buttons:[{label:this.nls.ok,onClick:lang.hitch(this,function(){_328=false;var def=_327.save();def.then(lang.hitch(this,function(){_328=true;_329.close();}),lang.hitch(this,function(err){_328=true;new _303({message:err});}));})},{label:this.nls.cancel}]});}});});},"builder/config/AttributeSetting":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/AttributeSetting.html","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/_base/Deferred","dojo/query","dojo/on","dojo/topic","dijit/form/Select","esri/request","jimu/portalUtils","jimu/portalUrlUtils","dojo/i18n!../nls/builder","jimu/dijit/Message","jimu/dijit/LoadingShelter","dojo/dom-style","dojo/dom-class","dojo/NodeList-dom"],function(_32a,_32b,_32c,_32d,_32e,lang,_32f,html,_330,_331,on,_332,_333,_334,_335,_336,_337,_338,_339,_33a,_33b,_33c){return _32a([_32b,_32c,_32d],{templateString:_32e,baseClass:"setting",label:"setting",itemId:null,shelter:null,appConfig:null,adSettings:null,_onlineGeometryUrl:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",_onlineGeocodeUrl:"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",_onlinePrintTaskUrl:"http://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",_onlineRouteUrl:"http://route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",postMixInProperties:function(){this.nls=lang.mixin({},_337.common);this.nls=lang.mixin(this.nls,_337.settings);},postCreate:function(){this.inherited(arguments);this.adSettings=_331(".advanced-setting-hide",this.domNode);this.advance.value=this.nls.showAdSetting;this.shelter=new _339({hidden:true});this.shelter.placeAt(this.domNode);this.shelter.startup();this.own(on(this.btnLoadHelperServices,"click",lang.hitch(this,this._loadAndSaveHelperServices)));this.initSetting(this.appConfig);},_getStandardPortalUrl:function(evt){if(evt.target.value){if(_336.isArcGIScom(this.portalUrl.value)){this.portalUrl.value=_336.getStandardPortalUrl(this.portalUrl.value);}}},initSetting:function(_33d){this.shelter.show();this.portalUrl.value=_33d.portalUrl||"";if(_33d.geometryService){this.geoServiceUrl.value=_33d.geometryService.url||"";}if(_33d.geocodeService){this.geocodeServiceUrl.value=_33d.geocodeService.url||"";}if(_33d.routeService){this.routeServiceUrl.value=_33d.routeService.url||"";}if(_33d.printTask){this.printTaskUrl.value=_33d.printTask.url||"";}this.proxyUrl.value=_33d.httpProxy||"";this.bing.value=_33d.bingMapsKey||"";this.appId.value=_33d.appId||"";var _33e=_33d.locale||"";this.localeSelect.set("value",_33e);if(_33d.map.itemId){this.itemId=_33d.map.itemId||"";}if(!this.shelter.hidden){this.shelter.hide();}},_requestPortal:function(){var url=this.portalUrl.value;if(!url.endWith("/")){url+="/";}url+="sharing/rest/portals/self?f=pjson";var def=_334({sync:true,url:url,handleAs:"json",callbackParamName:"callback",timeout:10000},{useProxy:false});return def;},_verified:function(){this.shelter.show();var _33f=new _330();if(!_336.isSamePortalUrl(this.portalUrl.value,this.appConfig.portalUrl)){var def=this._requestPortal();def.then(lang.hitch(this,function(){var def2=_335.getDefaultWebMap(this.portalUrl.value);def2.then(lang.hitch(this,function(id){this.shelter.hide();_33f.resolve(id);}),lang.hitch(this,function(){this.shelter.hide();_33f.reject(this.nls.webMapError+": "+this.portalUrl.value);}));}),lang.hitch(this,function(_340){this.shelter.hide();_33f.reject(this.nls.loadServiceError);}));}else{var _341=setTimeout(function(){clearTimeout(_341);_33f.resolve(this.itemId);},500);}return _33f;},_loadAndSaveHelperServices:function(){this.shelter.show();var def=this._requestPortal();def.then(lang.hitch(this,function(_342){var _343=_342.helperServices;if(!_343){this.shelter.hide();return;}var _344=[];var _345=this._onlineGeometryUrl;if(_343.geometry&&_343.geometry.url){_345=_343.geometry.url;}_344.push({name:"geoServiceUrl",newValue:_345});var _346=this._onlineGeocodeUrl;if(_343.geocode&&_343.geocode.length>0){var _347=_343.geocode[0];if(_347&&_347.url){_346=_347.url;}}_344.push({name:"geocodeServiceUrl",newValue:_346});var _348=this._onlinePrintTaskUrl;if(_343.printTask&&_343.printTask.url){_348=_343.printTask.url;}_344.push({name:"printTaskUrl",newValue:_348});var _349=this._onlineRouteUrl;if(_343.route&&_343.route.url){_349=_343.route.url;}_344.push({name:"routeServiceUrl",newValue:_349});if(_344.length>0){var _34a={};_32f.forEach(_344,lang.hitch(this,function(info){_34a[info.name]=info.newValue;}));_32f.forEach(_344,lang.hitch(this,function(info){this[info.name].value=info.newValue;}));this.shelter.hide();}else{this.shelter.hide();}}),lang.hitch(this,function(_34b){this.shelter.hide();new _338({message:this.nls.loadServiceError});}));},_onAdvancedClick:function(evt){this.adSettings.toggleClass("advanced-setting-hide");var _34c=this.adSettings.every(function(itm,idx){return !_33b.contains(itm,"advanced-setting-hide");});if(_34c){evt.target.value=this.nls.hideAdSetting;}else{evt.target.value=this.nls.showAdSetting;}},save:function(_34d){var def=new _330();var _34e=this._verified();_34e.then(lang.hitch(this,function(wmId){_332.publish("configChanged","app",{portalUrl:_336.getStandardPortalUrl(this.portalUrl.value),geometryService:{url:this.geoServiceUrl.value},geocodeService:{url:this.geocodeServiceUrl.value},routeService:{url:this.routeServiceUrl.value},printTask:{url:this.printTaskUrl.value},httpProxy:this.proxyUrl.value,bingMapsKey:this.bing.value,appId:this.appId.value,locale:this.localeSelect.get("value")});if(wmId){_332.publish("configChanged","map",{itemId:wmId});}def.resolve();}),lang.hitch(this,function(err){def.reject(err);}));return def;}});});},"builder/config/TabContainer2":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/on","dojo/Evented","dojo/query","dojo/NodeList-manipulate","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/TabContainer2.html","jimu/dijit/ViewStack","dojo/i18n!../nls/builder"],function(_34f,lang,_350,html,on,_351,_352,nlm,_353,_354,_355,_356,_357){return _34f([_353,_354,_351],{templateString:_355,_controlNodes:null,selected:"",tabs:null,"class":"jimu-tab2",postMixInProperties:function(){this.nls=lang.mixin({},_357.common);this.nls=lang.mixin(this.nls,_357.leftPane);},postCreate:function(){this.inherited(arguments);this._controlNodes=[];this.viewStack=new _356(null,this.containerNode);_350.forEach(this.tabs,function(_358){this._createTab(_358);},this);},startup:function(){if(this.selected){this.selectTab(this.selected);}else{if(this.tabs.length>0){this.selectTab(this.tabs[0].title);}}},_createTab:function(_359){var _35a="<td>"+"<div class=\"tab-item-div\">"+"<div class=\"tab-item-icon\"></div>"+"<div class=\"tab-item-title\"></div>"+"<div class=\"tab-item-arrow\"></div>"+"</div>"+"</td>";var _35b=html.toDom(_35a);html.place(_35b,this.tabTr);var _35c=_352(".tab-item-div",_35b)[0];var _35d=_352(".tab-item-icon",_35b)[0];var _35e=_352(".tab-item-title",_35b)[0];_35e.innerHTML=_359.title||"";var t=_359.title;if(t===this.nls.themes){html.addClass(_35d,"themes");}else{if(t===this.nls.map){html.addClass(_35d,"map");}else{if(t===this.nls.widgets){html.addClass(_35d,"widgets");}else{if(t===this.nls.attributes){html.addClass(_35d,"attributes");}}}}if(_359.content.domNode){this.viewStack.viewType="dijit";}else{this.viewStack.viewType="dom";}_35c.label=_359.title;_359.content.label=_359.title;this.viewStack.addView(_359.content);this.own(on(_35c,"click",lang.hitch(this,this.onSelect,_359.title)));this._controlNodes.push(_35c);},onSelect:function(_35f){this.selectTab(_35f);},selectTab:function(_360){_350.forEach(this._controlNodes,lang.hitch(this,function(_361){html.removeClass(_361,"selected-tab-item-div");if(_361.label===_360){html.addClass(_361,"selected-tab-item-div");}}));this.viewStack.switchView(_360);this.emit("tabChanged",_360);}});});},"builder/AppOperMenu":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/html","dojo/request","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AppOperMenu.html","dojo/on","dojo/query","dojo/dom-style","dojo/dom-attr","dojo/dom","dojo/_base/lang","dojo/i18n!./nls/builder","jimu/dijit/Popup","jimu/dijit/Message","builder/CreateApp","./AGOLTemplate/AGOLTemplate","jimu/ConfigManager","jimu/dijit/LoadingShelter"],function(_362,_363,html,_364,_365,_366,_367,on,_368,_369,_36a,dom,lang,_36b,_36c,_36d,_36e,_36f,_370,_371){return _362([_365,_366],{templateString:_367,baseClass:"app-menu",app:undefined,isShow:false,position:{},itemDefaultColor:"#ffffff",appListWidget:undefined,loadingDiv:null,_downloadUrl:null,postMixInProperties:function(){this.nls=lang.mixin({},_36b.common);this.nls=lang.mixin(this.nls,_36b.apps);},postCreate:function(){this.hide();this._downloadUrl="/builder/rest/apps/"+this.app.id+"/download";html.setAttr(this.downloadLinkNode,"href",this._downloadUrl);this.own(on(this.downloadLinkNode,"click",lang.hitch(this,function(){this.hide();})));},refresh:function(){var _372=dom.byId("list-section");var pos1=html.position(this.posNode);var pos2=html.position(_372);var pos={l:pos1.x-pos2.x,t:pos1.y-pos2.y};var _373=html.getStyle(_372,"height");var _374=pos2.y+_373;var _375=html.getStyle(this.domNode,"height");var _376=pos1.y+_375;html.setStyle(this.upTriangle,"display","block");html.setStyle(this.downTriangle,"display","none");if(_376+30>_374){pos.t=pos.t-_375-66;html.setStyle(this.upTriangle,"display","none");html.setStyle(this.downTriangle,"display","block");}html.setStyle(this.domNode,{top:pos.t+52+"px",right:"2px"});},show:function(){this.refresh();html.setStyle(this.domNode,"display","block");this.isShow=true;},hide:function(){html.setStyle(this.domNode,"display","none");this.isShow=false;},removeApp:function(_377){return _364("/builder/rest/apps/removeapp",{handleAs:"json",method:"POST",data:{"id":_377}});},duplicateApp:function(){return _364("/builder/rest/apps/duplicateapp",{handleAs:"json",method:"POST",data:{"name":this.app.name,"description":this.app.description,"id":this.app.id}});},_onMenuClick:function(evt){evt.stopPropagation();},_onCreateFromHereClick:function(){var _378=html.create("div",{"id":"app-create-popup"},this.appListWidget.createApp);new _36e({appListWidget:this.appListWidget,apps:this.apps,createFromId:this.app.id,is3D:this.app.is3D},_378);this.hide();},_onCreateFromHereMouseover:function(){html.addClass(this.createFromHere,"item-mouseover");},_onCreateFromHereMouseout:function(){html.removeClass(this.createFromHere,"item-mouseover");},_onRemoveClick:function(){var _379=new _36c({content:this.nls.confirmRemoveApp,titleLabel:this.nls.removeAppTitle,width:"425",height:"200",buttons:[{label:this.nls.ok,onClick:lang.hitch(this,function(){this.removeApp(this.app.id).then(lang.hitch(this,function(res){_379.close();if(res.success){if(res.apps!=={}){this.appListWidget.refresh(res.apps);}}else{}}),function(){});})},{label:this.nls.cancel,onClick:lang.hitch(this,function(){_379.close();})}]});},_onRemoveMouseover:function(){html.addClass(this.remove,"item-mouseover");},_onRemoveMouseout:function(){html.removeClass(this.remove,"item-mouseover");},_onDuplicateClick:function(){var _37a=new _371();_37a.placeAt(this.appListWidget.domNode);_37a.startup();this.duplicateApp().then(lang.hitch(this,function(res){_37a.destroy();if(res.success){if(res.apps!=={}){this.appListWidget.refresh(res.apps);}}else{}}),function(){});this.hide();},_onDuplicateMouseover:function(){html.addClass(this.duplicate,"item-mouseover");},_onDuplicateMouseout:function(){html.removeClass(this.duplicate,"item-mouseover");},_onEditClick:function(){var _37b=html.create("div",{"class":"edit-app-info-content"}),_37c,_37d,_37e,_37f;_37c=html.create("div",{"class":"app-name"},_37b);_37d=html.create("input",{value:this.app.name},_37c);_37e=html.create("div",{"class":"app-description"},_37b);_37f=html.create("textarea",{value:this.app.description,placeholder:this.nls.appDesc},_37e);var _380=new _36c({content:_37b,container:"main-page",titleLabel:this.nls.editAppInfo,width:"700",height:"338",buttons:[{label:this.nls.ok,onClick:lang.hitch(this,function(){var func=lang.hitch(this,this._onEditPageOk,_37d.value,_37f.value);if(this.app.name!==_37d.value||this.app.description!==_37f.value){func();}html.destroy(_37b);_380.close();})},{label:this.nls.cancel,onClick:function(){html.destroy(_37b);_380.close();}}]});var _381=_368(".line",_380.domNode)[0];html.destroy(_381);},_onEditPageOk:function(name,desc){this.app.name=name;this.app.description=desc;this.appListWidget.updateApp(this.app).then(lang.hitch(this,function(res){if(res.success===true){this.app.lastUpdated=res.lastUpdated;this.appListWidget.refresh(this.apps);}else{}}),function(err){});},_onEditMouseover:function(){html.addClass(this.editAppInfo,"item-mouseover");},_onEditMouseout:function(){html.removeClass(this.editAppInfo,"item-mouseover");},_onDownloadClick:function(){},_onDownloadMouseover:function(){html.addClass(this.download,"item-mouseover");},_onDownloadMouseout:function(){html.removeClass(this.download,"item-mouseover");},_onAgolTemplateClick:function(){var _382=_368("#main-page")[0];var _383=html.create("div",{},_382);jimuConfig.widgetsPackage={name:"widgets",location:"/apps/"+this.app.id+"/widgets"};_370.getInstance({config:"/apps/"+this.app.id+"/config.json"}).loadConfig().then(lang.hitch(this,function(_384){var _385=_384.getCleanConfig();_385.visitElement=_384.visitElement;_385.visitElement(function(e){if(!e.widgets&&e.uri&&e.visible===undefined){e.visible=true;}});delete _385.visitElement;new _36f({appConfig:_385,fullAppConfig:_384,app:this.app},_383);}));this.hide();},_onAgolTemplateMouseover:function(){html.addClass(this.agolTemplate,"item-mouseover");},_onAgolTemplateMouseout:function(){html.removeClass(this.agolTemplate,"item-mouseover");}});});},"builder/AGOLTemplate/AGOLTemplate":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/html","dojo/request","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/AGOLTemplate.html","dojo/on","dojo/dom","dojo/_base/lang","dojo/dom-construct","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dojo/json","dojo/query","dojo/Deferred","dojo/i18n!../nls/builder","dijit/form/Select","esri/request","require","./ConfigNode","./Category","./CategoryManager","./ShowJsonCodePage","./utils","jimu/utils","jimu/WidgetManager","jimu/dijit/Message","jimu/dijit/Popup"],function(_386,_387,html,_388,_389,_38a,_38b,on,dom,lang,_38c,_38d,_38e,_38f,Json,_390,_391,_392,_393,_394,_395,_396,_397,_398,_399,_39a,_39b,_39c,_39d,_39e){return _386([_389,_38a],{templateString:_38b,baseClass:"agol-template",configTree:null,nls:null,lastTemplateJson:null,postMixInProperties:function(){this.nls=lang.mixin({},_392.common);this.nls=lang.mixin(this.nls,_392.agolTemplate);},postCreate:function(){dom.setSelectable(this.frontDiv,false);this.showJsonWidget=new _399({},this.showJsonContentDiv);this.configTree=new _396(this.appConfig,null,"app","",0);this.categoryManager=new _398(this.configTree,this.appConfig,this.app.agolTemplateJson);this.drawTree(this.configTree,this.treePart);this.drawCategoryPart();this.lastTemplateJson=this.categoryManager.getTemplateJson();},drawTree:function(root,_39f){var _3a0,i;_3a0=this.drawDomNode(root,_39f);if(root.childs.length===0){return;}for(i=0;i<root.childs.length;i++){this.drawTree(root.childs[i],_3a0);}},drawDomNode:function(node,_3a1){var _3a2,_3a3,_3a4,_3a5,_3a6,_3a7,_3a8,_3a9,_3aa;_3aa=this.categoryManager.getCategoryByField(node.absolutePath);_3a2=_38c.create("div",{"class":"tree-node-div"},_3a1);if(node.nodeType==="leaf"&&!_3aa){_38d.set(_3a2,"color","#cccccc");}if(node.nodeType!=="leaf"){_3a4=_38c.create("div",{"class":"show-subnode-div"},_3a2);_3a5=_38c.create("img",{"class":"show-subnode-img",src:"/bstatic/css/images/v_right.png",alt:"img"},_3a4);}_3a6=_38c.create("span",{"class":"line-label-span",innerHTML:node.label?node.label:node.keyString},_3a2);if(_3aa&&node.nodeType==="leaf"){_3a7=_38c.create("div",{"class":"to-right-div"},_3a2);_3a8=_38c.create("img",{"class":"to-right-img",src:"/bstatic/css/images/add_field.png",alt:"img"},_3a7);this.own(on(_3a7,"click",lang.hitch(this,function(evt){_38d.set(_3a7,"display","none");this._onToRightDiv(node,"add",_3a2);evt.stopPropagation();})));if((_3aa.findFieldFromDisplay(node.absolutePath)!==-1)){_38d.set(_3a7,"display","none");}}_3a9=node.level*12;if(node.nodeType==="leaf"){_38d.set(_3a2,"padding-left",_3a9+17+"px");}else{_38d.set(_3a2,"padding-left",_3a9+"px");}_3a3=_38c.create("div",{"class":"tree-node-subdiv"},_3a1);_38d.set(_3a3,"display","none");if(node.nodeType!=="leaf"){_38d.set(_3a2,"cursor","pointer");this.own(on(_3a2,"click",lang.hitch(this,function(node,_3ab,_3ac){if(_38d.get(_3ab,"display")==="none"){_38d.set(_3ab,"display","block");_38f.set(_3ac,"src","/bstatic/css/images/v.png");}else{_38d.set(_3ab,"display","none");_38f.set(_3ac,"src","/bstatic/css/images/v_right.png");}if((node.absolutePath.search(/widgets\[[0-9]+\]_config$/)!==-1)&&!node.jsonObject){this.addWidgetConfigToConfigTree(node.absolutePath);}},node,_3a3,_3a5)));}else{if(_3aa){_38d.set(_3a2,"cursor","pointer");this.own(on(_3a2,"click",lang.hitch(this,function(node,evt){this._onToRightDiv(node,"notAdd",_3a2);evt.stopPropagation();},node)));}}node.lineDomNode=_3a2;node.subLineDomNode=_3a3;node.showSubDivDomNode=_3a4;node.toRightDiv=_3a7;if(node.level===0){html.setStyle(_3a2,"display","none");html.setStyle(_3a3,"display","block");}return _3a3;},drawCategoryPart:function(){_387.forEach(this.categoryManager.displayCategorys,function(_3ad){this.drawCategory(_3ad);},this);},drawCategory:function(_3ae){var _3af,_3b0,_3b1,_3b2,_3b3;var _3b4,_3b5,_3b6,_3b7,_3b8;_3af=_38c.create("div",{"class":"category-div","categoryDiv":_3ae.name},this.categoryPart);_3b3=_38c.create("div",{"class":"category-head-div","categoryHeadDiv":_3ae.name},_3af);_3b7=_38c.create("div",{"class":"category-fold-div"},_3b3);_3b8=_38c.create("img",{"class":"category-fold-img","src":"/bstatic/css/images/v_right.png","alt":"img"},_3b7);_3b0=_38c.create("div",{"class":"category-title-div","innerHTML":_3ae.title},_3b3);_3b1=_38c.create("div",{"class":"category-oper-div "},_3b3);_3b4=_38c.create("div",{"class":"category-oper-item-div category-moveup-div","innerHTML":"<img src='/bstatic/css/images/moveup.png' alt='img'></img>"},_3b1);_3b5=_38c.create("div",{"class":"category-oper-item-div category-movedown-div","innerHTML":"<img src='/bstatic/css/images/movedown.png' alt='img'></img>"},_3b1);_3b6=_38c.create("div",{"class":"category-oper-item-div category-remove-div","innerHTML":"<img src='/bstatic/css/images/delete01.png' alt='img'></img>"},_3b1);_3b2=_38c.create("div",{"class":"fields-div","fieldsDiv":_3ae.name},_3af);this.own(on(_3b4,"click",lang.hitch(this,function(evt){var _3b9=this.categoryManager.moveup(_3ae);if(_3b9){_38c.empty(this.categoryPart);this.drawCategoryPart();}this._changeHeighlightCategoryHead(_3ae.name);evt.stopPropagation();})));this.own(on(_3b5,"click",lang.hitch(this,function(evt){var _3ba=this.categoryManager.movedown(_3ae);if(_3ba){_38c.empty(this.categoryPart);this.drawCategoryPart();}this._changeHeighlightCategoryHead(_3ae.name);evt.stopPropagation();})));this.own(on(_3b6,"click",lang.hitch(this,function(evt){this.categoryManager.removeCategoryFromDisplay(_3ae);_38c.destroy(_3af);_387.forEach(_3ae.displayFields,function(_3bb){var _3bc=_3bb.fieldPath;var node=this.configTree.findNode(_3bc);if(node){node.setTemplateField(_3bb.fieldJson);if(node.toRightDiv){_38d.set(node.toRightDiv,"display","block");}}},this);_3ae.displayFields=[];evt.stopPropagation();})));this.own(on(_3b3,"click",lang.hitch(this,function(){if(_38d.get(_3b2,"display")==="block"){_38d.set(_3b2,"display","none");_38f.set(_3b8,"src","/bstatic/css/images/v_right.png");}else{_38d.set(_3b2,"display","block");_38f.set(_3b8,"src","/bstatic/css/images/v.png");}this._changeHeighlightCategoryHead(_3ae.name);})));this.drawFields(_3ae,_3af,_3b2);_38d.set(_3b2,"display","none");},drawFields:function(_3bd,_3be,_3bf){_387.forEach(_3bd.displayFields,function(_3c0){this.drawField(_3bd,_3be,_3bf,_3c0);},this);},addWidgetConfigToConfigTree:function(_3c1){var _3c2=new _391();var pos1=_3c1.search(/widgets\[[0-9]+\]/);var _3c3=_3c1.slice(pos1,_3c1.length);var pos2=_3c3.indexOf("]");pos1=pos1+pos2+1;var _3c4=_3c1.slice(0,pos1);var _3c5=_3c4+"_config";var _3c6=this.configTree.findNode(_3c4);var _3c7=this.configTree.findNode(_3c5);var _3c8=this.fullAppConfig.getConfigElementById(_3c6.jsonObject.id);_39c.getInstance().tryLoadWidgetConfig(_3c8).then(lang.hitch(this,function(_3c9){if(_3c9){var _3ca;_3c7.jsonObject=_3c9;for(_3ca in _3c9){if(_3c9.hasOwnProperty(_3ca)){_3ca=_3c7.addChild(_3c9[_3ca],_3ca,_3c7.absolutePath,_3c7.level);this.drawTree(_3ca,_3c7.subLineDomNode);}}_3c2.resolve();}else{_3c2.resolve();}}));return _3c2;},drawField:function(_3cb,_3cc,_3cd,_3ce){var _3cf,_3d0,_3d1,_3d2,_3d3,_3d4,_3d5,_3d6,_3d7,_3d8,_3d9,_3da,node,_3db,_3dc,_3dd;node=this.configTree.findNode(_3ce.fieldPath);_3db=_396.getDefaultTemplateField(_3ce.fieldPath,_3ce.fieldJson.type);for(_3dc in _3ce.fieldJson){if(_3ce.fieldJson.hasOwnProperty(_3dc)){_3db[_3dc]=_3ce.fieldJson[_3dc];}}_3cf=_38c.create("div",{"class":"field-div","fieldDiv":_3ce.fieldPath},_3cd);this.own(on(_3cf,"click",lang.hitch(this,function(_3de,_3df){var _3e0,y1,y2,_3e1;var _3e2=_3de.fieldPath;_3e0=this.configTree.findNode(_3e2);if(!_3e0){this.addWidgetConfigToConfigTree(_3e2).then(lang.hitch(this,function(){_3e0=this.configTree.findNode(_3e2);while(_3e0){_38d.set(_3e0.subLineDomNode,"display","block");_3e0=_3e0.parentNode;}lang.hitch(this,_3e3)();}));}else{while(_3e0){_38d.set(_3e0.subLineDomNode,"display","block");_3e0=_3e0.parentNode;}lang.hitch(this,_3e3)();}function _3e3(){_3e0=this.configTree.findNode(_3e2);y1=html.position(this.treePart).y;y2=html.position(_3e0.lineDomNode).y;_3e1=y2-y1;if(_3e1<0||_3e1>_38d.get(this.categoryPart,"height")){_3e0.lineDomNode.scrollIntoView(false);}this._changeHeighlightFieldDomNode(_3e2);this._changeHeighlightTreeDomNode(_3e0.lineDomNode);this._changeHeighlightCategoryHead(_3df.name);};},_3ce,_3cb)));_3d0=_38c.create("div",{"class":"field-head-div"},_3cf);function _3e4(_3e5){var _3e6="",i;var _3e7=_3e5.split("_");var _3e8=lang.clone(_3e7);_387.forEach(_3e7,function(_3e9,_3ea){var i,node,path="";if(_3e9.search(/widgets\[[0-9]+\]$/)!==-1||_3e9.search(/groups\[[0-9]+\]$/)!==-1){for(i=0;i<=_3ea;i++){path+=_3e7[i]+"_";}node=this.configTree.findNode(path.slice(0,-1));_3e8[_3ea]=node.label;}},this);for(i=1;i<_3e8.length;i++){_3e6+=_3e8[i]+"_";}return _3e6.slice(0,-1);};_3dd=_38c.create("span",{"class":"field-head-title-div","innerHTML":lang.hitch(this,_3e4)(_3ce.fieldPath)},_3d0);_3d3=_38c.create("div",{"class":"field-fold-div"},_3d0);_3d4=_38c.create("img",{"class":"field-fold-img","src":"/bstatic/css/images/v_right.png","alt":"img"},_3d3);_3d6=_38c.create("div",{"class":"field-oper-div","innerHTML":"<img class='field-oper-img' src='/bstatic/css/images/delete01.png' alt='img'></img>"},_3d0);_3d8=_38c.create("div",{"class":"field-oper-div","innerHTML":"<img class='field-oper-img' src='/bstatic/css/images/movedown.png' alt='img'></img>"},_3d0);_3d7=_38c.create("div",{"class":"field-oper-div","innerHTML":"<img class='field-oper-img' src='/bstatic/css/images/moveup.png' alt='img'></img>"},_3d0);var _3eb=_38c.create("div",{"class":"field-fixed-content-div","style":"display:none;"},_3cf);_3d5=_38c.create("span",{"class":"field-label-span","innerHTML":"Field Label:"},_3eb);_3d1=_38c.create("input",{"class":"jimu-input field-label-input","type":"text","value":_3db.label},_3eb);this.own(on(_3d1,"change",lang.hitch(this,function(_3ec,_3ed){this._onFieldChange(_3ec,{"key":"label","value":_3ed.value});},_3ce.fieldPath,_3d1)));_3da=_38c.create("span",{"class":"field-type-span","innerHTML":"Field Type:  "},_3eb);if(true){_3d2=new _393({"name":"selectFieldType","class":"field-type-select","options":[{label:"String",value:"string"},{label:"Boolean",value:"boolean"},{label:"Number",value:"number"},{label:"Options",value:"options"}],"value":_3db.type}).placeAt(_3eb);}else{_3d2=new _393({"name":"selectFieldType","class":"field-type-select","options":[{label:"Boolean",value:"Boolean"}]}).placeAt(_3eb);}_3d9=_38c.create("div",{"class":"field-content-div","style":"display:none;"},_3cf);this.drawFieldContent(_3ce.fieldPath,_3db,_3d9,_3d2.getValue());this.own(on(_3d2,"change",lang.hitch(this,function(_3ee,_3ef,_3f0,_3f1){this.drawFieldContent(_3ee,_3ef,_3f0,_3f1);this._onFieldChange(_3ee,{"key":"type","value":_3f1});_38d.set(_3f0,"display","block");},_3ce.fieldPath,_3db,_3d9)));this.own(on(_3d0,"click",lang.hitch(this,function(){if(_38d.get(_3d9,"display")==="block"){_38d.set(_3d9,"display","none");_38d.set(_3eb,"display","none");_38f.set(_3d4,"src","/bstatic/css/images/v_right.png");}else{_38d.set(_3d9,"display","block");_38d.set(_3eb,"display","block");_38f.set(_3d4,"src","/bstatic/css/images/v.png");}})));this.own(on(_3d6,"click",lang.hitch(this,function(_3f2,_3f3,_3f4,evt){var _3f5=_3f2.fieldPath;var node=this.configTree.findNode(_3f5);if(!node){this.addWidgetConfigToConfigTree(_3f5).then(lang.hitch(this,function(){var _3f6=this.configTree.findNode(_3f5);if(_3f2.fieldJson){_3f6.setTemplateField(_3f2.fieldJson);}}));}else{node.setTemplateField(_3f2.fieldJson);if(node.toRightDiv){_38d.set(node.toRightDiv,"display","block");}}var _3f7=this.categoryManager.getCategoryByField(_3f5);_3f7.removeFieldFromDisplay(_3f5);_38c.destroy(_3f3);if(_3f7.displayIsEmpty()){this.categoryManager.removeCategoryFromDisplay(_3f7);_38c.destroy(_3f4);}evt.stopPropagation();},_3ce,_3cf,_3cc)));this.own(on(_3d7,"click",lang.hitch(this,function(_3f8,_3f9,evt){var _3fa=this.categoryManager.getCategoryByField(_3f8);var _3fb=_3fa.moveup(_3f8);if(_3fb){_38c.empty(_3f9);this.drawFields(_3fa,_3cc,_3f9);this._changeHeighlightFieldDomNode(_3f8);}evt.stopPropagation();},_3ce.fieldPath,_3cd)));this.own(on(_3d8,"click",lang.hitch(this,function(_3fc,_3fd,evt){var _3fe=this.categoryManager.getCategoryByField(_3fc);var _3ff=_3fe.movedown(_3fc);if(_3ff){_38c.empty(_3fd);this.drawFields(_3fe,_3cc,_3fd);this._changeHeighlightFieldDomNode(_3fc);}evt.stopPropagation();},_3ce.fieldPath,_3cd)));},drawFieldContent:function(_400,_401,_402,type){var _403,_404,_405,_406,_407,_408,_409,_40a,_40b,_40c,_40d;_38c.empty(_402);_403=_38c.create("span",{"class":"field-tooltip-span","innerHTML":"Tooltip:"},_402);_404=_38c.create("input",{"class":"jimu-input field-tooltip-input","type":"text","value":_401.tooltip},_402);this.own(on(_404,"change",lang.hitch(this,function(_40e,_40f){this._onFieldChange(_40e,{"key":"tooltip","value":_40f.value});},_400,_404)));_38c.create("br",{},_402);if(type==="string"){_405=_38c.create("span",{"class":"field-string-ph-span","innerHTML":"Placeholder:"},_402);_406=_38c.create("input",{"class":"jimu-input field-string-ph-input","type":"text","value":_401.placeHolder},_402);this.own(on(_406,"change",lang.hitch(this,function(_410,_411){this._onFieldChange(_410,{"key":"placeHolder","value":_411.value});},_400,_406)));var _412=_38c.create("div",{"class":"field-text-type-div"},_402);_38c.create("span",{"class":"field-text-type-span","innerHTML":"Text Box Type:"},_412);_407=new _393({"name":"stringOptions","class":"field-string-options","options":[{label:"richtext",value:"richtext"},{label:"textarea",value:"textarea"},{label:"textbox",value:"textbox"}],"value":_401.stringFieldOption}).placeAt(_412);this.own(on(_407,"change",lang.hitch(this,function(_413,_414){this._onFieldChange(_413,{"key":"stringFieldOptions","value":_414});},_400)));}else{if(type==="number"){_408=_38c.create("span",{"class":"field-num-min-span","innerHTML":"Min Value:"},_402);_409=_38c.create("input",{"class":"jimu-input field-num-input field-num-min-input","type":"text","value":_401.constraints.min},_402);_38c.create("br",{},_402);_40a=_38c.create("span",{"class":"field-num-max-span","innerHTML":"Max Value:"},_402);_40b=_38c.create("input",{"class":"jimu-input field-num-input field-num-max-input","type":"text","value":_401.constraints.max},_402);_38c.create("br",{},_402);_40c=_38c.create("span",{"class":"field-num-places-span","innerHTML":"Places:"},_402);_40d=_38c.create("input",{"class":"jimu-input field-num-input field-num-places-input","type":"text","value":_401.constraints.places},_402);this.own(on(_409,"change",lang.hitch(this,function(_415){this._onFieldChange(_415,{"key":"constraints","value":{"min":_409.value,"max":_40b.value,"places":_40d.value}});},_400)));this.own(on(_40b,"change",lang.hitch(this,function(_416){this._onFieldChange(_416,{"key":"constraints","value":{"min":_409.value,"max":_40b.value,"places":_40d.value}});},_400)));this.own(on(_40d,"change",lang.hitch(this,function(_417){this._onFieldChange(_417,{"key":"constraints","value":{"min":_409.value,"max":_40b.value,"places":_40d.value}});},_400)));}else{if(type==="options"){var _418=_38c.create("div",{"class":"field-options-add-div"},_402);var _419=_38c.create("div",{"class":"field-options-add-content"},_418);_38c.create("div",{"class":"field-options-add-img-div","innerHTML":"<img src='/bstatic/css/images/add_link.png' alt='img'></img>"},_419);_38c.create("div",{"class":"field-options-add-text-div","innerHTML":"Add a New Options"},_419);_387.forEach(_401.options,function(_41a){this._onFieldOptionsAdd(_400,_402,_41a.label,_41a.value);},this);this.own(on(_418,"click",lang.hitch(this,this._onFieldOptionsAdd,_400,_402,"","")));}}}},_changeHeighlightFieldDomNode:function(_41b){_390(".field-div",this.categoryPart).removeClass("field-heighlight-div");_38e.add(_390("div[fieldDiv=\""+_41b+"\"]",this.categoryPart)[0],"field-heighlight-div");},_changeHeighlightTreeDomNode:function(_41c){if(this.heighlightTreeDomNode){_38e.remove(this.heighlightTreeDomNode,"tree-node-heighlight-div");}_38e.add(_41c,"tree-node-heighlight-div");this.heighlightTreeDomNode=_41c;},_changeHeighlightCategoryHead:function(_41d){_390(".category-head-div",this.categoryPart).removeClass("category-head-div-selected");var _41e=_390("div[categoryHeadDiv='"+_41d+"']",this.categoryPart)[0];html.addClass(_41e,"category-head-div-selected");},_onToRightDiv:function(node,mode,_41f){var _420,_421,_422;var _423=this.categoryManager.getCategoryByField(node.absolutePath);var _424=this.categoryManager.findDisplayCategory(_423.name);var y1,y2,_425;var _426={"fieldPath":node.absolutePath,"fieldJson":node.getTemplateField()};if(_424===-1){if(mode!=="add"){return;}this.categoryManager.addCategoryToDisplay(_423);_423.addFieldToDisplay(_426);this.drawCategory(_423);_421=_390("div[fieldsDiv='"+_423.name+"']",this.categoryPart)[0];_38d.set(_421,"display","block");}else{if(_423.findFieldFromDisplay(node.absolutePath)===-1){if(mode!=="add"){return;}_423.addFieldToDisplay(_426);_420=_390("div[categoryDiv='"+_423.name+"']",this.categoryPart)[0];_421=_390("div[fieldsDiv='"+_423.name+"']",this.categoryPart)[0];this.drawField(_423,_420,_421,_426);_38d.set(_421,"display","block");}else{_421=_390("div[fieldsDiv='"+_423.name+"']",this.categoryPart)[0];_38d.set(_421,"display","block");}}_422=_390("div[fieldDiv=\""+node.absolutePath+"\"]",this.categoryPart)[0];this._changeHeighlightCategoryHead(_423.name);this._changeHeighlightFieldDomNode(node.absolutePath);this._changeHeighlightTreeDomNode(_41f);y1=html.position(this.categoryPart).y;y2=html.position(_422).y;_425=y2-y1;if(_425<0||_425>_38d.get(this.categoryPart,"height")){_422.scrollIntoView(false);}},_onFieldChange:function(_427,data){var node=this.configTree.findNode(_427);var _428=this.categoryManager.getCategoryByField(_427).getDisplayField(_427);node.templateField[data.key]=data.value;_428.fieldJson=node.getTemplateField();},_onFieldOptionsAdd:function(_429,_42a,_42b,_42c){var _42d=_38c.create("div",{"class":"field-options-div"},_42a);_38c.create("div",{"class":"field-options-label-div","innerHTML":"Label"},_42d);var _42e=_38c.create("input",{"class":"jimu-input field-options-label-input","type":"text","value":_42b},_42d);this.own(on(_42e,"change",lang.hitch(this,function(_42f){this._onFieldChange(_42f,{"key":"options","value":this._getFieldOptions(_42a)});},_429)));_38c.create("div",{"class":"field-options-value-div","innerHTML":"Value"},_42d);var _430=_38c.create("input",{"class":"jimu-input field-options-value-input","type":"text","value":_42c},_42d);this.own(on(_430,"change",lang.hitch(this,function(_431){this._onFieldChange(_431,{"key":"options","value":this._getFieldOptions(_42a)});},_429)));var _432=_38c.create("div",{"class":"field-options-remove-div","innerHTML":"<img src='/bstatic/css/images/delete_search.png' alt='img'></img>"},_42d);this.own(on(_432,"click",lang.hitch(this,function(_433){_38c.destroy(_42d);this._onFieldChange(_433,{"key":"options","value":this._getFieldOptions(_42a)});},_429)));},_onReviewJsonDivClick:function(){var _434=this.categoryManager.getTemplateJson();this.showJsonWidget.setConfig(_434);_38f.set(this.rightPartHeadText,"innerHTML",this.nls.rightPartHead2);_38d.set(this.showJsonDiv,"display","block");_38d.set(this.reviewJsonDiv,"display","none");_38d.set(this.reviewJsonBackDiv,"display","block");},_onReviewJsonBackDivClick:function(){_38f.set(this.rightPartHeadText,"innerHTML",this.nls.rightPartHead);_38d.set(this.reviewJsonDiv,"display","block");_38d.set(this.reviewJsonBackDiv,"display","none");_38d.set(this.showJsonDiv,"display","none");},_updateAgolTemplate:function(){var _435=new _391();var _436=Json.stringify(this.categoryManager.getTemplateJson("fullJson"));_388("/builder/rest/apps/updateagoltemplateinapp",{handleAs:"json",method:"POST",data:{"id":this.app.id,"name":this.app.name,"agolTemplateJson":_436}}).then(lang.hitch(this,function(res){if(res.success===true){this.app.agolTemplateJson=_436;this.lastTemplateJson=this.categoryManager.getTemplateJson();_435.resolve();}else{_435.reject();new _39d({message:"Save agol template failed!"});}}),function(err){_435.reject();new _39d({message:"Save agol template failed!"});});return _435;},_onDownloadNodeClick:function(){this._updateAgolTemplate().then(lang.hitch(this,function(){var a=html.create("a");html.setAttr(a,"href","/builder/rest/apps/"+this.app.id+"/downloadagoltemplate");a.click();}));},_onSaveClick:function(){this._updateAgolTemplate().then(lang.hitch(this,function(){html.setAttr(this.downloadLinkNode,"href","/builder/rest/apps/"+this.app.id+"/downloadagoltemplate");html.addClass(this.downloadLinkNode,"download-div-enable");html.removeClass(this.downloadNode,"jimu-state-disabled");new _39d({message:this.nls.saveSuccessMeg});}));},_onCancelClick:function(){var _437=!_39b.isEqual(this.lastTemplateJson,this.categoryManager.getTemplateJson());if(_437){var _438=new _39e({content:"<div><img class='alert-image' src='/bstatic/css/images/alert.png' style='float:left;margin-left:12px;margin-right:22px;'></img>"+this.nls.unSaveMeg+"</div>",titleLabel:this.nls.cancelPopupTitle,width:"425",height:"200",buttons:[{label:this.nls.save,onClick:lang.hitch(this,function(){this._updateAgolTemplate().then(lang.hitch(this,function(){_438.close();this.destroyRecursive();}));})},{label:this.nls.doNotSave,onClick:lang.hitch(this,function(){_438.close();this.destroyRecursive();})},{label:this.nls.cancel,onClick:lang.hitch(this,function(){_438.close();})}]});}else{this.destroyRecursive();}}});});},"builder/AGOLTemplate/ConfigNode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array"],function(_439,lang,_43a){var _43b={};var _43c=_439([],{id:null,parentNode:null,keyString:null,absolutePath:null,childs:null,nodeType:null,templateField:null,jsonObject:null,level:null,label:null,isVisible:false,constructor:function(root,_43d,_43e,_43f,_440){var _441,i;this.parentNode=_43d;this.keyString=_43e;this.childs=[];this.absolutePath=(_43f==="")?_43e:_43f+"_"+_43e;this.jsonObject=root;this.level=_440;this.initId();this.initLabel();this.initTemplateField(root);if(typeof root!=="object"||root===null){this.nodeType="leaf";return;}if(lang.isArray(root)){this.nodeType="array";for(i=0;i<root.length;i++){this.addChild(root[i],this.keyString+"["+i+"]",_43f,_440);}}else{this.nodeType="normal";for(_441 in root){if(root.hasOwnProperty(_441)){this.addChild(root[_441],_441,this.absolutePath,_440);}}if(this.absolutePath.search(/widgets\[[0-9]+\]$/)!==-1){root.config=null;this.addChild(root.config,"config",this.absolutePath,_440).nodeType="normal";}}},initId:function(){var _442,_443;_442=this.absolutePath.search(/_widgets\[[0-9]+\]/);_443=this.absolutePath.search(/_groups\[[0-9]+\]/);if(_442!==-1||_443!==-1){if(this.absolutePath.search(/_widgets\[[0-9]+\]$/)!==-1||this.absolutePath.search(/_groups\[[0-9]+\]$/)!==-1){this.id=this.jsonObject.id;}else{if(_442!==-1){this.id=this.parentNode.id+"_"+this.keyString;}else{if(_443!==-1){this.id=this.parentNode.id+"_"+this.keyString;}}}}else{this.id=this.absolutePath;}this.id=this.id.replace(/\[|\]/g,"-");this.id=this.id.replace(/\//g,"-");},initLabel:function(){this.label=this.keyString;if(this.absolutePath.search(/widgets\[[0-9]+\]$/)!==-1||this.absolutePath.search(/groups\[[0-9]+\]$/)!==-1){this.label=this.jsonObject.label;}},initTemplateField:function(_444){this.templateField=_43c.getDefaultTemplateField(this.absolutePath,typeof _444,this.label);_43c.setDefaultValue(this.absolutePath,_444);},getTemplateFieldDefaultValue:function(){return this.templateField.defaultValue;},getTemplateField:function(){var _445={"type":this.templateField.type,"fieldName":this.templateField.fieldName,"label":this.templateField.label,"tooltip":this.templateField.tooltip};if(this.nodeType!=="leaf"){_445.fieldName+="--";}switch(_445.type){case "string":_445.stringFieldOption=this.templateField.stringFieldOption;_445.placeHolder=this.templateField.placeHolder;break;case "number":_445.constraints=this.templateField.constraints;break;case "options":_445.options=this.templateField.options;break;}_445.id=this.id;return _445;},setTemplateField:function(_446){this.templateField.type=_446.type;this.templateField.label=_446.label;this.templateField.tooltip=_446.tooltip;if(this.nodeType!=="leaf"){this.templateField.fieldName=this.templateField.fieldName.slice(0,this.templateField.fieldName.length-2);}switch(this.templateField.type){case "string":this.templateField.stringFieldOption=_446.stringFieldOption;this.templateField.placeHolder=_446.placeHolder;break;case "number":this.templateField.constraints=_446.constraints;break;case "options":this.templateField.options=_446.options;break;}return _446;},addChild:function(_447,_448,_449,_44a){var _44b=new _43c(_447,this,_448,_449,_44a+1);this.childs.push(_44b);return _44b;},isLeaf:function(){var _44c=false;if(this.childs&&this.childs.length>0){_44c=true;}return _44c;},findNode:function(_44d){var _44e=[],i,j,_44f,_450;_44d.split("_").forEach(function(str){var pos=str.search(/\[[0-9]+\]/);if(pos===-1){_44e.push(str);}else{_44e.push(str.slice(0,pos));_44e.push(str);}});_44f=this;if(_44f.keyString!==_44e[0]){return null;}for(i=1;i<_44e.length;i++){_450=_44f.childs.length;for(j=0;j<_450;j++){if(_44f.childs[j].keyString===_44e[i]){_44f=_44f.childs[j];break;}}if(j===_450){return null;}}return _44f;},setVisible:function(){var _451=this;while(_451){_451.isVisible=true;_451=_451.parentNode;}},findNodeById:function(id){var _452=null;this.traversal(this,function(){},function(node){if(node.id===id){_452=node;return true;}else{return false;}});return _452;},deserialize:function(_453){if(_453){_43a.forEach(_453.configurationSettings,function(_454){_43a.forEach(_454.fields,function(_455){this.findNode(_455.fieldName).setTemplateField(_455);},this);},this);}}});_43c.getDefaultValue=function(_456){return _43b[_456];};_43c.setDefaultValue=function(_457,_458){var _459;_459=_458;if(_457==="app_portalUrl"||_457==="app_map_itemId"){_459=null;}else{if((typeof _458)==="object"){_459=false;}}_43b[_457]=_459;};_43c.getDefaultTemplateField=function(_45a,_45b,_45c){var type="string",_45d;_45c=_45c;switch(_45b){case "number":type="number";break;case "boolean":type="boolean";break;case "object":type="boolean";_45c="disable";break;}_45d={"type":type,"fieldName":_45a,"label":_45c,"tooltip":"","stringFieldOption":"textbox","placeHolder":_45c,"constraints":{"min":0,"max":100,"places":0},"options":[{"label":"label1","value":"value1"},{"label":"label2","value":"value2"}]};return _45d;};return _43c;});},"builder/AGOLTemplate/Category":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array"],function(_45e,lang,_45f){return _45e([],{name:null,title:null,includeFields:null,excludeFields:null,displayFields:null,constructor:function(_460,name,_461,_462,_463,_464){this.name=name;this.title=_461;this.includeFields=_462;this.excludeFields=_463;this.displayFields=[];_45f.forEach(_464,function(_465){var _466=_460.findNode(_465);if(_466){this.displayFields.push({"fieldPath":_465,"fieldJson":_466.getTemplateField()});}},this);},hasField:function(_467){var _468=false,i;for(i=0;i<this.includeFields.length;i++){if(_467.indexOf(this.includeFields[i])===0){_468=true;break;}}for(i=0;i<this.excludeFields.length;i++){if(_467.indexOf(this.excludeFields[i])===0){_468=false;break;}}return _468;},getDisplayField:function(_469){var _46a=this.findFieldFromDisplay(_469);if(_46a!==-1){return this.displayFields[_46a];}return null;},findFieldFromDisplay:function(_46b){var i;for(i=0;i<this.displayFields.length;i++){if(this.displayFields[i].fieldPath===_46b){return i;}}return -1;},addFieldToDisplay:function(_46c){var _46d;_46d=this.findFieldFromDisplay(_46c.fieldPath);if(_46d===-1){this.displayFields.push({"fieldPath":_46c.fieldPath,"fieldJson":_46c.fieldJson});}else{this.displayFields[_46d].fieldJson=_46c.fieldJson;}},removeFieldFromDisplay:function(_46e){var _46f;_46f=this.findFieldFromDisplay(_46e);if(_46f>=0){this.displayFields.splice(_46f,1);}return _46e;},moveup:function(_470){var _471,_472;_471=this.findFieldFromDisplay(_470);if(_471>0){_472=this.displayFields[_471];this.displayFields[_471]=this.displayFields[_471-1];this.displayFields[_471-1]=_472;return true;}return false;},movedown:function(_473){var _474,_475;_474=this.findFieldFromDisplay(_473);if(_474>=0&&_474<this.displayFields.length-1){_475=this.displayFields[_474];this.displayFields[_474]=this.displayFields[_474+1];this.displayFields[_474+1]=_475;return true;}return false;},displayIsEmpty:function(){return this.displayFields.length===0;},deserialize:function(_476,_477){this.displayFields=[];_45f.forEach(_476,function(_478){var _479=_477.findNode(_478.fieldName);if(_479&&_479.id===_478.id){this.displayFields.push({"fieldPath":_478.fieldName,"fieldJson":_478});}else{if(this.hasField(_478.fieldName)&&(_478.fieldName.search(/groups\[[0-9]+\]/)===-1)){this.displayFields.push({"fieldPath":_478.fieldName,"fieldJson":_478});}}},this);return this.displayFields.length;}});});},"builder/AGOLTemplate/CategoryManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/request","dojo/Deferred","dojo/promise/all","dojo/json","./ConfigNode","./Category"],function(_47a,lang,_47b,_47c,_47d,all,Json,_47e,_47f){var _480=_47a([],{categorys:null,displayCategorys:null,constructor:function(_481,_482,_483){this.categorys=[];this.displayCategorys=[];this.initCategorys(_482,_481);this.deserialize(_483,_481);},initCategorys:function(_484,_485){var _486=["app"];var _487=["app_theme","app_map","app_preloadWidgets","app_widgetPool","app_splashPage","app_portalUrl","app_appId","app_widgetManifestsMerged"];var _488=["app_title","app_subtitle"];var _489=new _47f(_485,"Attribute","Attribute",_486,_487,_488);this.categorys.push(_489);var _48a=["app_theme"];var _48b=["app_theme_name","app_theme_layout"];var _48c=new _47f(_485,"Theme","Theme",_48a,_48b);this.categorys.push(_48c);var _48d=["app_map"];var _48e=["app_map_id","app_map_2D","app_map_3D"];var _48f=new _47f(_485,"Map","Map",_48d,_48e,[]);this.categorys.push(_48f);var _490=["app_preloadWidgets_panel"];var _491=["app_preloadWidgets_panel_uri"];var _492=new _47f(_485,"PreloadwidgetPanel","Preload widget Panel",_490,_491);this.categorys.push(_492);var _493=["app_widgetPool_panel"];var _494=["app_widgetPool_panel_uri"];var _495=new _47f(_485,"WidgetpoolPanel","Widget pool Panel",_493,_494);this.categorys.push(_495);_47b.forEach(_484.preloadWidgets.widgets,function(_496,_497){var name="preloadWidget_"+_496.id;var _498="app_preloadWidgets_widgets["+_497+"]";var _499=[_498];var _49a=[_498+"_uri",_498+"_id",_498+"_name",_498+"_index"];if(_496.uri){this.categorys.push(new _47f(_485,name,_496.label+" widget",_499,_49a));}},this);_47b.forEach(_484.preloadWidgets.groups,function(_49b,_49c){var name="preloadWidgetGroup_"+_49b.id;var _49d="app_preloadWidgets_groups["+_49c+"]";var _49e=[_49d];var _49f=[_49d+"_id",_49d+"_index"];_47b.forEach(_49b.widgets,function(_4a0,_4a1){_49f.push(_49d+"_widgets["+_4a1+"]_url");_49f.push(_49d+"_widgets["+_4a1+"]__id");_49f.push(_49d+"_widgets["+_4a1+"]_uri");_49f.push(_49d+"_widgets["+_4a1+"]_id");_49f.push(_49d+"_widgets["+_4a1+"]_name");_49f.push(_49d+"_widgets["+_4a1+"]_index");});this.categorys.push(new _47f(_485,name,_49b.label,_49e,_49f));},this);_47b.forEach(_484.widgetPool.widgets,function(_4a2,_4a3){var name="widgetPoolWidget_"+_4a2.id;var _4a4="app_widgetPool_widgets["+_4a3+"]";var _4a5=[_4a4];var _4a6=[_4a4+"_uri",_4a4+"_id",_4a4+"_name",_4a4+"_index"];if(_4a2.uri){this.categorys.push(new _47f(_485,name,_4a2.label+" widget",_4a5,_4a6));}},this);_47b.forEach(_484.widgetPool.groups,function(_4a7,_4a8){var name="widgetPoolGroup_"+_4a7.id;var _4a9="app_widgetPool_groups["+_4a8+"]";var _4aa=[_4a9];var _4ab=[_4a9+"_id",_4a9+"_index"];_47b.forEach(_4a7.widgets,function(_4ac,_4ad){_4ab.push(_4a9+"_widgets["+_4ad+"]_url");_4ab.push(_4a9+"_widgets["+_4ad+"]__id");_4ab.push(_4a9+"_widgets["+_4ad+"]_uri");_4ab.push(_4a9+"_widgets["+_4ad+"]_id");_4ab.push(_4a9+"_widgets["+_4ad+"]_name");_4ab.push(_4a9+"_widgets["+_4ad+"]_index");});this.categorys.push(new _47f(_485,name,_4a7.label,_4aa,_4ab));},this);this.displayCategorys.push(_489);},getCategoryByName:function(_4ae){return this.categorys[this.findCategory(_4ae)];},getCategoryByField:function(_4af){var i;for(i=0;i<this.categorys.length;i++){if(this.categorys[i].hasField(_4af)){return this.categorys[i];}}return null;},findCategory:function(_4b0){return this._find(_4b0,this.categorys);},findDisplayCategory:function(_4b1){return this._find(_4b1,this.displayCategorys);},_find:function(_4b2,list){var i,_4b3,_4b4=null;for(i=0;i<list.length;i++){if(list[i].name===_4b2){_4b4=list[i];break;}}if(i===list.length){_4b3=-1;}else{_4b3=i;}return _4b3;},addCategoryToDisplay:function(_4b5){if(this.findDisplayCategory(_4b5.name)===-1){this.displayCategorys.push(_4b5);}},removeCategoryFromDisplay:function(_4b6){var _4b7=this.findDisplayCategory(_4b6.name);if(_4b7>=0){this.displayCategorys.splice(_4b7,1);}},moveup:function(_4b8){var _4b9,_4ba;_4b9=this.findDisplayCategory(_4b8.name);if(_4b9>0){_4ba=this.displayCategorys[_4b9];this.displayCategorys[_4b9]=this.displayCategorys[_4b9-1];this.displayCategorys[_4b9-1]=_4ba;return true;}return false;},movedown:function(_4bb){var _4bc,_4bd;_4bc=this.findDisplayCategory(_4bb.name);if(_4bc>=0&&_4bc<this.displayCategorys.length-1){_4bd=this.displayCategorys[_4bc];this.displayCategorys[_4bc]=this.displayCategorys[_4bc+1];this.displayCategorys[_4bc+1]=_4bd;return true;}return false;},getTemplateJson:function(mode){var _4be={"configurationSettings":[],"values":{}};_47b.forEach(this.displayCategorys,function(_4bf,i){var _4c0={"category":_4bf.title,"fields":[]};if(mode==="fullJson"){_4c0.categoryName=_4bf.name;}_47b.forEach(_4bf.displayFields,function(_4c1,i){var _4c2=lang.clone(_4c1.fieldJson);if(!mode||mode!=="fullJson"){delete _4c2.id;}_4c0.fields[i]=_4c2;_4be.values[_4c2.fieldName]=_47e.getDefaultValue(_4c1.fieldPath);},this);_4be.configurationSettings[i]=_4c0;},this);return _4be;},deserialize:function(_4c3,_4c4){if(_4c3){_47b.forEach(this.displayCategorys,function(_4c5){_4c5.displayFields=[];});this.displayCategorys=[];_4c3=Json.parse(_4c3);_47b.forEach(_4c3.configurationSettings,function(_4c6){var _4c7=this.getCategoryByName(_4c6.categoryName);var _4c8=0;if(_4c7){_4c8=_4c7.deserialize(_4c6.fields,_4c4);if(_4c8>0){this.displayCategorys.push(_4c7);}}},this);}}});return _480;});},"builder/AGOLTemplate/ShowJsonCodePage":function(){define(["dojo/_base/declare","dijit/_WidgetBase","builder/config/JSONEditor"],function(_4c9,_4ca,_4cb){return _4c9([_4ca],{baseClass:"show-json-code-div",postCreate:function(){this.inherited(arguments);this.jsonEditor=new _4cb({json:this.config});this.jsonEditor.placeAt(this.domNode);},setConfig:function(_4cc){return this.jsonEditor.setJSON(_4cc);},getConfig:function(){return this.jsonEditor.getJSON();}});});},"builder/AGOLTemplate/utils":function(){define(["dojo/_base/lang","dojo/Deferred","jimu/WidgetManager","jimu/utils","esri/request"],function(lang,_4cd,_4ce,_4cf,_4d0){var mo={};mo.loadWidgetConfig=function(_4d1){var _4d2=new _4cd();_4d3(_4d1.jsonObject).then(lang.hitch(this,function(_4d4){if(_4d4.manifest.hasConfig!==false){_4ce.getInstance().tryLoadWidgetConfig(_4d4.setting).then(lang.hitch(this,function(_4d5){_4d2.resolve(_4d5);}));}else{_4d2.resolve(null);}}));return _4d2;};function _4d3(_4d6){var def=new _4cd();var _4d7=lang.clone(_4d6);_4cf.processWidgetSetting(_4d7);_4d0({url:_4d7.folderUrl+"/manifest.json"}).then(function(_4d8){if(typeof _4d8.properties==="undefined"){_4d8.properties={};}if(typeof _4d8.properties.inPanel==="undefined"){_4d8.properties.inPanel=true;}if(typeof _4d8.properties.isController==="undefined"){_4d8.properties.isController=false;}lang.mixin(_4d7,_4d8.properties);def.resolve({manifest:_4d8,setting:_4d7});},function(err){def.reject(err);});return def;};return mo;});},"builder/Header":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Header.html","./Setting","dojo/topic","jimu/dijit/Popup","jimu/dijit/Message","dojo/i18n!./nls/builder"],function(_4d9,lang,_4da,html,_4db,_4dc,_4dd,_4de,_4df,_4e0,_4e1,_4e2){return _4d9([_4db,_4dc],{templateString:_4dd,baseClass:"header",postMixInProperties:function(){this.nls=lang.mixin({},_4e2.common);this.nls=lang.mixin(this.nls,_4e2.header);if(this.proxyUrl){esri.config.defaults.io.proxyUrl=this.proxyUrl;}},setAppName:function(_4e3){_4e3=_4e3||"";this.appName.innerHTML=_4e3;},getAppName:function(){return this.appName.innerHTML||"";},showSettings:function(){html.setStyle(this.settingIcon,"display","block");html.setStyle(this.settingLinkNode,{"display":"inline-block","cursor":"pointer"});},hideSettings:function(){html.setStyle(this.settingIcon,"display","none");html.setStyle(this.settingLinkNode,{"display":"none","cursor":"pointer"});},_onLogoClick:function(){main.switchView("apps");},_onSettingClick:function(){var _4e4=new _4de();var _4e5=true;var _4e6=new _4e0({width:1044,titleLabel:_4e4.nls.settings,content:_4e4,container:document.body,onClose:function(){if(_4e5){_4e4.destroy();}return _4e5;},buttons:[{label:this.nls.ok,onClick:lang.hitch(this,function(){_4e5=false;var def=_4e4.save();def.then(lang.hitch(this,function(){_4e5=true;_4e6.close();}),lang.hitch(this,function(err){_4e5=true;new _4e1({message:err});}));})},{label:this.nls.cancel}]});}});});},"builder/Setting":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/Setting.html","dojo/_base/lang","dojo/_base/array","dojo/_base/html","dojo/_base/Deferred","dojo/query","dojo/on","dojo/topic","dijit/form/Select","esri/request","jimu/portalUtils","jimu/portalUrlUtils","dojo/i18n!./nls/builder","jimu/dijit/Message","jimu/dijit/LoadingShelter","dojo/dom-style","dojo/dom-class","dojo/NodeList-dom"],function(_4e7,_4e8,_4e9,_4ea,_4eb,lang,_4ec,html,_4ed,_4ee,on,_4ef,_4f0,_4f1,_4f2,_4f3,_4f4,_4f5,_4f6,_4f7,_4f8,_4f9){return _4e7([_4e8,_4e9,_4ea],{templateString:_4eb,baseClass:"setting",label:"setting",itemId:null,currentPortalUrl:null,shelter:null,adSettings:null,_onlineGeometryUrl:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",_onlineGeocodeUrl:"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",_onlinePrintTaskUrl:"http://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",_onlineRouteUrl:"http://route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",postMixInProperties:function(){this.nls=lang.mixin({},_4f4.common);this.nls=lang.mixin(this.nls,_4f4.settings);},postCreate:function(){this.inherited(arguments);this.adSettings=_4ee(".advanced-setting-hide",this.domNode);this.advance.value=this.nls.showAdSetting;this.shelter=new _4f6({hidden:true});this.shelter.placeAt(this.domNode);this.shelter.startup();this.own(on(this.btnLoadHelperServices,"click",lang.hitch(this,this._loadAndSaveHelperServices)));this.initSetting();},_getStandardPortalUrl:function(evt){if(evt.target.value){if(_4f3.isArcGIScom(this.portalUrl.value)){this.portalUrl.value=_4f3.getStandardPortalUrl(this.portalUrl.value);}}},initSetting:function(){this.shelter.show();var def=_4f1({url:"/builder/rest/settings/getInfo",handleAs:"json",callbackParamName:"callback"});def.then(lang.hitch(this,function(_4fa){this.shelter.hide();if(_4fa&&_4fa.success){this.bing.value=_4fa.bing||"";this.portalUrl.value=_4fa.portalUrl||"";this.geoServiceUrl.value=_4fa.geoServiceUrl||"";this.geocodeServiceUrl.value=_4fa.geocodeServiceUrl||"";this.routeServiceUrl.value=_4fa.routeServiceUrl||"";this.printTaskUrl.value=_4fa.printTaskUrl||"";this.proxyUrl.value=_4fa.proxyUrl||"";this.appId.value=_4fa.appId||"";this.themeRepo.value=_4fa.themeRepo||"";this.widgetRepo.value=_4fa.widgetRepo||"";this.itemId=_4fa.itemId||"";var _4fb=_4fa.locale||"";this.localeSelect.set("value",_4fb);this.currentPortalUrl=this.portalUrl.value;}else{}}),lang.hitch(this,function(err){this.shelter.hide();}));},_requestPortal:function(){var url=this.portalUrl.value;if(!url.endWith("/")){url+="/";}url+="sharing/rest/portals/self?f=pjson";var def=_4f1({sync:true,url:url,handleAs:"json",callbackParamName:"callback",timeout:10000},{useProxy:false});return def;},_verified:function(){this.shelter.show();var _4fc=new _4ed();if(!_4f3.isSamePortalUrl(this.portalUrl.value,this.currentPortalUrl)){var def=this._requestPortal();def.then(lang.hitch(this,function(){var def2=_4f2.getDefaultWebMap(this.portalUrl.value);def2.then(lang.hitch(this,function(id){_4fc.resolve(id);}),lang.hitch(this,function(){_4fc.reject(this.nls.webMapError+": "+this.portalUrl.value);})).always(lang.hitch(this,function(){this.shelter.hide();}));}),lang.hitch(this,function(_4fd){this.shelter.hide();_4fc.reject(this.nls.loadServiceError);}));}else{var _4fe=setTimeout(function(){clearTimeout(_4fe);_4fc.resolve(this.itemId);},500);}return _4fc;},_loadAndSaveHelperServices:function(){this.shelter.show();var def=this._requestPortal();def.then(lang.hitch(this,function(_4ff){var _500=_4ff.helperServices;if(!_500){this.shelter.hide();return;}var _501=[];var _502=this._onlineGeometryUrl;if(_500.geometry&&_500.geometry.url){_502=_500.geometry.url;}_501.push({name:"geoServiceUrl",newValue:_502});var _503=this._onlineGeocodeUrl;if(_500.geocode&&_500.geocode.length>0){var _504=_500.geocode[0];if(_504&&_504.url){_503=_504.url;}}_501.push({name:"geocodeServiceUrl",newValue:_503});var _505=this._onlinePrintTaskUrl;if(_500.printTask&&_500.printTask.url){_505=_500.printTask.url;}_501.push({name:"printTaskUrl",newValue:_505});var _506=this._onlineRouteUrl;if(_500.route&&_500.route.url){_506=_500.route.url;}_501.push({name:"routeServiceUrl",newValue:_506});if(_501.length>0){var _507={};_4ec.forEach(_501,lang.hitch(this,function(info){_507[info.name]=info.newValue;}));var _508=lang.mixin(this._getContent(),_507);var def2=this.save(_508);def2.then(lang.hitch(this,function(){this.shelter.hide();_4ec.forEach(_501,lang.hitch(this,function(info){this[info.name].value=info.newValue;}));}),lang.hitch(this,function(){this.shelter.hide();}));}else{this.shelter.hide();}}),lang.hitch(this,function(_509){this.shelter.hide();new _4f5({message:this.nls.loadServiceError});}));},_onAdvancedClick:function(evt){this.adSettings.toggleClass("advanced-setting-hide");var _50a=this.adSettings.every(function(itm,idx){return !_4f8.contains(itm,"advanced-setting-hide");});if(_50a){evt.target.value=this.nls.hideAdSetting;}else{evt.target.value=this.nls.showAdSetting;}},_getContent:function(){var _50b=_4f3.getStandardPortalUrl(lang.trim(this.portalUrl.value));var _50c=lang.trim(this.geoServiceUrl.value);var _50d=lang.trim(this.geocodeServiceUrl.value);var _50e=lang.trim(this.routeServiceUrl.value);var _50f=lang.trim(this.printTaskUrl.value);var _510=lang.trim(this.proxyUrl.value);var bing=lang.trim(this.bing.value);var _511=lang.trim(this.appId.value);var _512=lang.trim(this.widgetRepo.value);var _513=lang.trim(this.themeRepo.value);var _514=this.localeSelect.get("value");var a="http://";_50b=_50b===a?"":_50b;_50c=_50c===a?"":_50c;_50d=_50d===a?"":_50d;_50e=_50e===a?"":_50e;_50f=_50f===a?"":_50f;_510=_510===a?"":_510;bing=bing===a?"":bing;var _515={"portalUrl":_50b,"geoServiceUrl":_50c,"geocodeServiceUrl":_50d,"routeServiceUrl":_50e,"printTaskUrl":_50f,"proxyUrl":_510,"locale":_514,"bing":bing,"appId":_511,"widgetRepo":_512,"themeRepo":_513};return _515;},save:function(_516){var def=new _4ed();var _517=this._verified();_517.then(lang.hitch(this,function(id){if(!_516){_516=this._getContent();}if(id){lang.mixin(_516,{"itemId":id});}var def2=_4f1({url:"/builder/rest/settings/update",handleAs:"json",content:_516},{usePost:true});def2.then(lang.hitch(this,function(_518){if(_518.success){if(this.proxyUrl.value){esri.config.defaults.io.proxyUrl=this.proxyUrl.value;}def.resolve();}else{def.reject();}}),lang.hitch(this,function(){def.reject();}));}),lang.hitch(this,function(err){def.reject(err);}));return def;}});});},"url:builder/templates/Apps.html":"<div >\r\n  <div class=\"app-content\" data-dojo-attach-point=\"appContent\">\r\n    <div class=\"head-section\" data-dojo-attach-point=\"head-section\">\r\n        <div class=\"textPart1\">${nls.welcomeMessage}</div>\r\n        <div class=\"textPart2\"></div>\r\n        <div class=\"upload-button-div\"><input class=\"upload-button\" type=\"button\" value=\"${nls.appUpload}\" data-dojo-attach-event=\"onclick:_onUploadClick\"></div>\r\n        <div class=\"create-button-div\"><input class=\"create-button\" type=\"button\" value=\"${nls.appCreate}\" data-dojo-attach-event=\"onclick:_onCreateClick\"></div>\r\n        <form enctype=\"multipart/form-data\" method=\"post\" action=\"/builder/rest/apps/upload\" data-dojo-attach-point=\"uploadAppFileFormNode\" style=\"display:none\">\r\n          <input name=\"app\" type=\"file\" data-dojo-attach-point=\"appFileInputNode\" data-dojo-attach-event=\"onchange:_onAppFileChange\" accept=\".zip\"/>\r\n          <input type=\"submit\" value=\"submit\" data-dojo-attach-point=\"submitAppFileNode\"/>\r\n        </form>\r\n    </div>\r\n\r\n    <div class=\"list-section\" id=\"list-section\" data-dojo-attach-point=\"listSection\">\r\n      <table class=\"list-section-head\">\r\n        <tr class=\"head-content\">\r\n          <th class=\"name\">${nls.appName}</th><th class=\"desc\">${nls.appDesc}</th><th class=\"time\">${nls.appTime}</th>\r\n        </tr>\r\n      </table>\r\n\r\n      <!--table class=\"list-section-body\">\r\n        <tr class=\"list-extent-tr\">\r\n          <td-->\r\n            <!--div class=\"list-section-body\" id='list-section-body' data-dojo-attach-point=\"listSectionBody\"-->\r\n              <div class=\"list-section-body-content\" id=\"list-section-body-content\" data-dojo-attach-point=\"listSectionBodyContent\">\r\n                <table class=\"list-table\" data-dojo-attach-point=\"listTable\">\r\n                </table>\r\n              </div>\r\n            <!--/div-->\r\n          <!--/td>\r\n        </tr>\r\n      </table-->\r\n    </div>\r\n  </div>\r\n  <iframe style=\"display:none\" name=\"downloadTargetFrame\"></iframe>\r\n</div>\r\n\r\n","url:builder/templates/CreateApp.html":"<div>\r\n  <!--div class=\"back-div\" data-dojo-attach-point=\"backDiv\"-->\r\n    <!--div class=\"front-div\"-->\r\n      <div class=\"app-2d-and-3d\">\r\n        <div class=\"app-image-div app-2d\" data-dojo-attach-point=\"app2D\" data-dojo-attach-event=\"click:_on2dClick\"><img src=\"/bstatic/css/images/2D.png\" alt=\"2D\"/></div>\r\n        <div class=\"app-image-div app-3d\" data-dojo-attach-point=\"app3D\" data-dojo-attach-event=\"click:_on3dClick\"><!--div class=\"surface-div\">Coming Soon</div--><img src=\"/bstatic/css/images/comingsoon.png\" alt=\"3d\"/></div>\r\n      </div>\r\n      <div class=\"app-input app-name\"><input type=\"text\" placeholder=\"${nls.appName}\" data-dojo-attach-point=\"appName\"/></input></div>\r\n      <div class=\"app-input app-description\"><textarea  type=\"text\" data-dojo-attach-point=\"appDescription\" placeholder=${nls.appDesc}></textarea></div>\r\n      <!--div class=\"app-button cancel-button\" data-dojo-attach-event=\"onclick:_onCancelClick\">${nls.cancel}</div-->\r\n      <!--div class=\"app-button next-button\"   data-dojo-attach-event=\"onclick:_onNextClick\">${nls.ok}</div-->\r\n    <!--/div-->\r\n  <!--/div-->\r\n</div>\r\n","url:builder/templates/ConfigApp.html":"<div >\r\n  <div class=\"left-pane\" data-dojo-attach-point=\"leftPaneNode\"></div>\r\n  <div class=\"right-preview-section\" data-dojo-attach-point=\"rightPreviewSection\">\r\n    <div class=\"preview-config\" data-dojo-attach-point=\"previewConfig\">\r\n      <iframe data-dojo-attach-point=\"viewerNode\" style=\"border:none\"></iframe>\r\n    </div>\r\n    <div class=\"preview-more\" data-dojo-attach-point=\"previewMore\">\r\n      <div class=\"preview-more-iframe-section\" data-dojo-attach-point=\"previewMoreIframeSection\">\r\n        <div class=\"preview-more-iframe-container\" data-dojo-attach-point=\"viewer2Container\">\r\n          <iframe data-dojo-attach-point=\"viewer2Node\"></iframe>\r\n        </div>\r\n        <div class=\"description\" data-dojo-attach-point=\"previewMoreDes\"></div>\r\n      </div>    \r\n      <div class=\"screen-switch-section\">\r\n       <div class=\"portrait selected\" data-dojo-attach-point=\"btnPortrait\"></div>\r\n       <div class=\"landscape\" data-dojo-attach-point=\"btnLandscape\"></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>","url:builder/config/templates/LeftPane.html":"<div class=\"left-pane\">\r\n  <div class=\"content\" data-dojo-attach-point=\"content\">\r\n    <div class=\"config-section\" data-dojo-attach-point=\"configSection\">\r\n      <div class=\"tabs\" data-dojo-attach-point=\"tabsNode\">\r\n        <div data-dojo-attach-point=\"appPaneNode\"></div>\r\n        <div data-dojo-attach-point=\"mapPaneNode\"></div>\r\n        <div data-dojo-attach-point=\"widgetPaneNode\"></div>\r\n        <div data-dojo-attach-point=\"attributePaneNode\"></div>\r\n      </div>\r\n    </div>\r\n    <div class=\"preview-section\" data-dojo-attach-point=\"previewSection\" style=\"display:none;\">\r\n      <div class=\"preview-header\">\r\n        <div class=\"header-item size-section\">\r\n          <div style=\"margin-left:22px;font-size:15px;color:white;\">${nls.width}</div>\r\n          <input type=\"text\" value=\"1024\" data-dojo-attach-point=\"customWidth\" />\r\n          <div style=\"margin-left:13px;font-size:15px;color:white;\">${nls.height}</div>\r\n          <input type=\"text\" value=\"768\"  data-dojo-attach-point=\"customHeight\" />\r\n        </div>\r\n        <div class=\"header-item button-ok\" data-dojo-attach-point=\"btnOk\">\r\n          <div class=\"check-icon\"></div>\r\n          <div class=\"ok-tip\">${nls.ok}</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"preview-body\">\r\n        <!--div class=\"operation-tip\">${nls.selectDevice}</div-->\r\n        <div class=\"preview-items-section\">\r\n          <table cellspacing=\"17\">\r\n            <tbody data-dojo-attach-point=\"previewTbody\">\r\n              <!-- <tr>\r\n                <td>\r\n                  <div class=\"preview-item\">\r\n                    <div class=\"preview-item-bg\">\r\n                      <div class=\"preview-item-thumbnail\"></div>\r\n                      <div class=\"preview-selected-icon\"></div>\r\n                    </div>\r\n                    <span class=\"preview-item-title\">iPhone5/5S</span>\r\n                  </div>\r\n                </td>\r\n              </tr> -->\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <div class=\"footer\">\r\n    <div class=\"footer-button first-footer-button\" data-dojo-attach-point=\"btnHomePage\"></div>\r\n    <div class=\"footer-button second-footer-button preview-button\" data-dojo-attach-point=\"btnPreview\">${nls.previewMore}</div>\r\n    <div class=\"footer-button second-footer-button config-button\" data-dojo-attach-point=\"btnConfig\">${nls.back2Configure}</div>\r\n    <div class=\"footer-button third-footer-button\" data-dojo-attach-point=\"btnSave\"><span data-dojo-attach-point=\"btnSaveText\">${nls.saved}</span>\r\n      <!--div class=\"third-footer-button-cover\" style=\"display:none\" data-dojo-attach-point=\"btnSaveCover\"></div-->\r\n    </div>\r\n  </div>\r\n  <div class=\"loading-cover\" data-dojo-attach-point=\"coverNode\"></div>\r\n</div>\r\n","url:builder/config/templates/MapConfig.html":"<div>\r\n\t<div class=\"map-info-section\">\r\n\t\t<div class=\"map-info map-not-selected-section\" data-dojo-attach-point=\"mapNotSelectedSection\">\r\n\t\t\t<div class=\"big-img button-add\" data-dojo-attach-point=\"btnAddMap\">\r\n\t\t\t\t<div class=\"add-map\"></div>\r\n\t\t\t\t<div class=\"add-map-label\">${nls.addMapLabel}</div>\r\n\t\t\t</div>\r\n\t\t\t<p class=\"add-map-tip\">\r\n\t\t\t\t${nls.addMapFromOnlineOrPortal}\r\n\t\t\t</p>\r\n\t\t</div>\r\n\t\t<div class=\"map-info map-selected-section\" data-dojo-attach-point=\"mapSelectedSection\" style=\"display:none;\">\r\n\t\t\t<div class=\"map-selected-meta-data\">\r\n\t\t\t\t<div class=\"map-selected-img\" data-dojo-attach-point=\"divMapSelectedImg\" data-dojo-attach-event=\"click:_showMapSelector\">\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"detail-info\">\r\n\t\t\t\t\t<div style=\"overflow:hidden;\">\r\n\t\t\t\t\t\t<div class=\"web-map-icon\" style=\"float:left;\"></div>\r\n\t\t\t\t\t\t<div style=\"float:right;width:140px;\">\r\n\t\t\t\t\t\t\t<span style=\"float:left;margin-left:5px;\">Web Map by <a data-dojo-attach-point=\"owner\" href=\"#\" target=\"_blank\" style=\"color:#15a4fa;text-decoration:none;\"></a></span>\r\n\t\t\t\t\t\t</div>\t\t\t\t\t\t\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style=\"margin-top:10px;\">\r\n\t\t\t\t\t\t<span>${nls.lastModified}: <span data-dojo-attach-point=\"lastModified\"></span></span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div style=\"margin-top:10px;\">\r\n\t\t\t\t\t\t<a data-dojo-attach-point=\"webMapDetails\" href=\"#\" target=\"_blank\" style=\"text-decoration:none;color:#15a4fa;\">${nls.moreDetails}...</a>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"jimu-btn\" data-dojo-attach-event=\"click:_showMapSelector\" style=\"position:absolute;left:0;bottom:0;\">${nls.changeMap}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"map-info-title\" data-dojo-attach-point=\"mapTitle\"></div>\r\n\t\t\t<p class=\"snippet\" data-dojo-attach-point=\"snippet\" style=\"font-size:12px;margin-top:10px;\"></p>\r\n\t\t\t<span data-dojo-attach-point=\"btnInitialExtent\" style=\"display:inline-block;margin-top:35px;font-size:14px;text-decoration:underline;color:#15a4fa;cursor:pointer;\">${nls.setInitialExtent}</span>\r\n\t\t\t<div class=\"description\" style=\"display:none;\">\r\n\t\t\t\t<p style=\"width:100%;overflow:auto;\" data-dojo-attach-point=\"mapDescription\"></p>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n","url:builder/config/templates/MapSelector.html":"<div style=\"position:relative;width:100%;height:100%;\">\r\n\t<div class=\"map-setting-tab-container\" style=\"width:100%;height:100%;\">\r\n\t\t<div data-dojo-attach-point=\"tabNode\"></div>\r\n\t\t<div class=\"tab-content public-tab\" data-dojo-attach-point=\"publicTabNode\">\r\n\t\t\t<div class=\"tab-content-main public-tab-content-main\">\r\n\t\t\t\t<div data-dojo-attach-point=\"publicSearch\" data-dojo-type=\"jimu/dijit/Search\" data-dojo-props='searchWhenInput:false' data-dojo-attach-event=\"onSearch:_onPublicSearch\" style=\"position:absolute;width:100%;top:15px;\"></div>\r\n\t\t\t\t<div class=\"public-search-radios\">\r\n\t\t\t\t\t<input data-dojo-attach-point=\"portalPublicRaido\" type=\"radio\" name=\"publicSearchRaido\" style=\"margin-right:10px;\" />\r\n\t\t\t\t\t<span style=\"margin-right:28px;\" data-dojo-attach-point=\"portalServer\">Portal</span>\r\n\t\t\t\t\t<input data-dojo-attach-point=\"onlinePublicRaido\" type=\"radio\" name=\"publicSearchRaido\" style=\"margin-right:10px;\" />\r\n\t\t\t\t\t<span>ArcGIS.com</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-attach-point=\"publicMapSection\" class=\"public-map-section\">\r\n\t\t\t\t\t<div data-dojo-attach-point=\"publicPortalMapTable\" data-dojo-type=\"builder/config/MapTable\"></div>\r\n\t\t\t\t\t<div data-dojo-attach-point=\"publicOnlineMapTable\" data-dojo-type=\"builder/config/MapTable\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"tab-content organization-tab\" data-dojo-attach-point=\"organizationTabNode\">\r\n\t\t\t<div class=\"tab-content-main organization-tab-content-main\">\r\n\t\t\t\t<div data-dojo-attach-point=\"organizationSearch\" data-dojo-type=\"jimu/dijit/Search\" data-dojo-props='searchWhenInput:false' data-dojo-attach-event=\"onSearch:_onOrganizationSearch\" style=\"position:absolute;width:100%;top:15px;\"></div>\r\n\t\t\t\t<div data-dojo-attach-point=\"organizationMapTable\" data-dojo-type=\"builder/config/MapTable\" style=\"top:65px;\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"tab-content group-tab\" data-dojo-attach-point=\"groupTabNode\">\r\n\t\t\t<div class=\"tab-content-main group-tab-content-main\">\r\n\t\t\t\t<div class=\"groups-section\" style=\"position:absolute;width:100%;top:70px;\" data-dojo-attach-point=\"groupsSection\">\r\n\t\t\t\t\t<span>${nls.groups}:</span>\r\n\t\t\t\t\t<select class=\"groups-select\" data-dojo-attach-point=\"groupsSelect\">\r\n\t\t\t\t\t\t<option value=\"nodata\">${nls.noneGroups}</option>\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div data-dojo-attach-point=\"groupSearch\" data-dojo-type=\"jimu/dijit/Search\" data-dojo-props='searchWhenInput:false' data-dojo-attach-event=\"onSearch:_onGroupSearch\" style=\"position:absolute;width:100%;top:15px;\"></div>\r\n\t\t\t\t<div data-dojo-attach-point=\"groupMapTable\" data-dojo-type=\"builder/config/MapTable\" style=\"top:113px;\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"tab-content mycontent-tab\" data-dojo-attach-point=\"mycontentTabNode\">\r\n\t\t\t<div class=\"tab-content-main mycontent-tab-content-main\">\r\n\t\t\t\t<div data-dojo-attach-point=\"mycontentSearch\" data-dojo-type=\"jimu/dijit/Search\" data-dojo-props='searchWhenInput:false' data-dojo-attach-event=\"onSearch:_onMyContentSearch\" style=\"position:absolute;width:100%;top:15px;\"></div>\r\n\t\t\t\t<div data-dojo-attach-point=\"mycontentMapTable\" data-dojo-type=\"builder/config/MapTable\" style=\"top:65px;\"></div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class=\"signin-section\" data-dojo-attach-point=\"signinSection\" style=\"display:none;\">\r\n\t\t<div class=\"signin-tip\">${nls.signInTip}</div>\r\n\t\t<div class=\"jimu-btn\" data-dojo-attach-point=\"btnSignIn\" style=\"margin-top:20px;padding:16px;\" >${nls.signIn}</div>\r\n\t</div>\r\n</div>","url:builder/config/templates/MapTable.html":"<div>\r\n\t<div class=\"maps-section\" data-dojo-attach-point=\"allMapsSection\">\r\n\t\t<div class=\"maps-table-div\" data-dojo-attach-point=\"allMapsTableDiv\">\r\n\t\t\t<table class=\"maps-table\" cellpadding=\"10\" data-dojo-attach-point=\"allMapsTable\">\r\n\t\t\t\t<tbody class=\"maps-tbody\" data-dojo-attach-point=\"allMapsTbody\"></tbody>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"jimu/dijit/LoadingIndicator\" data-dojo-attach-point=\"allMapsShelter\" data-dojo-props='hidden:true'></div>\r\n\t</div>\r\n\t<div class=\"maps-section\" data-dojo-attach-point=\"filteredMapsSection\" style=\"display:none;\">\r\n\t\t<div class=\"maps-table-div\" data-dojo-attach-point=\"filteredMapsTableDiv\">\r\n\t\t\t<table class=\"maps-table\" cellpadding=\"10\" data-dojo-attach-point=\"filteredMapsTable\">\r\n\t\t\t\t<tbody class=\"maps-tbody\" data-dojo-attach-point=\"filteredMapsTbody\"></tbody>\r\n\t\t\t</table>\r\n\t\t</div>\r\n\t\t<div class=\"search-none-tip-section\" data-dojo-attach-point=\"searchNoneTipSection\" style=\"display:none;\">\r\n\t\t\t<span class=\"search-none-icon\"></span>\r\n\t\t\t<span class=\"search-none-tip\">${nls.searchNone}</span>\r\n\t\t</div>\r\n\t\t<div data-dojo-type=\"jimu/dijit/LoadingIndicator\" data-dojo-attach-point=\"filteredMapsShelter\" data-dojo-props='hidden:true'></div>\r\n\t</div>\r\n</div>","url:builder/config/templates/ExtentSelector.html":"<div style=\"position:relative;width:100%;height:100%;\">\r\n  <div style=\"position:absolute;width:100%;height:30px;\">\r\n  \t<span data-dojo-attach-event=\"click:restoreToDefaultWebMapExtent\" style=\"float:right;display:inline-block;font-size:14px;text-decoration:underline;color:#15a4fa;cursor:pointer;\">${nls.originalExtentTip}</span>\r\n  </div>\r\n  <div data-dojo-attach-point=\"extentNode\" style=\"position:absolute;width:100%;top:35px;bottom:0;\"></div>\r\n</div>","url:builder/config/templates/ThemeConfig.html":"<div class=\"theme-config\">\r\n  <div class=\"theme-list\" data-dojo-attach-point=\"themeList\">\r\n    <div class=\"theme-title\"></div>\r\n  </div>\r\n  <div class=\"style-list\" data-dojo-attach-point=\"styleList\">\r\n    <!--div class=\"style-text\">${nls.styleTitle}</div-->\r\n  </div>\r\n  <div class=\"layout-list\" data-dojo-attach-point=\"layoutList\"></div>\r\n  <div class=\"theme-loading-cover\" style=\"display:none\" data-dojo-attach-point=\"themeCoverNode\"></div>\r\n</div>\r\n","url:builder/config/templates/WidgetConfig.html":"<div class=\"widget-config\">\r\n  <div class=\"pane app-widgets\" data-dojo-attach-point=\"appWidgetsPageNode\">\r\n  </div>\r\n</div>","url:builder/config/templates/WidgetSettingPage.html":"<div class=\"widget-setting-page\">\r\n  <div class=\"section common-setting\" data-dojo-attach-point=\"commonSettingNode\">\r\n    <div class=\"basic\">\r\n      <div class=\"icon\" data-dojo-attach-event=\"onclick:_onIconClick\">\r\n        <img class=\"real-icon\"  data-dojo-attach-point=\"iconNode\">\r\n      </div>\r\n      <div class=\"right\">\r\n        <input data-dojo-attach-point=\"labelNode\" class=\"jimu-input\">\r\n        <div class=\"right-foot\">\r\n          <span class=\"change-icon\" data-dojo-attach-point=\"changeNode\" data-dojo-attach-event=\"onclick:_onIconClick\">${nls.changeIcon}</span>\r\n          <!-- <a class=\"more\" data-dojo-attach-point=\"moreNode\" href=\"#\">${nls.more}</a> -->\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"layout\">\r\n    </div>\r\n  </div>\r\n  <div class=\"section widget-setting\" data-dojo-attach-point=\"widgetSettingNode\"></div>\r\n</div>\r\n","url:builder/config/templates/GroupSettingPage.html":"<div>\r\n  <div class=\"label-div\">\r\n    <span>${nls.label}</span>\r\n    <input class=\"jimu-input\" data-dojo-attach-point=\"labelNode\"></input>\r\n  </div>\r\n</div>\r\n","url:builder/config/templates/WidgetChoosePage.html":"<div class=\"widget-choose-page\">\r\n  \r\n  <div class=\"section search\" data-dojo-attach-point=\"searchSectionNode\">\r\n    <div data-dojo-attach-point=\"searchInputNode\"></div>\r\n    <div class=\"list widget-list\" data-dojo-attach-point=\"widgetListNode\"></div>\r\n  </div>\r\n</div>","url:builder/config/templates/AppWidgetsPage.html":"<div class=\"app-widgets\">\r\n  <div class=\"preload-widgets-list\" data-dojo-attach-point=\"preloadWidgetsNode\">\r\n    <div class=\"controller-widgets-list\" data-dojo-attach-point=\"controllerWidgetsNode\"></div>\r\n    <div class=\"noncontroller-preload-widgets-list\" data-dojo-attach-point=\"noncontrollerPreloadWidgetsNode\"></div>\r\n  </div>\r\n  <div class=\"pool-widgets-list\" data-dojo-attach-point=\"poolWidgetsNode\">\r\n    <div class=\"widgets-link\" data-dojo-attach-point=\"backWidgetsNode\" data-dojo-attach-event=\"onclick: _onBackWidgetsClick\"> &lt; &nbsp;\r\n      Widgets\r\n    </div>\r\n    <div class=\"widget-pool-title\" data-dojo-attach-point=\"poolTitleNode\">${nls.setControlledWidgetsBy}<span data-dojo-attach-point=\"controllerLabelNode\"></span></div>\r\n    <div class=\"widget-pool-list\" data-dojo-attach-point=\"poolWidgetsListNode\"></div>\r\n  </div>\r\n</div>","url:builder/config/templates/AttributeConfig.html":"<div class=\"attribute-config\">\r\n  <div class=\"section header-section\">\r\n    <p class=\"header-title\">${nls.headerTitle}</p>\r\n    <div class=\"header-desc\">${nls.headerDesc}</div>\r\n\r\n      <img class=\"logo\" data-dojo-attach-event=\"onclick:onLogoClick\" data-dojo-attach-point=\"logoNode\" style=\"display:none\">\r\n      <div class=\"no-logo\" data-dojo-attach-event=\"onclick:onLogoClick\" data-dojo-attach-point=\"noLogoNode\">\r\n        <img class=\"image\" src=\"/bstatic/css/images/add_header.png\">\r\n        <div class=\"text\"> ${nls.addLogo}</div>\r\n      </div>\r\n\r\n    <input type=\"file\" data-dojo-attach-point=\"fileInput\" accept=\"image/png, image/jpeg, image/bmp, image/gif\" data-dojo-attach-event=\"onchange:onLogoChange\" style=\"display:none\" accept=\"image/*\">\r\n    <div class=\"titles\">\r\n      <div style=\"background-color:#fafafc;\" class=\"title\">\r\n        <input style=\"background-color:#fafafc;\" class=\"jimu-input\" placeholder=${nls.title} data-dojo-attach-point=\"titleNode\">\r\n      </div>\r\n      <div style=\"background-color:#fafafc;\" class=\"subtitle\">\r\n        <input style=\"background-color:#fafafc;\" class=\"jimu-input\" placeholder=${nls.subtitle} data-dojo-attach-point=\"subtitleNode\">\r\n      </div>\r\n    </div>    \r\n  </div>\r\n\r\n  <div class=\"section links-section\">\r\n    <p class=\"links-title\">${nls.linksTitle}</p>\r\n    <div class=\"links-content\">\r\n      <div class=\"add-link\" data-dojo-attach-event=\"onclick:onAddLinkClick\" data-dojo-attach-point=\"addLinkNode\">\r\n        <div class=\"add-link-content\">\r\n          <img class=\"image\" src=\"/bstatic/css/images/add_link.png\">\r\n          <div class=\"text\">${nls.addLink}</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"links-list\" data-dojo-attach-point=\"linksListNode\"></div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"section setting-section\">\r\n    <div class=\"jimu-btn\" data-dojo-attach-point=\"settingButton\" data-dojo-attach-event=\"onclick:onSettingButtonClick\">${nls.moreAttributes}</div>\r\n    <!--div class=\"setting-title\">${nls.settings}</div>\r\n\r\n    <div class=\"setting-item-title\">${nls.portalUrl}</div>\r\n    <div class=\"setting-portal\">\r\n      <input class=\"jimu-input setting-input\" style=\"width:200px;\" placeholder=\"http://www.arcgis.com/ or http://<Portal Server>/arcgis/\" \r\n       data-dojo-attach-point=\"portalNode\"></input>\r\n      <a data-dojo-attach-point=\"btnLoadHelperServices\" class=\"jimu-btn\" style=\"line-height:1em;padding:10px;float:right;\">${nls.loadHelperServices}</a>\r\n    </div>\r\n    \r\n    <div class=\"setting-item-title\">${nls.geometryServiceUrl}</div>\r\n    <div class=\"setting-geometry\">\r\n      <input class=\"jimu-input setting-input\" placeholder=\"http://\" data-dojo-attach-point=\"geometryNode\"></input>      \r\n    </div>\r\n\r\n    <div class=\"setting-item-title\">${nls.geocodeServiceUrl}</div>\r\n    <div class=\"setting-geocode\"><input class=\"jimu-input setting-input\" placeholder=\"http://\" data-dojo-attach-point=\"geocodeNode\"></input></div>\r\n\r\n    <div class=\"setting-item-title\">${nls.routeServiceUrl}</div>\r\n    <div class=\"setting-route\"><input class=\"jimu-input setting-input\" placeholder=\"http://\" data-dojo-attach-point=\"routeNode\"></input></div>\r\n\r\n    <div class=\"setting-item-title\">${nls.printTaskUrl}</div>\r\n    <div class=\"setting-print\"><input class=\"jimu-input setting-input\" placeholder=\"http://\" data-dojo-attach-point=\"printNode\"></input></div>\r\n\r\n    <div class=\"setting-item-title\">${nls.httpProxyUrl}</div>\r\n    <div class=\"setting-proxy\"><input class=\"jimu-input setting-input\" placeholder=\"http://\" data-dojo-attach-point=\"proxyNode\"></input></div>\r\n\r\n    <div class=\"setting-item-title\">${nls.bingMapKey}</div>\r\n    <div class=\"setting-bingmap\"><input class=\"jimu-input setting-input\" placeholder=\"\" data-dojo-attach-point=\"bingMapNode\"></input></div> \r\n    \r\n    <div class=\"setting-item-title\">${nls.appId}</div>\r\n    <div class=\"setting-appid\"><input class=\"jimu-input setting-input\" placeholder=\"\" data-dojo-attach-point=\"appidNode\"></input></div>\r\n\r\n    <div class=\"setting-local-div\">\r\n      <div class=\"setting-item-title setting-local-title\">${nls.locale}</div>\r\n      <div class=\"setting-locale\" data-dojo-attach-point=\"localeNode\">\r\n        <select class=\"setting-locale-select\" name=\"selectLocale\" data-dojo-type=\"dijit/form/Select\" data-dojo-attach-point=\"localeSelect\" >\r\n          <option value=\"en-us\">English</option>\r\n          <option value=\"zh-cn\">ä¸­æ</option>\r\n        </select>\r\n      </div>\r\n    </div-->\r\n  </div>\r\n</div>\r\n","url:builder/config/templates/AttributeSetting.html":"<div style=\"position:relative;margin-left:20px;margin-right:20px;\">\r\n  <table class=\"layout-table\">\r\n    <tbody>\r\n      <tr >\r\n        <td colspan=3>\r\n          <table class=\"portalurl-table\">\r\n            <tbody>\r\n              <tr>\r\n                <td class=\"first-td\">${nls.defaultPortalUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http(s)://www.arcgis.com/ or http(s)://<portal_server>/<instance_name>/\" value=\"\" data-dojo-attach-point=\"portalUrl\" style=\"width:520px;\" />\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.defaultPortalUrl}\"></span>\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <a data-dojo-attach-point=\"btnLoadHelperServices\" class=\"jimu-btn\">${nls.loadHelperServices}</a>\r\n                </td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </td>\r\n      </tr>\r\n      <tr >\r\n        <td colspan=3>\r\n          <table class=\"service-table\">\r\n            <tbody>\r\n              <tr>\r\n                <td class=\"first-td\">${nls.geometryServiceUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"geoServiceUrl\" />\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.geometryServiceUrl}\"></span>\r\n                </td>\r\n              </tr>\r\n              <tr>\r\n                <td class=\"first-td\">${nls.geocodeServiceUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"geocodeServiceUrl\" />\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.geocodeServiceUrl}\"></span>\r\n                </td>\r\n              </tr>\r\n              <tr>\r\n                <td class=\"first-td\">${nls.routeServiceUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"routeServiceUrl\" />\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.routeServiceUrl}\"></span>\r\n                </td>\r\n              </tr>      \r\n              <tr>\r\n                <td class=\"first-td\">${nls.printTaskUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"printTaskUrl\" />\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.printTaskUrl}\"></span>\r\n                </td>\r\n              </tr>  \r\n            </tbody>\r\n          </table>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"first-td\">${nls.httpProxyUrl}</td>\r\n        <td class=\"second-td\">\r\n          <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"proxyUrl\" />\r\n        </td>\r\n        <td class=\"third-td\">\r\n          <span class=\"help-icon\" title=\"${nls.helpText.httpProxyUrl}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"first-td\">${nls.locale}</td>\r\n        <td class=\"second-td\">\r\n          <select data-dojo-attach-point=\"localeSelect\" data-dojo-type=\"dijit/form/Select\" style=\"width:300px;height:30px;\">\r\n            <option value='en-us'>English</option>\r\n            <option value='zh-cn'>ä¸­æ</option>\r\n          </select>\r\n          <span class=\"help-icon\" title=\"${nls.helpText.locale}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr class=\"advanced-setting-hide\">\r\n        <td class=\"first-td\">${nls.bingMapKey}</td>\r\n        <td class=\"second-td\">\r\n          <input class=\"setting-input\" type=\"text\" value=\"\" data-dojo-attach-point=\"bing\" />\r\n        </td>\r\n        <td class=\"third-td\">\r\n          <span class=\"help-icon\" title=\"${nls.helpText.bingMapKey}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr class=\"advanced-setting-hide\">\r\n        <td class=\"first-td\">${nls.appId}</td>\r\n        <td class=\"second-td\">\r\n          <input class=\"setting-input\" type=\"text\" value=\"\" data-dojo-attach-point=\"appId\" />\r\n        </td>\r\n        <td class=\"third-td\">\r\n          <span class=\"help-icon\" title=\"${nls.helpText.appId}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td colspan=2>\r\n          <input class=\"advanced-settings\" type=\"button\" data-dojo-attach-point=\"advance\" data-dojo-attach-event=\"onclick:_onAdvancedClick\" />\r\n        </td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>","url:builder/config/templates/TabContainer2.html":"<div>\r\n  <div data-dojo-attach-point=\"controlNode\">\r\n    <table class=\"control-table\">\r\n      <tbody>\r\n        <tr data-dojo-attach-point=\"tabTr\">\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div class=\"jimu-viewstack2\" data-dojo-attach-point=\"containerNode\"></div>\r\n</div>","url:builder/templates/AppOperMenu.html":"<div data-dojo-attach-event=\"onclick:_onMenuClick\">\r\n  <div class=\"up-triangle\" data-dojo-attach-point=\"upTriangle\"></div>\r\n  <div class=\"down-triangle\" data-dojo-attach-point=\"downTriangle\"></div>\r\n  <!--div class=\"item item-cf\" data-dojo-attach-point=\"createFromHere\" data-dojo-attach-event=\"onclick:_onCreateFromHereClick,onmouseover:_onCreateFromHereMouseover,onmouseout:_onCreateFromHereMouseout\">${nls.createFromHere}</div-->\r\n  <div class=\"item item-editAppInfo\" style=\"border-top-left-radius:5px;border-top-right-radius:5px;\"data-dojo-attach-point=\"editAppInfo\" data-dojo-attach-event=\"onclick:_onEditClick,onmouseover:_onEditMouseover,onmouseout:_onEditMouseout\">${nls.editAppInfo}</div>\r\n  <div class=\"item item-download\" data-dojo-attach-point=\"download\" data-dojo-attach-event=\"onclick:_onDownloadClick,onmouseover:_onDownloadMouseover,onmouseout:_onDownloadMouseout\">\r\n    <a data-dojo-attach-point=\"downloadLinkNode\" style=\"display:inline-block;width:100%;height:100%;\" target=\"downloadTargetFrame\">${nls.download}</a>\r\n  </div>\r\n  <div class=\"item item-duplicate\" data-dojo-attach-point=\"duplicate\" data-dojo-attach-event=\"onclick:_onDuplicateClick,onmouseover:_onDuplicateMouseover,onmouseout:_onDuplicateMouseout\">${nls.duplicate}</div>\r\n  <div class=\"item itme-remove\" data-dojo-attach-point=\"remove\" data-dojo-attach-event=\"onclick:_onRemoveClick,onmouseover:_onRemoveMouseover,onmouseout:_onRemoveMouseout\">${nls.remove}</div>\r\n  <div class=\"item item-agol-template\" style=\"border-bottom-left-radius:5px;border-bottom-right-radius:5px;\" data-dojo-attach-point=\"agolTemplate\" data-dojo-attach-event=\"onclick:_onAgolTemplateClick,onmouseover:_onAgolTemplateMouseover,onmouseout:_onAgolTemplateMouseout\">${nls.agolTemp}</div>    \r\n</div>\r\n","url:builder/AGOLTemplate/templates/AGOLTemplate.html":"<div>\r\n  <div class=\"front-div\" data-dojo-attach-point=\"frontDiv\">\r\n    <div class=\"header-div\" data-dojo-attach-point=\"headerDiv\">\r\n      <span>${nls.title}</span>\r\n      <img src=\"/bstatic/css/images/cancel.png\" alt=\"img\" data-dojo-attach-event=\"onclick:_onCancelClick\"></img>\r\n    </div>\r\n\r\n    <div class=\"content-part\" data-dojo-attach-point=\"contentPart\">\r\n      <div class=\"tree-part\" data-dojo-attach-point=\"treePart\">\r\n        <div class=\"left-part-title\" style=\"margin-left:18px; margin-top:10px; color: #596679; font-size: 15px;\">${nls.appNameTitle}${app.name}</div>\r\n      </div>\r\n\r\n      <div class=\"right-part\" data-dojo-attach-point=\"leftPart\">\r\n        <div class=\"right-part-head\" >\r\n          <span data-dojo-attach-point=\"rightPartHeadText\">${nls.rightPartHead}</span>\r\n          <div class=\"review-json-div\" data-dojo-attach-point=\"reviewJsonDiv\" data-dojo-attach-event=\"onclick:_onReviewJsonDivClick\">${nls.viewJsonCode}</div>\r\n          <div class=\"review-json-back-div\" style=\"display: none\" data-dojo-attach-point=\"reviewJsonBackDiv\" data-dojo-attach-event=\"onclick:_onReviewJsonBackDivClick\">${nls.viewJsonBack}</div>\r\n\r\n        </div>\r\n\r\n        <div class=\"right-part-subhead\">\r\n          ${nls.rightPartSubhead}\r\n        </div>\r\n        <div class=\"category-part\" data-dojo-attach-point=\"categoryPart\"></div>\r\n        <div class=\"show-json-div\" data-dojo-attach-point=\"showJsonDiv\">\r\n          <div class=\"show-json-content-div\" data-dojo-attach-point=\"showJsonContentDiv\">     \r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"operation-div\" data-dojo-attach-point=\"operationDiv\">\r\n      <div class=\"operation-item-div  download-div jimu-btn jimu-state-disabled\" style=\"padding: 0px;\" data-dojo-attach-point=\"downloadNode\">\r\n        <a class=\"download-a\" href=\"#\" target=\"downloadTargetFrame\" data-dojo-attach-point=\"downloadLinkNode\">${nls.download}</a>\r\n      </div>\r\n      <div class=\"operation-item-div save-div jimu-btn\" data-dojo-attach-event=\"onclick:_onSaveClick\">\r\n        ${nls.save}\r\n      </div>\r\n      <div class=\"operation-item-div cancel-div jimu-btn\" data-dojo-attach-event=\"onclick:_onCancelClick\">\r\n        ${nls.cancel}\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n","url:builder/templates/Header.html":"<div>\r\n  <div class=\"logo\"></div>\r\n  <div class=\"title\">ArcGIS WebApp Builder</div>\r\n  <div class=\"app-name\" data-dojo-attach-point=\"appName\"></div>\r\n  <div class=\"links\" data-dojo-attach-point=\"linksSection\">\r\n    <table style=\"float:right;\">\r\n      <tbody>\r\n        <tr>\r\n          <td style=\"padding-right:8px;\">\r\n            <div class=\"icon setting-icon\" data-dojo-attach-point=\"settingIcon\"></div>\r\n          </td>\r\n          <td style=\"padding-right:20px;\">\r\n            <div data-dojo-attach-event=\"onclick:_onSettingClick\" data-dojo-attach-point=\"settingLinkNode\"  style=\"curosr:pointer;\">${nls.appDefaultAttributes}</div>\r\n          </td>\r\n          <td style=\"padding-right:8px;\">\r\n            <div class=\"icon help-icon\"></div>\r\n          </td>\r\n          <td style=\"padding-right:20px;\">\r\n            <a href=\"http://resources.arcgis.com/en/help/\" target=\"_blank\" data-dojo-attach-point=\"helpLinkNode\" >${nls.help}</a>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>","url:builder/templates/Setting.html":"<div style=\"position:relative;margin-left:20px;margin-right:20px;\">\r\n  <table class=\"layout-table\">\r\n    <tbody>\r\n      <tr >\r\n        <td colspan=3>\r\n          <table class=\"portalurl-table\">\r\n            <tbody>\r\n              <tr>\r\n                <td class=\"first-td\">${nls.defaultPortalUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http(s)://www.arcgis.com/ or http(s)://<portal_server>/<instance_name>/\" value=\"\" data-dojo-attach-point=\"portalUrl\" style=\"width:520px;\" />\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.defaultPortalUrl}\"></span>\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <a data-dojo-attach-point=\"btnLoadHelperServices\" class=\"jimu-btn\">${nls.loadHelperServices}</a>\r\n                </td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </td>\r\n      </tr>\r\n      <tr >\r\n        <td colspan=3>\r\n          <table class=\"service-table\">\r\n            <tbody>\r\n              <tr>\r\n                <td class=\"first-td\">${nls.geometryServiceUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"geoServiceUrl\" />\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.geometryServiceUrl}\"></span>\r\n                </td>\r\n              </tr>\r\n              <tr>\r\n                <td class=\"first-td\">${nls.geocodeServiceUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"geocodeServiceUrl\" />\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.geocodeServiceUrl}\"></span>\r\n                </td>\r\n              </tr>\r\n              <tr>\r\n                <td class=\"first-td\">${nls.routeServiceUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"routeServiceUrl\" />\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.routeServiceUrl}\"></span>\r\n                </td>\r\n              </tr>      \r\n              <tr>\r\n                <td class=\"first-td\">${nls.printTaskUrl}</td>\r\n                <td class=\"second-td\">\r\n                  <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"printTaskUrl\" />\r\n                </td>\r\n                <td class=\"third-td\">\r\n                  <span class=\"help-icon\" title=\"${nls.helpText.printTaskUrl}\"></span>\r\n                </td>\r\n              </tr>  \r\n            </tbody>\r\n          </table>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"first-td\">${nls.httpProxyUrl}</td>\r\n        <td class=\"second-td\">\r\n          <input class=\"setting-input\" type=\"text\" placeholder=\"http://\" value=\"\" data-dojo-attach-point=\"proxyUrl\" />\r\n        </td>\r\n        <td class=\"third-td\">\r\n          <span class=\"help-icon\" title=\"${nls.helpText.httpProxyUrl}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td class=\"first-td\">${nls.locale}</td>\r\n        <td class=\"second-td\">\r\n          <select data-dojo-attach-point=\"localeSelect\" data-dojo-type=\"dijit/form/Select\" style=\"width:300px;height:30px;\">\r\n            <option value='en-us'>English</option>\r\n            <option value='zh-cn'>ä¸­æ</option>\r\n          </select>\r\n          <span class=\"help-icon\" title=\"${nls.helpText.locale}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr class=\"advanced-setting-hide\">\r\n        <td class=\"first-td\">${nls.bingMapKey}</td>\r\n        <td class=\"second-td\">\r\n          <input class=\"setting-input\" type=\"text\" value=\"\" data-dojo-attach-point=\"bing\" />\r\n        </td>\r\n        <td class=\"third-td\">\r\n          <span class=\"help-icon\" title=\"${nls.helpText.bingMapKey}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr class=\"advanced-setting-hide\">\r\n        <td class=\"first-td\">${nls.appId}</td>\r\n        <td class=\"second-td\">\r\n          <input class=\"setting-input\" type=\"text\" value=\"\" data-dojo-attach-point=\"appId\" />\r\n        </td>\r\n        <td class=\"third-td\">\r\n          <span class=\"help-icon\" title=\"${nls.helpText.appId}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr class=\"advanced-setting-hide\">\r\n        <td class=\"first-td\">${nls.themeRepo}</td>\r\n        <td class=\"second-td\">\r\n          <input class=\"setting-input\" type=\"text\" value=\"\" data-dojo-attach-point=\"themeRepo\" />\r\n        </td>\r\n        <td class=\"third-td\">\r\n          <span class=\"help-icon\" title=\"${nls.helpText.themeRepo}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr class=\"advanced-setting-hide\">\r\n        <td class=\"first-td\">${nls.widgetRepo}</td>\r\n        <td class=\"second-td\">\r\n          <input class=\"setting-input\" type=\"text\" value=\"\" data-dojo-attach-point=\"widgetRepo\" />\r\n        </td>\r\n        <td class=\"third-td\">\r\n          <span class=\"help-icon\" title=\"${nls.helpText.widgetRepo}\"></span>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td colspan=2>\r\n          <input class=\"advanced-settings\" type=\"button\" data-dojo-attach-point=\"advance\" data-dojo-attach-event=\"onclick:_onAdvancedClick\" />\r\n        </td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>","*now":function(r){r(["dojo/i18n!*preload*builder/nls/main*[\"ar\",\"ca\",\"cs\",\"da\",\"de\",\"el\",\"en-gb\",\"en-us\",\"es-es\",\"fi-fi\",\"fr-fr\",\"he-il\",\"hu\",\"it-it\",\"ja-jp\",\"ko-kr\",\"nl-nl\",\"nb\",\"pl\",\"pt-br\",\"pt-pt\",\"ru\",\"sk\",\"sl\",\"sv\",\"th\",\"tr\",\"zh-tw\",\"zh-cn\",\"ROOT\"]"]);}}});define("builder/main",["dojo/parser","dojo/_base/html","dojo/domReady!","dojo/on","dijit/registry","jimu","jimu/dijit/ViewStack","./Apps","./Header","./ConfigApp","esri/urlUtils","esri/request"],function(_519,html,_51a,on,_51b,_51c,_51d,Apps,_51e,_51f,_520,_521){window.onbeforeunload=function(){return "";};_519.parse().then(init);jimuConfig.layoutId=jimuConfig.mainPageId;function init(){html.setStyle("main-loading","display","none");html.setStyle("main-page","display","block");main=new _51d({viewType:"dijit",views:[new Apps({id:"app-list"})]},"main");on(main,"viewSwitch",function(view){if(view.label==="apps"){_51b.byId("header").showSettings();}else{_51b.byId("header").hideSettings();}});main.startup();var _522=_520.urlToObject(window.location.href);if(_522.query&&_522.query.appid){var _523=new _51f({appId:_522.query.appid.replace("#","")});main.addView(_523);main.switchView(_523);}function _524(_525){_525.preventCache=true;return _525;};_521.setRequestPreCallback(_524);};});